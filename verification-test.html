<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒæ­¥åŠŸèƒ½éªŒè¯æµ‹è¯•</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- è·¨è®¾å¤‡åŒæ­¥ç³»ç»Ÿ -->
    <script src="cross-device-sync.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-good {
            background: #10b981;
        }
        
        .status-bad {
            background: #ef4444;
        }
        
        .status-warning {
            background: #f59e0b;
        }
        
        .test-result {
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid;
        }
        
        .test-pass {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        
        .test-fail {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        
        .test-warning {
            background-color: #fefce8;
            border-left-color: #f59e0b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ - åŠŸèƒ½éªŒè¯</h1>
            <p class="text-gray-600">å…¨é¢æ£€æŸ¥ç³»ç»ŸåŠŸèƒ½å’Œä»£ç å®Œæ•´æ€§</p>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fa fa-server mr-2"></i>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
            </h2>
            <div id="systemStatus" class="space-y-3">
                <p class="text-gray-600">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</p>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯• -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fa fa-cogs mr-2"></i>åŠŸèƒ½æµ‹è¯•
            </h2>
            <div class="flex flex-wrap gap-3 mb-6 justify-center">
                <button id="testSyncBtn" class="btn btn-primary">
                    <i class="fa fa-refresh mr-2"></i>æµ‹è¯•åŒæ­¥åŠŸèƒ½
                </button>
                <button id="testDataBtn" class="btn btn-success">
                    <i class="fa fa-database mr-2"></i>æµ‹è¯•æ•°æ®æ“ä½œ
                </button>
                <button id="testExportBtn" class="btn btn-warning">
                    <i class="fa fa-download mr-2"></i>æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
                </button>
            </div>
            
            <!-- æµ‹è¯•ç»“æœ -->
            <div id="testResults" class="space-y-3">
                <p class="text-gray-600">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>

        <!-- å¿«é€ŸéªŒè¯ -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fa fa-check-circle mr-2"></i>å¿«é€ŸéªŒè¯
            </h2>
            <div class="text-center">
                <button id="quickVerifyBtn" class="btn btn-primary">
                    <i class="fa fa-bolt mr-2"></i>ä¸€é”®éªŒè¯æ‰€æœ‰åŠŸèƒ½
                </button>
                <p class="text-sm text-gray-500 mt-3">å°†è‡ªåŠ¨æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½å¹¶ç”ŸæˆéªŒè¯æŠ¥å‘Š</p>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœè®°å½•
        let testResults = [];
        
        // æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
        function updateSystemStatus() {
            const statusContainer = document.getElementById('systemStatus');
            
            let html = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <span class="status-indicator ${window.crossDeviceSync ? 'status-good' : 'status-bad'}"></span>
                        <span>è·¨è®¾å¤‡åŒæ­¥æ¨¡å—: ${window.crossDeviceSync ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}</span>
                    </div>
                    
                    <div class="flex items-center">
                        <span class="status-indicator ${window.app ? 'status-good' : 'status-warning'}"></span>
                        <span>åº”ç”¨å®ä¾‹: ${window.app ? 'âœ… å·²åˆå§‹åŒ–' : 'âš ï¸ æœªåˆå§‹åŒ–'}</span>
                    </div>
                    
                    <div class="flex items-center">
                        <span class="status-indicator ${typeof JSON !== 'undefined' ? 'status-good' : 'status-bad'}"></span>
                        <span>JSON API: ${typeof JSON !== 'undefined' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}</span>
                    </div>
                    
                    <div class="flex items-center">
                        <span class="status-indicator ${typeof localStorage !== 'undefined' ? 'status-good' : 'status-warning'}"></span>
                        <span>LocalStorage: ${typeof localStorage !== 'undefined' ? 'âœ… å¯ç”¨' : 'âš ï¸ ä¸å¯ç”¨'}</span>
                    </div>
                    
                    <div class="flex items-center">
                        <span class="status-indicator ${typeof Blob !== 'undefined' && typeof URL !== 'undefined' ? 'status-good' : 'status-bad'}"></span>
                        <span>File API: ${typeof Blob !== 'undefined' && typeof URL !== 'undefined' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}</span>
                    </div>
                </div>
            `;
            
            statusContainer.innerHTML = html;
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(name, success, message, details = '') {
            const resultsContainer = document.getElementById('testResults');
            const resultClass = success ? 'test-pass' : (details.includes('è­¦å‘Š') ? 'test-warning' : 'test-fail');
            const icon = success ? 'check-circle' : (details.includes('è­¦å‘Š') ? 'exclamation-triangle' : 'exclamation-circle');
            const color = success ? 'text-green-600' : (details.includes('è­¦å‘Š') ? 'text-yellow-600' : 'text-red-600');
            
            const resultHtml = `
                <div class="test-result ${resultClass}">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mt-0.5">
                            <i class="fa fa-${icon} ${color} text-lg"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="font-medium">${name}: ${success ? 'é€šè¿‡' : 'å¤±è´¥'}</p>
                            <p class="text-sm text-gray-600 mt-1">${message}</p>
                            ${details ? `<p class="text-xs text-gray-500 mt-1">${details}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            resultsContainer.innerHTML += resultHtml;
            
            // è®°å½•ç»“æœ
            testResults.push({
                name: name,
                success: success,
                message: message,
                details: details,
                timestamp: new Date()
            });
        }
        
        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearTestResults() {
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
        }
        
        // æµ‹è¯•åŒæ­¥åŠŸèƒ½
        async function testSyncFunctionality() {
            clearTestResults();
            addTestResult('åŒæ­¥æ¨¡å—æ£€æŸ¥', true, 'å¼€å§‹æµ‹è¯•åŒæ­¥åŠŸèƒ½');
            
            try {
                // æ£€æŸ¥åŒæ­¥æ¨¡å—
                if (!window.crossDeviceSync) {
                    addTestResult('åŒæ­¥æ¨¡å—æ£€æŸ¥', false, 'è·¨è®¾å¤‡åŒæ­¥æ¨¡å—æœªåŠ è½½', 'è¯·æ£€æŸ¥cross-device-sync.jsæ–‡ä»¶æ˜¯å¦æ­£ç¡®å¼•å…¥');
                    return;
                }
                
                addTestResult('åŒæ­¥æ¨¡å—æ£€æŸ¥', true, 'è·¨è®¾å¤‡åŒæ­¥æ¨¡å—å·²æˆåŠŸåŠ è½½');
                
                // æµ‹è¯•åˆå§‹åŒ–
                const initResult = await window.crossDeviceSync.init();
                addTestResult('åŒæ­¥æ¨¡å—åˆå§‹åŒ–', initResult, initResult ? 'åˆå§‹åŒ–æˆåŠŸ' : 'åˆå§‹åŒ–å¤±è´¥');
                
                // æµ‹è¯•è®¾å¤‡IDç”Ÿæˆ
                const deviceId = window.crossDeviceSync.deviceId;
                const hasValidDeviceId = deviceId && deviceId.startsWith('device_');
                addTestResult('è®¾å¤‡IDç”Ÿæˆ', hasValidDeviceId, hasValidDeviceId ? 'è®¾å¤‡IDç”ŸæˆæˆåŠŸ' : 'è®¾å¤‡IDç”Ÿæˆå¤±è´¥', `è®¾å¤‡ID: ${deviceId}`);
                
                // æµ‹è¯•åŒæ­¥çŠ¶æ€è·å–
                const status = await window.crossDeviceSync.getSyncStatus();
                const hasValidStatus = status && status.deviceId;
                addTestResult('åŒæ­¥çŠ¶æ€è·å–', hasValidStatus, hasValidStatus ? 'çŠ¶æ€è·å–æˆåŠŸ' : 'çŠ¶æ€è·å–å¤±è´¥');
                
                // æµ‹è¯•æ–¹æ³•æ”¯æŒæ£€æµ‹
                const supportedMethods = window.crossDeviceSync.supportedMethods;
                const hasFileAPI = supportedMethods.fileAPI;
                addTestResult('File APIæ”¯æŒ', hasFileAPI, hasFileAPI ? 'File APIå¯ç”¨' : 'File APIä¸å¯ç”¨');
                
                addTestResult('åŒæ­¥åŠŸèƒ½æµ‹è¯•', true, 'æ‰€æœ‰åŒæ­¥åŠŸèƒ½æµ‹è¯•å®Œæˆ', `é€šè¿‡: ${testResults.filter(r => r.success).length}/${testResults.length}`);
                
            } catch (error) {
                addTestResult('åŒæ­¥åŠŸèƒ½æµ‹è¯•', false, 'æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', error.message);
            }
        }
        
        // æµ‹è¯•æ•°æ®æ“ä½œ
        function testDataOperations() {
            clearTestResults();
            addTestResult('æ•°æ®æ“ä½œæµ‹è¯•', true, 'å¼€å§‹æµ‹è¯•æ•°æ®æ“ä½œåŠŸèƒ½');
            
            try {
                // åˆ›å»ºæµ‹è¯•æ•°æ®
                const testQuestions = [
                    {
                        id: 'test_question_1',
                        content: 'æµ‹è¯•é¢˜ç›®ï¼šHTMLçš„å…¨ç§°æ˜¯ï¼Ÿ',
                        type: 'single',
                        options: ['HyperText Markup Language', 'Home Tool Markup Language', 'Hyperlinks and Text Markup Language', 'None'],
                        answer: '0',
                        analysis: 'HTMLçš„å…¨ç§°æ˜¯HyperText Markup Languageï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰'
                    },
                    {
                        id: 'test_question_2',
                        content: 'æµ‹è¯•é¢˜ç›®ï¼šCSSçš„ä¸»è¦ä½œç”¨æ˜¯ï¼Ÿ',
                        type: 'multiple',
                        options: ['ç¾åŒ–ç½‘é¡µ', 'æ§åˆ¶å¸ƒå±€', 'æ·»åŠ äº¤äº’', 'æ•°æ®å¤„ç†'],
                        answer: '0,1',
                        analysis: 'CSSä¸»è¦ç”¨äºç¾åŒ–ç½‘é¡µå’Œæ§åˆ¶å¸ƒå±€'
                    }
                ];
                
                addTestResult('æµ‹è¯•æ•°æ®åˆ›å»º', true, 'æˆåŠŸåˆ›å»ºæµ‹è¯•æ•°æ®');
                
                // æµ‹è¯•æ•°æ®å»é‡
                if (window.crossDeviceSync && typeof window.crossDeviceSync.removeDuplicateQuestions === 'function') {
                    const duplicatedQuestions = [...testQuestions, testQuestions[0]]; // åˆ›å»ºé‡å¤æ•°æ®
                    const uniqueQuestions = window.crossDeviceSync.removeDuplicateQuestions(duplicatedQuestions);
                    const isDeduplicated = uniqueQuestions.length === testQuestions.length;
                    
                    addTestResult('æ•°æ®å»é‡åŠŸèƒ½', isDeduplicated, isDeduplicated ? 'æ•°æ®å»é‡æˆåŠŸ' : 'æ•°æ®å»é‡å¤±è´¥', 
                                 `åŸå§‹: ${duplicatedQuestions.length}, å»é‡å: ${uniqueQuestions.length}`);
                } else {
                    addTestResult('æ•°æ®å»é‡åŠŸèƒ½', false, 'å»é‡æ–¹æ³•ä¸å¯ç”¨', 'åŒæ­¥æ¨¡å—æˆ–æ–¹æ³•æœªæ‰¾åˆ°');
                }
                
                // æµ‹è¯•JSONåºåˆ—åŒ–
                try {
                    const testData = {
                        questions: testQuestions,
                        metadata: {
                            count: testQuestions.length,
                            type: 'test'
                        }
                    };
                    
                    const jsonString = JSON.stringify(testData, null, 2);
                    const parsedData = JSON.parse(jsonString);
                    const isSerializationValid = parsedData.questions.length === testQuestions.length;
                    
                    addTestResult('JSONåºåˆ—åŒ–', isSerializationValid, isSerializationValid ? 'åºåˆ—åŒ–æˆåŠŸ' : 'åºåˆ—åŒ–å¤±è´¥',
                                 `æ•°æ®å¤§å°: ${jsonString.length} å­—ç¬¦`);
                    
                } catch (error) {
                    addTestResult('JSONåºåˆ—åŒ–', false, 'åºåˆ—åŒ–æµ‹è¯•å¤±è´¥', error.message);
                }
                
                addTestResult('æ•°æ®æ“ä½œæµ‹è¯•', true, 'æ‰€æœ‰æ•°æ®æ“ä½œæµ‹è¯•å®Œæˆ', 
                             `é€šè¿‡: ${testResults.filter(r => r.success).length}/${testResults.length}`);
                
            } catch (error) {
                addTestResult('æ•°æ®æ“ä½œæµ‹è¯•', false, 'æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', error.message);
            }
        }
        
        // æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
        async function testExportFunctionality() {
            clearTestResults();
            addTestResult('å¯¼å‡ºåŠŸèƒ½æµ‹è¯•', true, 'å¼€å§‹æµ‹è¯•å¯¼å‡ºåŠŸèƒ½');
            
            try {
                // åˆ›å»ºæ¨¡æ‹Ÿåº”ç”¨æ•°æ®
                window.app = window.app || {};
                window.app.publicQuestionBank = [
                    {
                        id: 'export_test_1',
                        content: 'å¯¼å‡ºæµ‹è¯•é¢˜ç›®1',
                        type: 'single',
                        options: ['é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D'],
                        answer: '1',
                        analysis: 'è¿™æ˜¯å¯¼å‡ºæµ‹è¯•é¢˜ç›®1çš„è§£æ'
                    }
                ];
                window.app.personalQuestionBank = [
                    {
                        id: 'export_test_2',
                        content: 'å¯¼å‡ºæµ‹è¯•é¢˜ç›®2',
                        type: 'multiple',
                        options: ['é€‰é¡¹1', 'é€‰é¡¹2', 'é€‰é¡¹3', 'é€‰é¡¹4'],
                        answer: '0,2',
                        analysis: 'è¿™æ˜¯å¯¼å‡ºæµ‹è¯•é¢˜ç›®2çš„è§£æ'
                    }
                ];
                window.app.mistakeBank = [];
                window.app.studyStats = {
                    totalQuestions: 100,
                    correctAnswers: 80,
                    totalStudyTime: 3600
                };
                window.app.currentUser = { id: 'test_user', username: 'æµ‹è¯•ç”¨æˆ·' };
                
                addTestResult('æµ‹è¯•æ•°æ®å‡†å¤‡', true, 'æˆåŠŸåˆ›å»ºå¯¼å‡ºæµ‹è¯•æ•°æ®');
                
                // æ£€æŸ¥å¯¼å‡ºæ–¹æ³•
                if (!window.crossDeviceSync) {
                    addTestResult('å¯¼å‡ºæ–¹æ³•æ£€æŸ¥', false, 'åŒæ­¥æ¨¡å—æœªåŠ è½½');
                    return;
                }
                
                if (typeof window.crossDeviceSync.exportSyncData !== 'function') {
                    addTestResult('å¯¼å‡ºæ–¹æ³•æ£€æŸ¥', false, 'å¯¼å‡ºæ–¹æ³•ä¸å­˜åœ¨');
                    return;
                }
                
                addTestResult('å¯¼å‡ºæ–¹æ³•æ£€æŸ¥', true, 'å¯¼å‡ºæ–¹æ³•å­˜åœ¨ä¸”å¯ç”¨');
                
                // æ¨¡æ‹Ÿå¯¼å‡ºè¿‡ç¨‹ï¼ˆä¸å®é™…ä¸‹è½½ï¼‰
                try {
                    // è¿™é‡Œæˆ‘ä»¬ä¸å®é™…è°ƒç”¨å¯¼å‡ºæ–¹æ³•ï¼Œåªæ£€æŸ¥å®ƒæ˜¯å¦å­˜åœ¨å’Œå¯è°ƒç”¨
                    const exportMethod = window.crossDeviceSync.exportSyncData;
                    const isAsyncFunction = exportMethod.constructor.name === 'AsyncFunction' || 
                                          exportMethod.toString().includes('async');
                    
                    addTestResult('å¯¼å‡ºæ–¹æ³•ç±»å‹', true, 'å¯¼å‡ºæ–¹æ³•ç±»å‹æ­£ç¡®', 
                                 `æ˜¯å¦å¼‚æ­¥: ${isAsyncFunction ? 'æ˜¯' : 'å¦'}`);
                    
                    // æ£€æŸ¥å¯¼å‡ºæ–¹æ³•çš„ä¾èµ–
                    const hasFileAPI = typeof Blob !== 'undefined' && typeof URL !== 'undefined';
                    addTestResult('å¯¼å‡ºä¾èµ–æ£€æŸ¥', hasFileAPI, hasFileAPI ? 'æ‰€æœ‰ä¾èµ–å¯ç”¨' : 'ç¼ºå°‘å¿…è¦çš„File API');
                    
                    addTestResult('å¯¼å‡ºåŠŸèƒ½æµ‹è¯•', true, 'å¯¼å‡ºåŠŸèƒ½æ£€æŸ¥å®Œæˆ', 'æ‰€æœ‰æ£€æŸ¥é¡¹é€šè¿‡');
                    
                } catch (error) {
                    addTestResult('å¯¼å‡ºåŠŸèƒ½æµ‹è¯•', false, 'å¯¼å‡ºæµ‹è¯•å¤±è´¥', error.message);
                }
                
            } catch (error) {
                addTestResult('å¯¼å‡ºåŠŸèƒ½æµ‹è¯•', false, 'æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', error.message);
            }
        }
        
        // ä¸€é”®éªŒè¯æ‰€æœ‰åŠŸèƒ½
        async function quickVerifyAll() {
            clearTestResults();
            addTestResult('ä¸€é”®éªŒè¯', true, 'å¼€å§‹å…¨é¢åŠŸèƒ½éªŒè¯');
            
            try {
                // ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥
                const requiredAPIs = {
                    'JSON': typeof JSON !== 'undefined',
                    'localStorage': typeof localStorage !== 'undefined',
                    'Blob': typeof Blob !== 'undefined',
                    'URL': typeof URL !== 'undefined',
                    'document': typeof document !== 'undefined',
                    'window': typeof window !== 'undefined'
                };
                
                const availableAPIs = Object.keys(requiredAPIs).filter(key => requiredAPIs[key]);
                const missingAPIs = Object.keys(requiredAPIs).filter(key => !requiredAPIs[key]);
                
                addTestResult('ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥', missingAPIs.length === 0, 
                             missingAPIs.length === 0 ? 'æ‰€æœ‰å¿…è¦APIå¯ç”¨' : `ç¼ºå°‘${missingAPIs.length}ä¸ªAPI`,
                             `å¯ç”¨: ${availableAPIs.join(', ') || 'æ— '}`);
                
                // åŒæ­¥æ¨¡å—æ£€æŸ¥
                const syncModuleAvailable = !!window.crossDeviceSync;
                addTestResult('åŒæ­¥æ¨¡å—å¯ç”¨æ€§', syncModuleAvailable, 
                             syncModuleAvailable ? 'åŒæ­¥æ¨¡å—å·²åŠ è½½' : 'åŒæ­¥æ¨¡å—æœªåŠ è½½');
                
                if (syncModuleAvailable) {
                    // æ£€æŸ¥å¿…è¦æ–¹æ³•
                    const requiredMethods = [
                        'exportSyncData',
                        'importSyncData', 
                        'getSyncStatus',
                        'init',
                        'removeDuplicateQuestions'
                    ];
                    
                    const availableMethods = requiredMethods.filter(method => 
                        typeof window.crossDeviceSync[method] === 'function'
                    );
                    
                    addTestResult('åŒæ­¥æ–¹æ³•æ£€æŸ¥', availableMethods.length === requiredMethods.length,
                                 `${availableMethods.length}/${requiredMethods.length}ä¸ªæ–¹æ³•å¯ç”¨`,
                                 `ç¼ºå¤±: ${requiredMethods.filter(m => !availableMethods.includes(m)).join(', ') || 'æ— '}`);
                    
                    // æµ‹è¯•è®¾å¤‡ID
                    const deviceId = window.crossDeviceSync.deviceId;
                    addTestResult('è®¾å¤‡IDéªŒè¯', !!deviceId, 
                                 deviceId ? 'è®¾å¤‡IDæœ‰æ•ˆ' : 'è®¾å¤‡IDæ— æ•ˆ',
                                 `è®¾å¤‡ID: ${deviceId || 'æ— '}`);
                }
                
                // æ•°æ®ç»“æ„æ£€æŸ¥
                if (window.app) {
                    const requiredProperties = [
                        'publicQuestionBank',
                        'personalQuestionBank', 
                        'mistakeBank',
                        'studyStats'
                    ];
                    
                    const availableProperties = requiredProperties.filter(prop => 
                        window.app.hasOwnProperty(prop)
                    );
                    
                    addTestResult('åº”ç”¨æ•°æ®ç»“æ„', availableProperties.length === requiredProperties.length,
                                 `${availableProperties.length}/${requiredProperties.length}ä¸ªå±æ€§å¯ç”¨`,
                                 `ç¼ºå¤±: ${requiredProperties.filter(p => !availableProperties.includes(p)).join(', ') || 'æ— '}`);
                } else {
                    addTestResult('åº”ç”¨æ•°æ®ç»“æ„', false, 'åº”ç”¨å®ä¾‹æœªåˆå§‹åŒ–', 'window.appä¸å­˜åœ¨');
                }
                
                // ç”ŸæˆéªŒè¯æŠ¥å‘Š
                const passedTests = testResults.filter(r => r.success).length;
                const totalTests = testResults.length;
                const passRate = ((passedTests / totalTests) * 100).toFixed(1);
                
                addTestResult('éªŒè¯æ€»ç»“', passedTests === totalTests, 
                             `éªŒè¯å®Œæˆ - é€šè¿‡ç‡: ${passRate}%`,
                             `é€šè¿‡: ${passedTests}, å¤±è´¥: ${totalTests - passedTests}`);
                
                // æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
                if (passedTests === totalTests) {
                    addTestResult('ç³»ç»ŸçŠ¶æ€', true, 'ğŸ‰ æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ç³»ç»Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨',
                                 'æ™ºèƒ½åˆ·é¢˜ç³»ç»ŸåŠŸèƒ½å®Œæ•´ï¼Œä»£ç è´¨é‡è‰¯å¥½');
                } else {
                    addTestResult('ç³»ç»ŸçŠ¶æ€', false, 'âš ï¸ å‘ç°é—®é¢˜ï¼Œå»ºè®®ä¿®å¤åå†ä½¿ç”¨',
                                 `è¯·æ£€æŸ¥å¤±è´¥çš„æµ‹è¯•é¡¹å¹¶è¿›è¡Œä¿®å¤`);
                }
                
            } catch (error) {
                addTestResult('ä¸€é”®éªŒè¯', false, 'éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', error.message);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ›´æ–°ç³»ç»ŸçŠ¶æ€
            updateSystemStatus();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('testSyncBtn').addEventListener('click', testSyncFunctionality);
            document.getElementById('testDataBtn').addEventListener('click', testDataOperations);
            document.getElementById('testExportBtn').addEventListener('click', testExportFunctionality);
            document.getElementById('quickVerifyBtn').addEventListener('click', quickVerifyAll);
            
            // ç­‰å¾…åŒæ­¥æ¨¡å—åˆå§‹åŒ–
            setTimeout(() => {
                updateSystemStatus();
            }, 1000);
        });
    </script>
</body>
</html>