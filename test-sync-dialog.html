<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒæ­¥å¯¹è¯æ¡†æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        success: '#22c55e',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .btn {
                @apply px-4 py-2 rounded-lg font-medium transition-all duration-200;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-blue-600 active:bg-blue-700;
            }
            .btn-secondary {
                @apply bg-secondary text-white hover:bg-slate-600 active:bg-slate-700;
            }
            .btn-success {
                @apply bg-success text-white hover:bg-green-600 active:bg-green-700;
            }
            .btn-danger {
                @apply bg-danger text-white hover:bg-red-600 active:bg-red-700;
            }
            .card {
                @apply bg-white rounded-xl shadow-lg p-6 border border-gray-200;
            }
            .log-entry {
                @apply mb-1 text-sm font-mono;
            }
            .log-info {
                @apply text-blue-600;
            }
            .log-success {
                @apply text-green-600;
            }
            .log-warning {
                @apply text-yellow-600;
            }
            .log-error {
                @apply text-red-600;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ”„ åŒæ­¥å¯¹è¯æ¡†æµ‹è¯•</h1>
            <p class="text-gray-600">æµ‹è¯•æ•°æ®åŒæ­¥å¯¹è¯æ¡†ä¸­å¯¼å‡ºåŒæ­¥æ•°æ®æŒ‰é’®çš„åŠŸèƒ½</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- æ¨¡æ‹Ÿå¯¹è¯æ¡† -->
            <div class="card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ—‚ï¸ æ¨¡æ‹ŸåŒæ­¥å¯¹è¯æ¡†</h2>
                
                <!-- æ¨¡æ‹Ÿçš„Vueåº”ç”¨ -->
                <div id="app">
                    <!-- åŒæ­¥å¯¹è¯æ¡† -->
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-auto relative border border-gray-200 shadow-lg">
                        <!-- å³ä¸Šè§’å…³é—­æŒ‰é’® -->
                        <button class="absolute top-4 right-4 bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm hover:bg-red-600 transition-colors" @click="showSyncDialog = false">
                            âœ•
                        </button>
                        <h3 class="text-lg font-semibold mb-4 text-center pt-2">ğŸ”„ æ•°æ®åŒæ­¥</h3>
                        
                        <div class="mb-6">
                            <div class="text-center mb-4">
                                <div class="text-4xl mb-2">ğŸ“Š</div>
                                <div class="text-sm text-gray-600">å½“å‰åŒæ­¥çŠ¶æ€ï¼š{{ syncStatusText }}</div>
                            </div>
                            
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span>å…¬å…±é¢˜åº“ç‰ˆæœ¬ï¼š</span>
                                    <span class="font-medium">{{ publicBankVersion }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>ä¸ªäººé¢˜åº“å¤§å°ï¼š</span>
                                    <span>{{ formatBytes(personalBankSize) }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>æœ€ååŒæ­¥æ—¶é—´ï¼š</span>
                                    <span>{{ lastSyncTime || 'ä»æœª' }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-3 max-h-[50vh] overflow-y-auto overflow-x-hidden" style="touch-action: pan-y; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9;">
                            <button class="btn-primary w-full py-3" @click="syncData">
                                ğŸ”„ ç«‹å³åŒæ­¥
                            </button>
                            <button class="btn-secondary w-full py-3" @click="resolveConflicts">
                                âš¡ è§£å†³å†²çª
                            </button>
                            <div class="border-t border-gray-200 my-2 pt-2">
                                <div class="text-xs text-gray-500 text-center mb-2">è·¨è®¾å¤‡åŒæ­¥</div>
                            </div>
                            <button class="btn-secondary w-full py-3" @click="exportSyncData">
                                ğŸ“¤ å¯¼å‡ºåŒæ­¥æ•°æ®
                            </button>
                            <button class="btn-secondary w-full py-3" @click="importSyncData">
                                ğŸ“¥ å¯¼å…¥åŒæ­¥æ•°æ®
                            </button>
                            <button class="btn-secondary w-full py-3" @click="showSyncQRCode">
                                ğŸ“± æ‰«ç åŒæ­¥
                            </button>
                            <div class="border-t border-gray-200 my-2 pt-2">
                                <div class="text-xs text-gray-500 text-center mb-2">æ•°æ®ç®¡ç†</div>
                            </div>
                            <button class="btn-secondary w-full py-3" @click="exportData">
                                ğŸ’¾ å¯¼å‡ºæ•°æ®
                            </button>
                            <button class="btn-secondary w-full py-3" @click="importData">
                                ğŸ“¥ å¯¼å…¥æ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯Šæ–­é¢æ¿ -->
            <div class="card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ” è¯Šæ–­é¢æ¿</h2>
                <div class="space-y-4">
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">Vueåº”ç”¨çŠ¶æ€:</span>
                            <span id="vueAppStatus" class="text-lg font-bold text-green-600">âœ… å·²åˆå§‹åŒ–</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">å½“å‰ç”¨æˆ·:</span>
                            <span id="currentUserStatus" class="text-lg font-bold text-green-600">âœ… å·²ç™»å½•</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">è·¨è®¾å¤‡æ¨¡å—:</span>
                            <span id="syncModuleStatus" class="text-lg font-bold text-green-600">âœ… å·²åŠ è½½</span>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-700 mb-2">æœ€è¿‘æ“ä½œ:</h3>
                        <div id="recentActions" class="text-sm font-mono text-gray-600">
                            ç­‰å¾…ç”¨æˆ·æ“ä½œ...
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="testExportBtn" class="btn-primary w-full">
                            <i class="fa fa-play-circle mr-2"></i>æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
                        </button>
                        <button id="clearLogBtn" class="btn-danger w-full">
                            <i class="fa fa-trash mr-2"></i>æ¸…ç©ºæ—¥å¿—
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæ—¥å¿— -->
        <div class="mt-8 card">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-800">ğŸ“ æ“ä½œæ—¥å¿—</h2>
                <span id="logCount" class="text-sm text-gray-600">0 æ¡æ—¥å¿—</span>
            </div>
            <div class="bg-gray-900 text-gray-300 p-4 rounded-lg h-64 overflow-y-auto font-mono text-sm">
                <div id="logContainer"></div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿè·¨è®¾å¤‡åŒæ­¥æ¨¡å— -->
    <script>
        // æ¨¡æ‹Ÿ CrossDeviceSync ç±»
        class MockCrossDeviceSync {
            constructor() {
                this.deviceId = 'mock_device_' + Date.now();
                this.logger = window.logger;
                this.log('ğŸš€ æ¨¡æ‹Ÿè·¨è®¾å¤‡åŒæ­¥æ¨¡å—åˆå§‹åŒ–');
            }

            log(...messages) {
                if (this.logger) {
                    this.logger.info('[MockSync]', ...messages);
                } else {
                    console.log('[MockSync]', ...messages);
                }
            }

            // å¯¼å‡ºåŒæ­¥æ•°æ®
            async exportSyncData() {
                this.log('ğŸ“¤ å¼€å§‹å¯¼å‡ºåŒæ­¥æ•°æ®...');
                
                // ç”Ÿæˆæ¼”ç¤ºé¢˜ç›®
                const demoPublicQuestions = [
                    {
                        id: 'demo_pub_1',
                        content: 'HTML5ä¸­ç”¨äºå®šä¹‰æ–‡æ¡£ä¸»è¦å†…å®¹çš„æ ‡ç­¾æ˜¯ï¼š',
                        type: 'single',
                        options: ['<header>', '<main>', '<section>', '<article>'],
                        answer: '1',
                        analysis: '<main>æ ‡ç­¾å®šä¹‰æ–‡æ¡£çš„ä¸»è¦å†…å®¹ã€‚'
                    },
                    {
                        id: 'demo_pub_2',
                        content: 'CSSä¸­ï¼Œå“ªä¸ªå±æ€§ç”¨äºè®¾ç½®å…ƒç´ çš„å¤–è¾¹è·ï¼Ÿ',
                        type: 'single',
                        options: ['padding', 'border', 'margin', 'spacing'],
                        answer: '2',
                        analysis: 'marginå±æ€§ç”¨äºè®¾ç½®å…ƒç´ çš„å¤–è¾¹è·ã€‚'
                    }
                ];

                const demoPersonalQuestions = [
                    {
                        id: 'demo_per_1',
                        content: 'Vueç»„ä»¶çš„dataé€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚',
                        type: 'judge',
                        answer: 'true',
                        analysis: 'åœ¨Vueç»„ä»¶ä¸­ï¼Œdataé€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚'
                    }
                ];

                const data = {
                    deviceId: this.deviceId,
                    exportTime: new Date().toISOString(),
                    syncCount: demoPublicQuestions.length + demoPersonalQuestions.length,
                    publicQuestionCount: demoPublicQuestions.length,
                    personalQuestionCount: demoPersonalQuestions.length,
                    publicQuestions: demoPublicQuestions,
                    personalQuestions: demoPersonalQuestions,
                    deviceInfo: {
                        type: 'desktop',
                        browser: navigator.userAgent,
                        timestamp: Date.now()
                    }
                };

                this.log('ğŸ“Š å¯¼å‡ºæ•°æ®ç»Ÿè®¡:', {
                    publicQuestions: data.publicQuestionCount,
                    personalQuestions: data.personalQuestionCount,
                    total: data.syncCount
                });

                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `sync_data_${this.deviceId}_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.log('âœ… åŒæ­¥æ•°æ®å¯¼å‡ºå®Œæˆï¼');
                return data;
            }
        }

        // æ—¥å¿—ç³»ç»Ÿ
        class Logger {
            constructor() {
                this.logs = [];
                this.maxLogs = 100;
            }

            log(type, ...messages) {
                const timestamp = new Date().toLocaleTimeString('zh-CN');
                const logEntry = {
                    type,
                    timestamp,
                    messages: messages.map(msg => 
                        typeof msg === 'object' ? JSON.stringify(msg, null, 2) : msg
                    )
                };
                
                this.logs.push(logEntry);
                if (this.logs.length > this.maxLogs) {
                    this.logs.shift();
                }
                
                this.updateDisplay();
            }

            info(...messages) {
                this.log('info', ...messages);
            }

            success(...messages) {
                this.log('success', ...messages);
            }

            warning(...messages) {
                this.log('warning', ...messages);
            }

            error(...messages) {
                this.log('error', ...messages);
            }

            updateDisplay() {
                const logContainer = document.getElementById('logContainer');
                const logCount = document.getElementById('logCount');
                
                logCount.textContent = `${this.logs.length} æ¡æ—¥å¿—`;
                
                logContainer.innerHTML = this.logs.map(entry => {
                    const typeClass = `log-${entry.type}`;
                    const icon = {
                        info: 'â„¹ï¸',
                        success: 'âœ…',
                        warning: 'âš ï¸',
                        error: 'âŒ'
                    }[entry.type];
                    
                    return `
                        <div class="log-entry">
                            <span class="${typeClass}">[${entry.timestamp}] ${icon}</span>
                            ${entry.messages.join(' ')}
                        </div>
                    `;
                }).join('');
                
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            clear() {
                this.logs = [];
                this.updateDisplay();
            }
        }

        // åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
        window.logger = new Logger();

        // åˆå§‹åŒ–æ¨¡æ‹ŸåŒæ­¥æ¨¡å—
        window.crossDeviceSync = new MockCrossDeviceSync();

        // Vue åº”ç”¨
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    showSyncDialog: true,
                    syncStatus: 'synced',
                    publicBankVersion: '1.0',
                    personalBankSize: 2,
                    lastSyncTime: '2025/12/13 16:08:05',
                    currentUser: {
                        username: 'test_user',
                        id: 'user_123'
                    }
                }
            },
            computed: {
                syncStatusText() {
                    const statusMap = {
                        'synced': 'å·²åŒæ­¥',
                        'pending': 'å¾…åŒæ­¥',
                        'conflict': 'å†²çª',
                        'error': 'é”™è¯¯'
                    };
                    return statusMap[this.syncStatus] || 'æœªçŸ¥';
                }
            },
            methods: {
                // è·¨è®¾å¤‡åŒæ­¥åŠŸèƒ½
                exportSyncData() {
                    this.log('ğŸ“¤ å¼€å§‹å¯¼å‡ºåŒæ­¥æ•°æ®...');
                    
                    if (!this.currentUser) {
                        this.log('âŒ ç”¨æˆ·æœªç™»å½•');
                        alert('è¯·å…ˆç™»å½•åå†å¯¼å‡ºåŒæ­¥æ•°æ®ï¼');
                        return;
                    }
                    
                    this.log('âœ… ç”¨æˆ·å·²ç™»å½•:', this.currentUser.username);
                    
                    // æ£€æŸ¥è·¨è®¾å¤‡åŒæ­¥æ¨¡å—æ˜¯å¦åŠ è½½
                    if (window.crossDeviceSync) {
                        this.log('âœ… crossDeviceSyncæ¨¡å—å·²åŠ è½½');
                        try {
                            this.log('ğŸ”„ è°ƒç”¨exportSyncDataæ–¹æ³•...');
                            window.crossDeviceSync.exportSyncData();
                            this.log('âœ… å¯¼å‡ºåŒæ­¥æ•°æ®è°ƒç”¨æˆåŠŸï¼');
                        } catch (error) {
                            this.log('âŒ è°ƒç”¨exportSyncDataå¤±è´¥:', error.message);
                            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                            alert(`å¯¼å‡ºåŒæ­¥æ•°æ®å¤±è´¥ï¼\né”™è¯¯ä¿¡æ¯: ${error.message}`);
                        }
                    } else {
                        this.log('âš ï¸ crossDeviceSyncæ¨¡å—æœªåŠ è½½');
                        alert('è·¨è®¾å¤‡åŒæ­¥æ¨¡å—æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼');
                    }
                },
                
                syncData() {
                    this.log('ğŸ”„ æ‰§è¡ŒåŒæ­¥æ“ä½œ...');
                    alert('åŒæ­¥æ“ä½œå·²è§¦å‘ï¼');
                },
                
                resolveConflicts() {
                    this.log('âš¡ è§£å†³å†²çª...');
                    alert('å†²çªå·²è§£å†³ï¼');
                },
                
                importSyncData() {
                    this.log('ğŸ“¥ å¯¼å…¥åŒæ­¥æ•°æ®...');
                    alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„åŒæ­¥æ•°æ®æ–‡ä»¶ï¼');
                },
                
                showSyncQRCode() {
                    this.log('ğŸ“± æ˜¾ç¤ºæ‰«ç åŒæ­¥...');
                    alert('æ‰«ç åŒæ­¥åŠŸèƒ½å·²è§¦å‘ï¼');
                },
                
                exportData() {
                    this.log('ğŸ’¾ å¯¼å‡ºæ•°æ®...');
                    alert('æ•°æ®å¯¼å‡ºåŠŸèƒ½å·²è§¦å‘ï¼');
                },
                
                importData() {
                    this.log('ğŸ“¥ å¯¼å…¥æ•°æ®...');
                    alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ•°æ®æ–‡ä»¶ï¼');
                },
                
                formatBytes(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },
                
                log(...messages) {
                    if (window.logger) {
                        window.logger.info('[VueApp]', ...messages);
                    } else {
                        console.log('[VueApp]', ...messages);
                    }
                    
                    // æ›´æ–°æœ€è¿‘æ“ä½œ
                    this.updateRecentActions(...messages);
                },
                
                updateRecentActions(...messages) {
                    const recentActions = document.getElementById('recentActions');
                    const actionText = messages.map(msg => 
                        typeof msg === 'object' ? JSON.stringify(msg) : msg
                    ).join(' ');
                    
                    recentActions.innerHTML = `
                        <div class="mb-1"><span class="text-blue-600">â–¶</span> ${new Date().toLocaleTimeString()}: ${actionText}</div>
                        ${recentActions.innerHTML}
                    `;
                    
                    // é™åˆ¶æ˜¾ç¤ºçš„æ“ä½œæ•°é‡
                    const lines = recentActions.innerHTML.split('</div>');
                    if (lines.length > 6) {
                        recentActions.innerHTML = lines.slice(0, 5).join('</div>') + '</div>';
                    }
                }
            },
            
            mounted() {
                this.log('ğŸ¯ Vueåº”ç”¨å·²æŒ‚è½½');
                this.log('ğŸ“± åŒæ­¥å¯¹è¯æ¡†å·²æ˜¾ç¤º');
            }
        }).mount('#app');

        // æµ‹è¯•æŒ‰é’®äº‹ä»¶
        document.getElementById('testExportBtn').addEventListener('click', () => {
            if (window.logger) {
                window.logger.info('ğŸ¯ æ‰‹åŠ¨æµ‹è¯•å¯¼å‡ºåŠŸèƒ½...');
            }
            
            // ç›´æ¥è°ƒç”¨Vueåº”ç”¨çš„æ–¹æ³•
            const vueApp = document.querySelector('#app').__vue_app__;
            if (vueApp && vueApp._instance.proxy) {
                vueApp._instance.proxy.exportSyncData();
            } else {
                if (window.logger) {
                    window.logger.error('âŒ æ— æ³•è®¿é—®Vueåº”ç”¨å®ä¾‹');
                }
            }
        });

        // æ¸…ç©ºæ—¥å¿—æŒ‰é’®
        document.getElementById('clearLogBtn').addEventListener('click', () => {
            if (window.logger) {
                window.logger.clear();
                window.logger.info('ğŸ§¹ æ—¥å¿—å·²æ¸…ç©º');
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            if (window.logger) {
                window.logger.info('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
                window.logger.info('âœ… æ‰€æœ‰æ¨¡å—å·²åˆå§‹åŒ–');
            }
        });
    </script>
</body>
</html>