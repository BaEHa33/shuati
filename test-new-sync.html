<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°åŒæ­¥ç³»ç»Ÿæµ‹è¯• - æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .btn-primary {
            background-color: #07c160;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #06ad56;
        }
        .btn-secondary {
            background-color: #f7f8fa;
            color: #333;
            border: 1px solid #e5e6eb;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background-color: #f2f3f5;
            border-color: #dfe1e5;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-success {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .status-warning {
            background-color: #fef9c3;
            color: #854d0e;
        }
        .status-info {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 0.25rem;
            border-left: 4px solid;
        }
        .log-success {
            background-color: #f0fdf4;
            color: #166534;
            border-left-color: #22c55e;
        }
        .log-error {
            background-color: #fef2f2;
            color: #991b1b;
            border-left-color: #ef4444;
        }
        .log-warning {
            background-color: #fefce8;
            color: #92400e;
            border-left-color: #f59e0b;
        }
        .log-info {
            background-color: #f0f9ff;
            color: #0369a1;
            border-left-color: #0ea5e9;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">
                <i class="fa fa-refresh text-green-500 mr-3"></i>
                æ–°åŒæ­¥ç³»ç»Ÿæµ‹è¯•
            </h1>
            <p class="text-gray-600 mb-6">
                å…¨é¢é‡æ–°è®¾è®¡çš„åŒæ­¥ç³»ç»Ÿï¼Œæä¾›æ›´ç¨³å®šã€æ›´æ˜“ç”¨çš„æ•°æ®å¯¼å‡ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚
                æ”¯æŒå…¬å…±é¢˜åº“ã€ä¸ªäººé¢˜åº“ã€é”™é¢˜æœ¬å’Œå­¦ä¹ ç»Ÿè®¡çš„å®Œæ•´åŒæ­¥ã€‚
            </p>
            
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                        <i class="fa fa-server mr-2"></i>
                        åŒæ­¥ç®¡ç†å™¨çŠ¶æ€
                    </h3>
                    <div id="syncManagerStatus" class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">æ¨¡å—åŠ è½½:</span>
                            <span id="moduleStatus" class="status-badge status-error">æœªåŠ è½½</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">åˆå§‹åŒ–çŠ¶æ€:</span>
                            <span id="initStatus" class="status-badge status-error">æœªåˆå§‹åŒ–</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">è®¾å¤‡ID:</span>
                            <span id="deviceId" class="text-gray-600 font-mono text-sm">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-green-800 mb-3 flex items-center">
                        <i class="fa fa-user-circle mr-2"></i>
                        ç”¨æˆ·çŠ¶æ€
                    </h3>
                    <div id="userStatus" class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">ç™»å½•çŠ¶æ€:</span>
                            <span id="loginStatus" class="status-badge status-error">æœªç™»å½•</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">å½“å‰ç”¨æˆ·:</span>
                            <span id="currentUser" class="text-gray-600">--</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">ç”¨æˆ·ID:</span>
                            <span id="userId" class="text-gray-600 font-mono text-sm">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-purple-800 mb-3 flex items-center">
                        <i class="fa fa-database mr-2"></i>
                        æ•°æ®ç»Ÿè®¡
                    </h3>
                    <div id="dataStats" class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">å…¬å…±é¢˜åº“:</span>
                            <span id="publicBankCount" class="text-gray-600">0 é¢˜</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">ä¸ªäººé¢˜åº“:</span>
                            <span id="personalBankCount" class="text-gray-600">0 é¢˜</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">é”™é¢˜æœ¬:</span>
                            <span id="mistakeBankCount" class="text-gray-600">0 æ¡</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-user mr-2"></i>
                        ç”¨æˆ·æ§åˆ¶
                    </h3>
                    <div class="space-y-3">
                        <button id="loginBtn" class="btn-primary w-full py-3 flex items-center justify-center">
                            <i class="fa fa-sign-in mr-2"></i>
                            æ¨¡æ‹Ÿç™»å½•
                        </button>
                        <button id="logoutBtn" class="btn-secondary w-full py-3 flex items-center justify-center" disabled>
                            <i class="fa fa-sign-out mr-2"></i>
                            é€€å‡ºç™»å½•
                        </button>
                        <button id="checkStatusBtn" class="btn-secondary w-full py-3 flex items-center justify-center">
                            <i class="fa fa-refresh mr-2"></i>
                            æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-exchange mr-2"></i>
                        åŒæ­¥åŠŸèƒ½
                    </h3>
                    <div class="space-y-3">
                        <button id="exportBtn" class="btn-primary w-full py-3 flex items-center justify-center" disabled>
                            <i class="fa fa-download mr-2"></i>
                            å¯¼å‡ºæ•°æ®
                        </button>
                        <button id="importBtn" class="btn-secondary w-full py-3 flex items-center justify-center" disabled>
                            <i class="fa fa-upload mr-2"></i>
                            å¯¼å…¥æ•°æ®
                        </button>
                        <button id="qrcodeBtn" class="btn-secondary w-full py-3 flex items-center justify-center" disabled>
                            <i class="fa fa-qrcode mr-2"></i>
                            æ‰«ç åŒæ­¥
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å¯¼å‡ºé€‰é¡¹ -->
            <div id="exportOptions" class="bg-gray-50 rounded-lg p-6 mb-8 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-cog mr-2"></i>
                    å¯¼å‡ºé€‰é¡¹
                </h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="includePublic" class="w-4 h-4 text-green-600 rounded" checked>
                        <label for="includePublic" class="ml-2 text-gray-700">åŒ…å«å…¬å…±é¢˜åº“</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="includePersonal" class="w-4 h-4 text-green-600 rounded" checked>
                        <label for="includePersonal" class="ml-2 text-gray-700">åŒ…å«ä¸ªäººé¢˜åº“</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="includeMistakes" class="w-4 h-4 text-green-600 rounded" checked>
                        <label for="includeMistakes" class="ml-2 text-gray-700">åŒ…å«é”™é¢˜æœ¬</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="includeStats" class="w-4 h-4 text-green-600 rounded" checked>
                        <label for="includeStats" class="ml-2 text-gray-700">åŒ…å«å­¦ä¹ ç»Ÿè®¡</label>
                    </div>
                    <div class="pt-4">
                        <button id="confirmExportBtn" class="btn-primary w-full py-3">
                            <i class="fa fa-check mr-2"></i>
                            ç¡®è®¤å¯¼å‡º
                        </button>
                        <button id="cancelExportBtn" class="btn-secondary w-full py-3 mt-3">
                            <i class="fa fa-times mr-2"></i>
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-terminal mr-2"></i>
                    ç³»ç»Ÿæ—¥å¿—
                    <button id="clearLogBtn" class="ml-auto btn-secondary text-sm px-3 py-1">
                        <i class="fa fa-trash mr-1"></i>
                        æ¸…ç©º
                    </button>
                </h3>
                <div id="systemLog" class="max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                    <div class="log-info">ğŸŸ¢ é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…ç³»ç»Ÿåˆå§‹åŒ–...</div>
                </div>
            </div>
            
            <!-- å¯¼å‡ºæ•°æ®é¢„è§ˆ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-file-text mr-2"></i>
                    æ•°æ®é¢„è§ˆ
                    <button id="generatePreviewBtn" class="ml-auto btn-secondary text-sm px-3 py-1" disabled>
                        <i class="fa fa-refresh mr-1"></i>
                        ç”Ÿæˆé¢„è§ˆ
                    </button>
                </h3>
                <div id="dataPreview" class="max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                    <div class="text-gray-500 text-center py-8">
                        <i class="fa fa-file-o text-4xl mb-2"></i>
                        <p>ç‚¹å‡»"ç”Ÿæˆé¢„è§ˆ"æŸ¥çœ‹æ•°æ®ç»“æ„</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ—¥å¿—ç³»ç»Ÿ
        class Logger {
            constructor() {
                this.logContainer = document.getElementById('systemLog');
                this.maxEntries = 100;
            }
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString('zh-CN');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                
                // æ·»åŠ åˆ°å®¹å™¨
                this.logContainer.appendChild(logEntry);
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                const entries = this.logContainer.querySelectorAll('.log-entry');
                if (entries.length > this.maxEntries) {
                    this.logContainer.removeChild(entries[0]);
                }
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
            }
            
            success(message) {
                this.log(`âœ… ${message}`, 'success');
            }
            
            error(message) {
                this.log(`âŒ ${message}`, 'error');
            }
            
            warning(message) {
                this.log(`âš ï¸ ${message}`, 'warning');
            }
            
            info(message) {
                this.log(`â„¹ï¸ ${message}`, 'info');
            }
            
            clear() {
                this.logContainer.innerHTML = '';
                this.info('æ—¥å¿—å·²æ¸…ç©º');
            }
        }
        
        const logger = new Logger();
        
        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
        let mockCurrentUser = null;
        
        // æ¨¡æ‹Ÿåº”ç”¨æ•°æ®
        const mockAppData = {
            publicQuestionBank: [
                {
                    id: 'pub_1',
                    content: 'HTML5ä¸­ç”¨äºå®šä¹‰æ–‡æ¡£ä¸»è¦å†…å®¹çš„æ ‡ç­¾æ˜¯ï¼š',
                    type: 'single',
                    options: ['<header>', '<main>', '<section>', '<article>'],
                    answer: '1',
                    analysis: '<main>æ ‡ç­¾å®šä¹‰æ–‡æ¡£çš„ä¸»è¦å†…å®¹ã€‚',
                    source: 'system',
                    createTime: new Date().toISOString(),
                    difficulty: 2,
                    category: 'HTML5',
                    tags: ['HTML', 'è¯­ä¹‰åŒ–æ ‡ç­¾']
                },
                {
                    id: 'pub_2',
                    content: 'CSSä¸­ï¼Œå“ªä¸ªå±æ€§ç”¨äºè®¾ç½®å…ƒç´ çš„å¤–è¾¹è·ï¼Ÿ',
                    type: 'single',
                    options: ['padding', 'border', 'margin', 'spacing'],
                    answer: '2',
                    analysis: 'marginå±æ€§ç”¨äºè®¾ç½®å…ƒç´ çš„å¤–è¾¹è·ã€‚',
                    source: 'system',
                    createTime: new Date().toISOString(),
                    difficulty: 1,
                    category: 'CSSåŸºç¡€',
                    tags: ['CSS', 'ç›’æ¨¡å‹']
                }
            ],
            personalQuestionBank: [
                {
                    id: 'per_1',
                    content: 'Vueç»„ä»¶çš„dataé€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚',
                    type: 'judge',
                    answer: 'true',
                    analysis: 'åœ¨Vueç»„ä»¶ä¸­ï¼Œdataé€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚',
                    source: 'user',
                    createTime: new Date().toISOString(),
                    difficulty: 2,
                    category: 'Vue',
                    tags: ['Vue', 'ç»„ä»¶']
                }
            ],
            mistakeBank: [
                {
                    id: 'mistake_1',
                    questionId: 'pub_1',
                    content: 'HTML5ä¸­ç”¨äºå®šä¹‰æ–‡æ¡£ä¸»è¦å†…å®¹çš„æ ‡ç­¾æ˜¯ï¼š',
                    userAnswer: '0',
                    correctAnswer: '1',
                    mistakeTime: new Date().toISOString(),
                    isImportant: false
                }
            ],
            studyStats: {
                totalQuestions: 150,
                correctAnswers: 120,
                totalStudyTime: 3600,
                examRecords: [
                    {
                        id: 'exam_1',
                        score: 85,
                        totalQuestions: 20,
                        correctCount: 17,
                        duration: 1800,
                        date: new Date().toISOString()
                    }
                ]
            }
        };
        
        // æ¨¡æ‹ŸVueåº”ç”¨
        const mockApp = {
            currentUser: null,
            publicQuestionBank: [...mockAppData.publicQuestionBank],
            personalQuestionBank: [...mockAppData.personalQuestionBank],
            mistakeBank: [...mockAppData.mistakeBank],
            studyStats: { ...mockAppData.studyStats },
            syncStatus: 'synced',
            lastSyncTime: new Date().toISOString(),
            
            saveUserData() {
                logger.success('ç”¨æˆ·æ•°æ®å·²ä¿å­˜');
            },
            
            updateBankStats() {
                logger.info('é¢˜åº“ç»Ÿè®¡å·²æ›´æ–°');
            }
        };
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
        function updateSystemStatus() {
            logger.info('æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º...');
            
            // åŒæ­¥ç®¡ç†å™¨çŠ¶æ€
            const moduleStatus = document.getElementById('moduleStatus');
            const initStatus = document.getElementById('initStatus');
            const deviceId = document.getElementById('deviceId');
            
            if (window.syncManager) {
                moduleStatus.textContent = 'å·²åŠ è½½';
                moduleStatus.className = 'status-badge status-success';
                
                initStatus.textContent = window.syncManager.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–';
                initStatus.className = window.syncManager.isInitialized ? 'status-badge status-success' : 'status-badge status-warning';
                
                deviceId.textContent = window.syncManager.deviceId || '--';
                
                logger.success('SyncManageræ¨¡å—çŠ¶æ€å·²æ›´æ–°');
            } else {
                moduleStatus.textContent = 'æœªåŠ è½½';
                moduleStatus.className = 'status-badge status-error';
                initStatus.textContent = 'æœªåˆå§‹åŒ–';
                initStatus.className = 'status-badge status-error';
                deviceId.textContent = '--';
                
                logger.warning('SyncManageræ¨¡å—æœªåŠ è½½');
            }
            
            // ç”¨æˆ·çŠ¶æ€
            const loginStatus = document.getElementById('loginStatus');
            const currentUser = document.getElementById('currentUser');
            const userId = document.getElementById('userId');
            
            if (mockCurrentUser) {
                loginStatus.textContent = 'å·²ç™»å½•';
                loginStatus.className = 'status-badge status-success';
                currentUser.textContent = mockCurrentUser.username;
                userId.textContent = mockCurrentUser.id;
            } else {
                loginStatus.textContent = 'æœªç™»å½•';
                loginStatus.className = 'status-badge status-error';
                currentUser.textContent = '--';
                userId.textContent = '--';
            }
            
            // æ•°æ®ç»Ÿè®¡
            document.getElementById('publicBankCount').textContent = `${mockApp.publicQuestionBank.length} é¢˜`;
            document.getElementById('personalBankCount').textContent = `${mockApp.personalQuestionBank.length} é¢˜`;
            document.getElementById('mistakeBankCount').textContent = `${mockApp.mistakeBank.length} æ¡`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonStates();
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStates() {
            const exportBtn = document.getElementById('exportBtn');
            const importBtn = document.getElementById('importBtn');
            const qrcodeBtn = document.getElementById('qrcodeBtn');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const generatePreviewBtn = document.getElementById('generatePreviewBtn');
            
            const isLoggedIn = !!mockCurrentUser;
            const isSyncManagerReady = window.syncManager && window.syncManager.isInitialized;
            
            exportBtn.disabled = !isLoggedIn || !isSyncManagerReady;
            importBtn.disabled = !isLoggedIn || !isSyncManagerReady;
            qrcodeBtn.disabled = !isLoggedIn;
            loginBtn.disabled = isLoggedIn;
            logoutBtn.disabled = !isLoggedIn;
            generatePreviewBtn.disabled = !isLoggedIn || !isSyncManagerReady;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            [exportBtn, importBtn, qrcodeBtn, generatePreviewBtn].forEach(btn => {
                if (btn.disabled) {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 max-w-xs p-4 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out`;
            
            switch (type) {
                case 'success':
                    notification.style.backgroundColor = '#f0fdf4';
                    notification.style.borderLeft = '4px solid #22c55e';
                    break;
                case 'error':
                    notification.style.backgroundColor = '#fef2f2';
                    notification.style.borderLeft = '4px solid #ef4444';
                    break;
                case 'warning':
                    notification.style.backgroundColor = '#fefce8';
                    notification.style.borderLeft = '4px solid #f59e0b';
                    break;
                default:
                    notification.style.backgroundColor = '#f0f9ff';
                    notification.style.borderLeft = '4px solid #0ea5e9';
            }
            
            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-shrink-0 mt-0.5">
                        <i class="fa fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} text-${type === 'success' ? 'green' : type === 'error' ? 'red' : type === 'warning' ? 'amber' : 'blue'}-500 text-lg"></i>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-900">${message.replace(/\n/g, '<br>')}</p>
                    </div>
                    <button class="ml-4 text-gray-400 hover:text-gray-600 focus:outline-none" onclick="this.closest('.fixed').remove()">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // ç”Ÿæˆæ•°æ®é¢„è§ˆ
        function generateDataPreview() {
            logger.info('ç”Ÿæˆæ•°æ®é¢„è§ˆ...');
            
            const dataPreview = document.getElementById('dataPreview');
            
            if (!window.syncManager || !mockCurrentUser) {
                dataPreview.innerHTML = `
                    <div class="text-red-500 text-center py-8">
                        <i class="fa fa-exclamation-circle text-4xl mb-2"></i>
                        <p>æ— æ³•ç”Ÿæˆé¢„è§ˆï¼Œè¯·ç¡®ä¿å·²ç™»å½•ä¸”åŒæ­¥æ¨¡å—å·²åŠ è½½</p>
                    </div>
                `;
                return;
            }
            
            try {
                // å‡†å¤‡é¢„è§ˆæ•°æ®
                const previewData = {
                    version: window.syncManager.version,
                    deviceId: window.syncManager.deviceId,
                    exportTime: new Date().toISOString(),
                    userId: mockCurrentUser.id,
                    username: mockCurrentUser.username,
                    dataTypes: ['publicQuestions', 'personalQuestions', 'mistakeBank', 'studyStats'],
                    stats: {
                        publicQuestions: mockApp.publicQuestionBank.length,
                        personalQuestions: mockApp.personalQuestionBank.length,
                        mistakes: mockApp.mistakeBank.length,
                        totalQuestions: mockApp.publicQuestionBank.length + mockApp.personalQuestionBank.length
                    },
                    // åªæ˜¾ç¤ºéƒ¨åˆ†æ•°æ®ç”¨äºé¢„è§ˆ
                    publicQuestions_sample: mockApp.publicQuestionBank.slice(0, 1),
                    personalQuestions_sample: mockApp.personalQuestionBank.slice(0, 1),
                    mistakeBank_sample: mockApp.mistakeBank.slice(0, 1),
                    studyStats_summary: {
                        totalQuestions: mockApp.studyStats.totalQuestions,
                        correctAnswers: mockApp.studyStats.correctAnswers,
                        examRecords: mockApp.studyStats.examRecords.length
                    }
                };
                
                const jsonString = JSON.stringify(previewData, null, 2);
                dataPreview.innerHTML = `
                    <pre class="text-sm text-gray-800 whitespace-pre-wrap">${jsonString}</pre>
                    <div class="mt-3 text-xs text-gray-500 text-center">
                        è¿™æ˜¯å¯¼å‡ºæ•°æ®çš„é¢„è§ˆï¼Œå®é™…å¯¼å‡ºå°†åŒ…å«å®Œæ•´æ•°æ®
                    </div>
                `;
                
                logger.success('æ•°æ®é¢„è§ˆç”ŸæˆæˆåŠŸ');
            } catch (error) {
                logger.error(`ç”Ÿæˆé¢„è§ˆå¤±è´¥: ${error.message}`);
                dataPreview.innerHTML = `
                    <div class="text-red-500 text-center py-8">
                        <i class="fa fa-exclamation-triangle text-4xl mb-2"></i>
                        <p>ç”Ÿæˆé¢„è§ˆæ—¶å‡ºé”™: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // åˆå§‹åŒ–åŒæ­¥ç®¡ç†å™¨
        async function initializeSyncManager() {
            logger.info('å°è¯•åˆå§‹åŒ–SyncManager...');
            
            if (window.syncManager) {
                try {
                    const success = await window.syncManager.initialize();
                    if (success) {
                        logger.success('SyncManageråˆå§‹åŒ–æˆåŠŸ');
                        showNotification('åŒæ­¥ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    } else {
                        logger.error('SyncManageråˆå§‹åŒ–å¤±è´¥');
                        showNotification('åŒæ­¥ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥', 'error');
                    }
                } catch (error) {
                    logger.error(`SyncManageråˆå§‹åŒ–å¼‚å¸¸: ${error.message}`);
                    showNotification(`åŒæ­¥ç³»ç»Ÿåˆå§‹åŒ–å¼‚å¸¸: ${error.message}`, 'error');
                }
            } else {
                logger.warning('SyncManageræ¨¡å—æœªåŠ è½½');
                showNotification('åŒæ­¥æ¨¡å—æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'warning');
            }
            
            updateSystemStatus();
        }
        
        // äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
        function setupEventListeners() {
            logger.info('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
            
            // ç™»å½•æŒ‰é’®
            document.getElementById('loginBtn').addEventListener('click', () => {
                const username = prompt('è¯·è¾“å…¥ç”¨æˆ·å:', 'test_user');
                if (username && username.trim()) {
                    mockCurrentUser = {
                        id: 'user_' + username.trim(),
                        username: username.trim()
                    };
                    mockApp.currentUser = mockCurrentUser;
                    updateSystemStatus();
                    logger.success(`ç”¨æˆ· ${username} ç™»å½•æˆåŠŸ`);
                    showNotification(`æ¬¢è¿å›æ¥ï¼Œ${username}ï¼`, 'success');
                }
            });
            
            // é€€å‡ºç™»å½•æŒ‰é’®
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                    mockCurrentUser = null;
                    mockApp.currentUser = null;
                    updateSystemStatus();
                    logger.info('ç”¨æˆ·å·²é€€å‡ºç™»å½•');
                    showNotification('å·²é€€å‡ºç™»å½•', 'info');
                }
            });
            
            // æ£€æŸ¥çŠ¶æ€æŒ‰é’®
            document.getElementById('checkStatusBtn').addEventListener('click', () => {
                logger.info('æ‰‹åŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...');
                updateSystemStatus();
                initializeSyncManager();
            });
            
            // å¯¼å‡ºæŒ‰é’®
            document.getElementById('exportBtn').addEventListener('click', () => {
                document.getElementById('exportOptions').classList.remove('hidden');
                logger.info('æ˜¾ç¤ºå¯¼å‡ºé€‰é¡¹');
            });
            
            // ç¡®è®¤å¯¼å‡ºæŒ‰é’®
            document.getElementById('confirmExportBtn').addEventListener('click', async () => {
                const includePublic = document.getElementById('includePublic').checked;
                const includePersonal = document.getElementById('includePersonal').checked;
                const includeMistakes = document.getElementById('includeMistakes').checked;
                const includeStats = document.getElementById('includeStats').checked;
                
                document.getElementById('exportOptions').classList.add('hidden');
                
                if (!window.syncManager) {
                    logger.error('SyncManageræœªåŠ è½½');
                    showNotification('åŒæ­¥æ¨¡å—æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                    return;
                }
                
                try {
                    logger.info('å¼€å§‹å¯¼å‡ºæ•°æ®...');
                    showNotification('æ­£åœ¨å¯¼å‡ºæ•°æ®ï¼Œè¯·ç¨å€™...', 'info');
                    
                    await window.syncManager.exportData({
                        includePublic,
                        includePersonal,
                        includeMistakes,
                        includeStats
                    });
                    
                    logger.success('æ•°æ®å¯¼å‡ºæˆåŠŸ');
                    showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½', 'success');
                } catch (error) {
                    logger.error(`å¯¼å‡ºå¤±è´¥: ${error.message}`);
                    showNotification(`å¯¼å‡ºå¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            // å–æ¶ˆå¯¼å‡ºæŒ‰é’®
            document.getElementById('cancelExportBtn').addEventListener('click', () => {
                document.getElementById('exportOptions').classList.add('hidden');
                logger.info('å¯¼å‡ºæ“ä½œå·²å–æ¶ˆ');
            });
            
            // å¯¼å…¥æŒ‰é’®
            document.getElementById('importBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.style.cssText = 'position: fixed; top: -9999px; left: -9999px;';
                document.body.appendChild(input);
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            logger.info(`å¼€å§‹å¯¼å…¥æ–‡ä»¶: ${file.name}`);
                            showNotification('æ­£åœ¨å¯¼å…¥æ•°æ®ï¼Œè¯·ç¨å€™...', 'info');
                            
                            if (!window.syncManager) {
                                throw new Error('åŒæ­¥æ¨¡å—æœªåŠ è½½');
                            }
                            
                            const results = await window.syncManager.importData(file);
                            
                            if (results.success) {
                                logger.success('æ•°æ®å¯¼å…¥æˆåŠŸ');
                                let message = 'æ•°æ®å¯¼å…¥æˆåŠŸï¼\n';
                                if (results.imported.publicQuestions) {
                                    message += `- å…¬å…±é¢˜åº“: ${results.imported.publicQuestions} é¢˜\n`;
                                }
                                if (results.imported.personalQuestions) {
                                    message += `- ä¸ªäººé¢˜åº“: ${results.imported.personalQuestions} é¢˜\n`;
                                }
                                if (results.imported.mistakes) {
                                    message += `- é”™é¢˜æœ¬: ${results.imported.mistakes} æ¡\n`;
                                }
                                if (results.imported.studyStats) {
                                    message += `- å­¦ä¹ ç»Ÿè®¡: å·²æ›´æ–°\n`;
                                }
                                showNotification(message, 'success');
                                
                                // æ›´æ–°æ˜¾ç¤º
                                updateSystemStatus();
                            } else {
                                logger.warning('æ•°æ®å¯¼å…¥éƒ¨åˆ†å¤±è´¥');
                                showNotification(`å¯¼å…¥å®Œæˆï¼Œä½†æœ‰éƒ¨åˆ†é”™è¯¯:\n${results.errors.join('\\n')}`, 'warning');
                            }
                        } catch (error) {
                            logger.error(`å¯¼å…¥å¤±è´¥: ${error.message}`);
                            showNotification(`å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                        } finally {
                            document.body.removeChild(input);
                        }
                    }
                };
                
                input.click();
            });
            
            // æ‰«ç åŒæ­¥æŒ‰é’®
            document.getElementById('qrcodeBtn').addEventListener('click', () => {
                showNotification('æ‰«ç åŒæ­¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œè¯·ä½¿ç”¨å¯¼å‡º/å¯¼å…¥åŠŸèƒ½è¿›è¡Œæ•°æ®åŒæ­¥', 'info');
            });
            
            // æ¸…ç©ºæ—¥å¿—æŒ‰é’®
            document.getElementById('clearLogBtn').addEventListener('click', () => {
                logger.clear();
            });
            
            // ç”Ÿæˆé¢„è§ˆæŒ‰é’®
            document.getElementById('generatePreviewBtn').addEventListener('click', () => {
                generateDataPreview();
            });
            
            logger.success('æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logger.info('é¡µé¢DOMåŠ è½½å®Œæˆ');
            
            // è®¾ç½®å…¨å±€åº”ç”¨å®ä¾‹
            window.app = mockApp;
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // åˆå§‹æ›´æ–°çŠ¶æ€
            updateSystemStatus();
            
            // å°è¯•åˆå§‹åŒ–åŒæ­¥ç®¡ç†å™¨
            setTimeout(() => {
                initializeSyncManager();
            }, 1000);
            
            // å®šæœŸæ£€æŸ¥çŠ¶æ€
            setInterval(() => {
                if (window.syncManager && !window.syncManager.isInitialized) {
                    initializeSyncManager();
                }
                updateSystemStatus();
            }, 5000);
            
            logger.success('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>