<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ - é«˜æ•ˆå­¦ä¹ åŠ©æ‰‹</title>
    <!-- æ ¸å¿ƒåº“ CDN å¼•å…¥ -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        :root {
            --primary: #07c160;
            --primary-light: #19be6b;
            --secondary: #f5f5f5;
            --accent: #ff6900;
            --danger: #fa5151;
            --success: #19be6b;
            --text-primary: #333333;
            --text-secondary: #666666;
            --bg-white: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --public-color: #3b82f6;
            --personal-color: #10b981;
        }
        * {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
        }
        .card {
            background: var(--bg-white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-primary:hover {
            background: var(--primary-light);
            transform: scale(1.02);
        }
        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-danger:hover {
            background: #e64545;
            transform: scale(1.02);
        }
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .nav-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .nav-tab.active {
            background: var(--primary);
            color: white;
        }
        .nav-tab:hover:not(.active) {
            background: var(--secondary);
        }
        .question-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .question-option:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        .question-option.selected {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        .question-option.correct {
            border-color: var(--success);
            background: rgba(25, 190, 107, 0.1);
        }
        .question-option.wrong {
            border-color: var(--danger);
            background: rgba(250, 81, 81, 0.1);
        }
        .question-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .slider-container {
            position: relative;
            margin: 20px 0;
        }
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            transition: all 0.3s ease;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.5);
        }
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        .file-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .slide-enter-active, .slide-leave-active {
            transition: all 0.3s ease;
        }
        .slide-enter-from {
            transform: translateX(100px);
            opacity: 0;
        }
        .slide-leave-to {
            transform: translateX(-100px);
            opacity: 0;
        }
        @media (max-width: 768px) {
            .mobile-full {
                width: 100%;
                margin: 8px 0;
            }
            .mobile-stack {
                flex-direction: column;
            }
            .mobile-padding {
                padding: 16px;
            }
            /* ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ ·å¼ */
            .bottom-nav button.active {
                color: #07c160;
                background: rgba(7, 193, 96, 0.1);
            }
            /* ç§»åŠ¨ç«¯å†…å®¹åŒºåŸŸåº•éƒ¨é—´è· */
            body {
                padding-bottom: 80px;
            }
            /* ç§»åŠ¨ç«¯å¯¹è¯æ¡†æ ·å¼ä¼˜åŒ– */
            .mobile-dialog {
                margin: 16px;
                max-height: calc(100vh - 32px);
            }
        }
        /* åº•éƒ¨å¯¼èˆªæ¿€æ´»çŠ¶æ€ */
        .bottom-nav button.active {
            color: #07c160;
        }
        /* ç­”æ¡ˆæ˜¾ç¤ºæ ·å¼ */
        .answer-show {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
        .answer-correct {
            background: #f0fdf4;
            border-color: #16a34a;
        }
        .answer-wrong {
            background: #fef2f2;
            border-color: #dc2626;
        }
        .real-time-answer {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
        }
        @media (max-width: 768px) {
            .real-time-answer {
                position: fixed;
                bottom: 80px;
                top: auto;
                right: 10px;
                left: 10px;
                transform: none;
                max-width: none;
            }
        }
        /* æ ¼å¼è¯´æ˜æ ·å¼ */
        .format-sample {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        /* è€ƒè¯•æ¨¡å¼æ ·å¼ */
        .exam-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .exam-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 20px;
        }
        .exam-timer {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px 16px;
            display: inline-block;
        }
        .question-number {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        .answer-card {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }
        .answer-card-item {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .answer-card-item:hover {
            transform: scale(1.05);
        }
        .answer-card-item.current {
            border: 3px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.2);
        }
        .answer-card-item.answered {
            background: var(--success);
            color: white;
        }
        .answer-card-item.unanswered {
            background: #f3f4f6;
            color: #6b7280;
        }
        .answer-card-item.marked {
            background: var(--accent);
            color: white;
        }
        .answer-card-item.wrong {
            background: var(--danger);
            color: white;
        }
        /* å¡«ç©ºé¢˜æ ·å¼ */
        .fill-input {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s ease;
        }
        .fill-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        /* ç®€ç­”é¢˜æ ·å¼ */
        .essay-textarea {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            font-size: 16px;
            width: 100%;
            min-height: 200px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        .essay-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        /* é…ç½®è¡¨å•æ ·å¼ */
        .config-form label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-primary);
        }
        .config-form input[type="number"],
        .config-form input[type="text"],
        .config-form select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .config-form input[type="number"]:focus,
        .config-form input[type="text"]:focus,
        .config-form select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        .config-tip {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 12px 16px;
            margin: 12px 0;
            border-radius: 4px;
        }
        .config-tip h4 {
            color: #0369a1;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .config-tip p {
            color: #0c4a6e;
            font-size: 14px;
        }
        /* è€ƒè¯•ç»“æœæ ·å¼ */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        .result-score {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
        }
        .result-grade {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 32px;
        }
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .result-stat-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
        }
        .result-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .result-stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .result-grade.excellent { color: #16a34a; }
        .result-grade.good { color: #2563eb; }
        .result-grade.average { color: #d97706; }
        .result-grade.poor { color: #dc2626; }
        
        /* æ–°å¢ï¼šé¢˜åº“æ¥æºæ ‡ç­¾ */
        .source-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .source-badge.public {
            background: rgba(59, 130, 246, 0.1);
            color: var(--public-color);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .source-badge.personal {
            background: rgba(16, 185, 129, 0.1);
            color: var(--personal-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        /* æ–°å¢ï¼šé¢˜åº“åˆ‡æ¢æ ‡ç­¾é¡µ */
        .bank-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }
        .bank-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .bank-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        .bank-tab:hover:not(.active) {
            background: #f9fafb;
        }
        
        /* æ–°å¢ï¼šåŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .sync-indicator.synced {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        .sync-indicator.unsynced {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }
        .sync-indicator.conflict {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        /* æ–°å¢ï¼šç‰ˆæœ¬ä¿¡æ¯ */
        .version-info {
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            margin-top: 20px;
        }
        
        /* æ–°å¢ï¼šæ“ä½œæŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .action-button {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .action-button.primary {
            background: var(--primary);
            color: white;
        }
        .action-button.secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border-color: #e5e7eb;
        }
        .action-button.danger {
            background: var(--danger);
            color: white;
        }
        .action-button:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-green-600">ğŸ“š æ™ºèƒ½åˆ·é¢˜</div>
                        <div v-if="currentUser" class="sync-indicator" :class="syncStatusClass">
                            <span v-if="syncStatus === 'synced'">âœ“</span>
                            <span v-else-if="syncStatus === 'unsynced'">âš </span>
                            <span v-else-if="syncStatus === 'conflict'">âš¡</span>
                            {{ syncStatusText }}
                        </div>
                    </div>
                    <div class="hidden md:flex space-x-2">
                        <div class="nav-tab" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                            é¦–é¡µ
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                            è€ƒè¯•
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                            é”™é¢˜
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'records'}" @click="switchMode('records')">
                            è€ƒè¯•è®°å½•
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                            ç®¡ç†
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button class="btn-secondary text-sm" @click="showSyncDialog = true">
                            ğŸ”„ åŒæ­¥
                        </button>
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" v-if="!currentUser">
                            <span class="text-green-600 text-sm cursor-pointer" @click="showLoginDialog = true">ğŸ‘¤</span>
                        </div>
                        <div class="flex items-center space-x-2" v-else>
                            <span class="text-sm text-gray-600">{{ currentUser.username }}</span>
                            <button class="text-red-600 text-sm" @click="logout">é€€å‡º</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="max-w-6xl mx-auto px-4 py-6">
            <!-- é¦–é¡µæ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'home'" key="home">
                    <!-- Hero åŒºåŸŸ -->
                    <div class="hero-bg rounded-2xl p-8 mb-8 relative">
                        <div class="relative z-10">
                            <h1 class="text-4xl font-bold text-white mb-4">
                                æ™ºèƒ½åˆ·é¢˜ï¼Œé«˜æ•ˆå­¦ä¹ 
                            </h1>
                            <p class="text-xl text-white mb-6">
                                æ”¯æŒå¤šç§é¢˜å‹ç»ƒä¹ ï¼Œæ”¯æŒå¯¼å…¥é¢˜åº“ï¼Œè®©å­¦ä¹ æ›´ç®€å•
                            </p>
                            <div class="flex flex-wrap gap-4">
                                <button class="btn-primary bg-white text-green-600 hover:bg-gray-100" @click="switchMode('exam')">
                                    å¼€å§‹è€ƒè¯•
                                </button>
                                <button class="btn-secondary bg-white text-gray-700 hover:bg-gray-100" @click="switchMode('manage')">
                                    é¢˜ç›®ç®¡ç†
                                </button>
                                <button class="btn-danger bg-orange-500 text-white hover:bg-orange-600" @click="switchMode('mistakes')">
                                    é”™é¢˜å¤ä¹ 
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- å­¦ä¹ ç»Ÿè®¡ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="stats-card">
                            <div class="stats-number">{{ totalQuestions }}</div>
                            <div class="stats-label">æ€»é¢˜æ•°</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ correctRate }}%</div>
                            <div class="stats-label">æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ studyHours }}</div>
                            <div class="stats-label">å­¦ä¹ æ—¶é•¿(h)</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ mistakeCount }}</div>
                            <div class="stats-label">é”™é¢˜æ•°</div>
                        </div>
                    </div>
                    <!-- åŠŸèƒ½å¡ç‰‡ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 cursor-pointer" @click="switchMode('exam')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“</div>
                                <h3 class="text-xl font-bold">å¼€å§‹è€ƒè¯•</h3>
                            </div>
                            <p class="text-gray-600 mb-4">é€‰æ‹©é¢˜å‹å’Œæ•°é‡ï¼Œå¼€å§‹ä¸€æ¬¡å®Œæ•´çš„æ¨¡æ‹Ÿè€ƒè¯•</p>
                            <div class="text-green-600 font-medium">ç«‹å³å¼€å§‹ â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="switchMode('mistakes')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">âŒ</div>
                                <h3 class="text-xl font-bold">é”™é¢˜ç®¡ç†</h3>
                            </div>
                            <p class="text-gray-600 mb-4">è‡ªåŠ¨æ”¶é›†é”™é¢˜ï¼Œé’ˆå¯¹æ€§å¤ä¹ ï¼Œæé«˜å­¦ä¹ æ•ˆç‡</p>
                            <div class="text-green-600 font-medium">æŸ¥çœ‹é”™é¢˜ â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="switchMode('manage')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“š</div>
                                <h3 class="text-xl font-bold">é¢˜åº“ç®¡ç†</h3>
                            </div>
                            <p class="text-gray-600 mb-4">å¯¼å…¥ã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®ï¼Œæ„å»ºä¸ªæ€§åŒ–é¢˜åº“</p>
                            <div class="text-green-600 font-medium">ç®¡ç†é¢˜åº“ â†’</div>
                        </div>
                    </div>
                    <!-- é¢˜åº“ç®¡ç† -->
                    <div class="card p-6">
                        <h3 class="text-2xl font-bold mb-6">é¢˜åº“ç®¡ç†</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-semibold mb-4">å¯¼å…¥é¢˜åº“</h4>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">å¯¼å…¥åˆ°</label>
                                    <select v-model="importTarget" class="w-full p-2 border rounded-lg">
                                        <option value="public">å…¬å…±é¢˜åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è§ï¼‰</option>
                                        <option value="personal">ä¸ªäººé¢˜åº“ï¼ˆä»…è‡ªå·±å¯è§ï¼‰</option>
                                    </select>
                                </div>
                                <div class="file-upload-area" @drop="handleFileDrop" @dragover="handleDragOver" @dragleave="handleDragLeave" @click="triggerFileInput">
                                    <div class="text-4xl mb-4">ğŸ“</div>
                                    <div class="text-lg font-medium mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                                    <div class="text-sm text-gray-500">æ”¯æŒ .txt, .docx, .json, .xlsx æ ¼å¼æ–‡ä»¶</div>
                                </div>
                                <input type="file" ref="fileInput" multiple accept=".txt,.docx,.json,.xlsx" @change="handleFileSelect" class="hidden">
                                <div class="mt-4">
                                    <button class="btn-primary w-full" @click="showFormatSample = true">
                                        æŸ¥çœ‹æ ¼å¼è¯´æ˜
                                    </button>
                                </div>
                                <div class="mt-4" v-if="uploadProgress > 0">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span>å¯¼å…¥è¿›åº¦</span>
                                        <span>{{ uploadProgress }}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" :style="{width: uploadProgress + '%'}"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-4">é¢˜åº“æ“ä½œ</h4>
                                <div class="space-y-3">
                                    <button class="btn-secondary w-full" @click="loadSampleQuestions">
                                        åŠ è½½ç¤ºä¾‹é¢˜åº“
                                    </button>
                                    <button class="btn-danger w-full" @click="clearQuestionBank">
                                        æ¸…ç©ºé¢˜åº“
                                    </button>
                                    <button class="btn-primary w-full" @click="switchMode('manage')">
                                        é¢˜ç›®ç®¡ç†
                                    </button>
                                </div>
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h5 class="font-semibold mb-2">å½“å‰é¢˜åº“çŠ¶æ€</h5>
                                    <div class="space-y-1 text-sm">
                                        <div>æ€»é¢˜æ•°ï¼š{{ totalQuestions }}</div>
                                        <div>å…¬å…±é¢˜åº“ï¼š{{ publicQuestionBank.length }} é¢˜</div>
                                        <div>ä¸ªäººé¢˜åº“ï¼š{{ personalQuestionBank.length }} é¢˜</div>
                                        <div class="mt-2">å•é€‰é¢˜ï¼š{{ questionTypeCount.single }}</div>
                                        <div>å¤šé€‰é¢˜ï¼š{{ questionTypeCount.multiple }}</div>
                                        <div>åˆ¤æ–­é¢˜ï¼š{{ questionTypeCount.judge }}</div>
                                        <div>å¡«ç©ºé¢˜ï¼š{{ questionTypeCount.fill }}</div>
                                        <div>ç®€ç­”é¢˜ï¼š{{ questionTypeCount.essay }}</div>
                                    </div>
                                </div>
                                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                                    <h5 class="font-semibold text-blue-700 mb-2">ğŸ’¡ å¤šç”¨æˆ·åŠŸèƒ½è¯´æ˜</h5>
                                    <div class="space-y-1 text-sm text-blue-600">
                                        <div>â€¢ å…¬å…±é¢˜åº“ï¼šæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œå¯ç›¸äº’æŸ¥çœ‹</div>
                                        <div>â€¢ ä¸ªäººé¢˜åº“ï¼šä»…è‡ªå·±å¯è§ï¼Œç§å¯†å®‰å…¨</div>
                                        <div>â€¢ åŒæ­¥çŠ¶æ€ï¼šå®æ—¶æ˜¾ç¤ºæ•°æ®åŒæ­¥æƒ…å†µ</div>
                                        <div>â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼šé¿å…å¤šäººç¼–è¾‘å†²çª</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- è€ƒè¯•æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'exam'" key="exam">
                    <!-- è€ƒè¯•é…ç½® -->
                    <div v-if="!isExamStarted" class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-center">è€ƒè¯•é…ç½®</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="config-form space-y-4">
                                <div>
                                    <label>è€ƒè¯•ç±»å‹</label>
                                    <select v-model="examConfig.rule" class="w-full p-3 border rounded-lg">
                                        <option value="random">éšæœºæŠ½é¢˜</option>
                                        <option value="sequential">é¡ºåºå‡ºé¢˜</option>
                                        <option value="difficulty">æŒ‰éš¾åº¦å‡ºé¢˜</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label>é¢˜åº“æ¥æº</label>
                                    <select v-model="examConfig.bankSource" class="w-full p-3 border rounded-lg">
                                        <option value="all">å…¬å…±é¢˜åº“ + ä¸ªäººé¢˜åº“</option>
                                        <option value="public">ä»…å…¬å…±é¢˜åº“</option>
                                        <option value="personal">ä»…ä¸ªäººé¢˜åº“</option>
                                    </select>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label>å•é€‰é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.single" min="0" :max="questionTypeCount.single" class="w-full">
                                    </div>
                                    <div>
                                        <label>å¤šé€‰é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.multiple" min="0" :max="questionTypeCount.multiple" class="w-full">
                                    </div>
                                    <div>
                                        <label>åˆ¤æ–­é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.judge" min="0" :max="questionTypeCount.judge" class="w-full">
                                    </div>
                                    <div>
                                        <label>å¡«ç©ºé¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.fill" min="0" :max="questionTypeCount.fill" class="w-full">
                                    </div>
                                    <div>
                                        <label>ç®€ç­”é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.essay" min="0" :max="questionTypeCount.essay" class="w-full">
                                    </div>
                                </div>
                                
                                <div>
                                    <label>è€ƒè¯•æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                    <input type="number" v-model.number="examConfig.time" min="1" max="300" class="w-full">
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.enableTimer" id="enableTimer">
                                    <label for="enableTimer">å¯ç”¨è®¡æ—¶å™¨</label>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.showAnswerImmediately" id="showAnswerImmediately">
                                    <label for="showAnswerImmediately">ç«‹å³æ˜¾ç¤ºç­”æ¡ˆ</label>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.showAnalysis" id="showAnalysis">
                                    <label for="showAnalysis">æ˜¾ç¤ºè§£æ</label>
                                </div>
                            </div>
                            
                            <div>
                                <div class="config-tip mb-6">
                                    <h4>ğŸ“Š é¢˜åº“ç»Ÿè®¡</h4>
                                    <p>å½“å‰é¢˜åº“å…±æœ‰ {{ totalQuestions }} é“é¢˜ç›®ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„é¢˜ç›®æ•°é‡ã€‚</p>
                                </div>
                                
                                <div class="config-tip mb-6">
                                    <h4>â° æ—¶é—´å»ºè®®</h4>
                                    <p>å»ºè®®æ¯é“å•é€‰é¢˜2åˆ†é’Ÿï¼Œå¤šé€‰é¢˜3åˆ†é’Ÿï¼Œåˆ¤æ–­é¢˜1åˆ†é’Ÿï¼Œå¡«ç©ºé¢˜3åˆ†é’Ÿï¼Œç®€ç­”é¢˜5åˆ†é’Ÿã€‚</p>
                                </div>
                                
                                <div class="config-tip mb-6">
                                    <h4>ğŸ¯ è€ƒè¯•å»ºè®®</h4>
                                    <p>å»ºè®®ä¸€æ¬¡æ€§é€‰æ‹©ä¸è¶…è¿‡50é“é¢˜ç›®ï¼Œä¿æŒæ³¨æ„åŠ›é›†ä¸­ï¼Œæé«˜å­¦ä¹ æ•ˆç‡ã€‚</p>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                                    <h4 class="text-green-700 font-semibold mb-2">ğŸ“ è€ƒè¯•é¢„è§ˆ</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>å•é€‰é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.single }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å¤šé€‰é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.multiple }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>åˆ¤æ–­é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.judge }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å¡«ç©ºé¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.fill }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>ç®€ç­”é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.essay }} é“</span>
                                        </div>
                                        <hr class="my-2">
                                        <div class="flex justify-between font-semibold">
                                            <span>æ€»è®¡ï¼š</span>
                                            <span>{{ totalExamQuestions }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å»ºè®®æ—¶é—´ï¼š</span>
                                            <span>{{ suggestedTime }} åˆ†é’Ÿ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <button class="btn-primary w-full" @click="startExam" :disabled="totalExamQuestions === 0">
                                        ğŸš€ å¼€å§‹è€ƒè¯•
                                    </button>
                                    <button class="btn-secondary w-full" @click="loadRecommendedConfig">
                                        ğŸ“‹ æ¨èé…ç½®
                                    </button>
                                    <button class="btn-secondary w-full" @click="resetConfig">
                                        ğŸ”„ é‡ç½®é…ç½®
                                    </button>
                                </div>
                                
                                <div v-if="totalExamQuestions === 0" class="mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm text-center">
                                    è¯·è‡³å°‘é€‰æ‹©ä¸€é“é¢˜ç›®ï¼
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•è¿›è¡Œä¸­ -->
                    <div v-else-if="isExamStarted && !isExamFinished" class="exam-container">
                        <!-- è€ƒè¯•å¤´éƒ¨ -->
                        <div class="exam-header flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold mb-2">æ™ºèƒ½åˆ·é¢˜è€ƒè¯•</h2>
                                <div class="text-sm opacity-90">
                                    ç¬¬ {{ currentQuestionIndex + 1 }} é¢˜ / å…± {{ currentQuestions.length }} é¢˜
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div v-if="examConfig.enableTimer" class="exam-timer">
                                    â° {{ formatTime(remainingTime) }}
                                </div>
                                <button class="btn-secondary text-sm" @click="pauseExamDialog = true">
                                    â¸ï¸ æš‚åœ
                                </button>
                            </div>
                        </div>
                        
                        <!-- é¢˜ç›®å†…å®¹ -->
                        <div class="p-6">
                            <div class="mb-6">
                                <div class="flex items-center mb-4">
                                    <div class="question-number mr-3">{{ currentQuestionIndex + 1 }}</div>
                                    <div class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                        {{ getQuestionTypeText(currentQuestion.type) }}
                                    </div>
                                    <div class="ml-2" v-if="currentQuestion.source">
                                        <span class="source-badge" :class="currentQuestion.source">
                                            {{ currentQuestion.source === 'public' ? 'å…¬å…±' : 'ä¸ªäºº' }}
                                        </span>
                                    </div>
                                </div>
                                <div class="text-lg mb-6" v-html="currentQuestion.content"></div>
                                
                                <!-- å•é€‰é¢˜ -->
                                <div v-if="currentQuestion.type === 'single'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] === index,
                                            correct: currentAnswerSubmitted && index === currentQuestion.answer,
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] === index && index !== currentQuestion.answer,
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¤šé€‰é¢˜ -->
                                <div v-if="currentQuestion.type === 'multiple'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].includes(index),
                                            correct: currentAnswerSubmitted && currentQuestion.answer.includes(index),
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].includes(index) && !currentQuestion.answer.includes(index),
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- åˆ¤æ–­é¢˜ -->
                                <div v-if="currentQuestion.type === 'judge'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] === index,
                                            correct: currentAnswerSubmitted && index === currentQuestion.answer,
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] === index && index !== currentQuestion.answer,
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¡«ç©ºé¢˜ -->
                                <div v-if="currentQuestion.type === 'fill'" class="mb-6">
                                    <input 
                                        type="text" 
                                        v-model="userAnswers[currentQuestionIndex]"
                                        class="fill-input"
                                        :disabled="currentAnswerSubmitted"
                                        placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..."
                                        @input="saveFillAnswer"
                                    >
                                </div>
                                
                                <!-- ç®€ç­”é¢˜ -->
                                <div v-if="currentQuestion.type === 'essay'" class="mb-6">
                                    <textarea 
                                        v-model="userAnswers[currentQuestionIndex]"
                                        class="essay-textarea"
                                        :disabled="currentAnswerSubmitted"
                                        placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..."
                                        @input="saveEssayAnswer"
                                    ></textarea>
                                </div>
                                
                                <!-- ç­”æ¡ˆè§£æ -->
                                <div v-if="currentAnswerSubmitted" class="answer-show mt-6" :class="currentAnswerClass">
                                    <div class="flex items-center mb-3">
                                        <div class="text-lg mr-2">ğŸ“</div>
                                        <h4 class="font-semibold">ç­”æ¡ˆè§£æ</h4>
                                    </div>
                                    <div class="mb-3">
                                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                                    </div>
                                    <div v-if="currentQuestion.analysis" class="text-sm text-gray-700">
                                        <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="flex flex-wrap gap-3">
                                <button 
                                    class="btn-primary" 
                                    @click="submitCurrentAnswer"
                                    :disabled="currentAnswerSubmitted || !hasAnswerForCurrentQuestion"
                                >
                                    {{ currentAnswerSubmitted ? 'âœ“ å·²æäº¤' : 'ğŸ“¤ æäº¤ç­”æ¡ˆ' }}
                                </button>
                                <button 
                                    class="btn-secondary" 
                                    @click="markQuestion"
                                    :class="{active: markedQuestions.has(currentQuestionIndex)}"
                                >
                                    {{ markedQuestions.has(currentQuestionIndex) ? 'â­ å·²æ ‡è®°' : 'â˜† æ ‡è®°' }}
                                </button>
                                <button 
                                    class="btn-secondary" 
                                    @click="nextQuestion"
                                >
                                    â¡ï¸ ä¸‹ä¸€é¢˜
                                </button>
                            </div>
                        </div>
                        
                        <!-- ç­”é¢˜å¡ -->
                        <div class="border-t p-6">
                            <h4 class="font-semibold mb-4">ğŸ“‹ ç­”é¢˜å¡</h4>
                            <div class="answer-card">
                                <div 
                                    v-for="(question, index) in currentQuestions" 
                                    :key="index"
                                    class="answer-card-item"
                                    :class="getAnswerCardClass(index)"
                                    @click="jumpToQuestion(index)"
                                >
                                    {{ index + 1 }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•ç»“æœ -->
                    <!-- è€ƒè¯•ç»“ç®—é¡µé¢ -->
                    <div v-if="isExamFinished" class="card p-6 text-center">
                        <div class="result-container">
                            <div class="result-score">{{ examResult.score }}åˆ†</div>
                            <div class="result-grade" :class="examResult.gradeClass">
                                {{ examResult.grade }}
                            </div>
                            
                            <div class="result-stats">
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.totalQuestions }}</div>
                                    <div class="result-stat-label">æ€»é¢˜æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.correctCount }}</div>
                                    <div class="result-stat-label">æ­£ç¡®æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.wrongCount }}</div>
                                    <div class="result-stat-label">é”™è¯¯æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ formatTime(examResult.duration) }}</div>
                                    <div class="result-stat-label">ç”¨æ—¶</div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <button class="btn-primary" @click="reviewExam">
                                    ğŸ“Š æŸ¥çœ‹è¯¦æƒ…
                                </button>
                                <button class="btn-secondary" @click="startNewExam">
                                    ğŸ”„ é‡æ–°è€ƒè¯•
                                </button>
                                <button class="btn-secondary" @click="switchMode('home')">
                                    ğŸ  è¿”å›é¦–é¡µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- é”™é¢˜æœ¬æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'records'" key="records">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-2">ğŸ“Š è€ƒè¯•è®°å½•</h2>
                        <p class="text-gray-600">æŸ¥çœ‹æ‚¨çš„å†å²è€ƒè¯•æˆç»©å’Œè¿›æ­¥</p>
                    </div>
                    
                    <!-- è€ƒè¯•ç»Ÿè®¡æ¦‚è§ˆ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æ€»è€ƒè¯•æ¬¡æ•°</div>
                            <div class="text-2xl font-bold">{{ studyStats.examRecords.length }}</div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æœ€é«˜åˆ†</div>
                            <div class="text-2xl font-bold text-green-600">
                                {{ getMaxScore() }}åˆ†
                            </div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">å¹³å‡åˆ†</div>
                            <div class="text-2xl font-bold text-blue-600">
                                {{ getAverageScore() }}åˆ†
                            </div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æœ€è¿‘æˆç»©</div>
                            <div class="text-2xl font-bold" :class="getScoreClass(getLatestScore())">
                                {{ getLatestScore() }}åˆ†
                            </div>
                        </div>
                    </div>
                    
                    <!-- æˆç»©è¶‹åŠ¿å›¾ -->
                    <div class="card p-6 mb-6" v-if="studyStats.examRecords.length > 1">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ æˆç»©è¶‹åŠ¿</h3>
                        <div class="h-64">
                            <canvas id="scoreChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•è®°å½•åˆ—è¡¨ -->
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“‹ å†å²è®°å½•</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">è€ƒè¯•æ—¶é—´</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">å¾—åˆ†</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ­£ç¡®é¢˜æ•°</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ€»é¢˜æ•°</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ç”¨æ—¶</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr v-for="(record, index) in studyStats.examRecords" :key="index" class="hover:bg-gray-50">
                                        <td class="px-4 py-3 text-sm">{{ formatDate(record.date) }}</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span :class="['font-medium', getScoreClass(record.score)]">
                                                {{ record.score }}åˆ†
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm">{{ record.correctCount }}</td>
                                        <td class="px-4 py-3 text-sm">{{ record.totalQuestions }}</td>
                                        <td class="px-4 py-3 text-sm">{{ formatDuration(record.duration) }}</td>
                                        <td class="px-4 py-3 text-sm">
                                            <button class="text-blue-600 hover:text-blue-800 mr-3" @click="viewExamDetail(record)">
                                                è¯¦æƒ…
                                            </button>
                                            <button class="text-red-600 hover:text-red-800" @click="deleteExamRecord(index)">
                                                åˆ é™¤
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div v-if="studyStats.examRecords.length === 0" class="text-center py-8 text-gray-500">
                            æš‚æ— è€ƒè¯•è®°å½•
                        </div>
                    </div>
                </div>
                
                <div v-if="currentMode === 'mistakes'" key="mistakes">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">é”™é¢˜æœ¬</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="mistakeFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æ—¶é—´èŒƒå›´</label>
                                        <select v-model="mistakeFilter.timeRange" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="today">ä»Šå¤©</option>
                                            <option value="week">æœ¬å‘¨</option>
                                            <option value="month">æœ¬æœˆ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" v-model="mistakeFilter.importantOnly" class="mr-2">
                                            <span class="text-sm">åªçœ‹é‡ç‚¹é”™é¢˜</span>
                                        </label>
                                    </div>
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">é¢˜ç›®ç®¡ç†</label>
                                        <button class="btn-primary w-full mb-2" @click="startMistakePractice">
                                            é”™é¢˜ç»ƒä¹ 
                                        </button>
                                        <button class="btn-secondary w-full text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredMistakes.length }} é“é”™é¢˜
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="btn-secondary text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                        <button class="btn-danger text-sm" @click="clearMistakes">
                                            æ¸…ç©ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div v-for="(mistake, index) in filteredMistakes" :key="mistake.id" class="border rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(mistake.type) }}
                                                </span>
                                                <span class="text-gray-500 text-sm">{{ formatDate(mistake.mistakeTime) }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button @click="toggleImportant(mistake)" class="text-sm" :class="mistake.isImportant ? 'text-orange-600' : 'text-gray-400'">
                                                    {{ mistake.isImportant ? 'â­' : 'â˜†' }}
                                                </button>
                                                <button @click="removeMistake(mistake)" class="text-red-600 text-sm">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="mistake.content"></div>
                                        <div class="text-sm text-gray-600 mb-3">
                                            <div><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.answer) }}</div>
                                            <div><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.wrongAnswer) }}</div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="btn-primary text-sm" @click="reviewMistake(mistake)">
                                                é‡æ–°ç»ƒä¹ 
                                            </button>
                                            <button v-if="mistake.source === 'public'" class="btn-secondary text-sm" @click="copyToPersonal(mistake)">
                                                ğŸ“‹ å¤åˆ¶åˆ°ä¸ªäººé¢˜åº“
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
            <!-- ç®¡ç†é¡µé¢ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'manage'" key="manage">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6">é¢˜ç›®ç®¡ç†</h2>
                        
                        <!-- é¢˜åº“åˆ‡æ¢æ ‡ç­¾é¡µ -->
                        <div class="bank-tabs mb-6">
                            <div 
                                class="bank-tab" 
                                :class="{active: currentBankTab === 'all'}" 
                                @click="currentBankTab = 'all'"
                            >
                                å…¨éƒ¨é¢˜åº“ ({{ totalQuestions }})
                            </div>
                            <div 
                                class="bank-tab" 
                                :class="{active: currentBankTab === 'public'}" 
                                @click="currentBankTab = 'public'"
                            >
                                å…¬å…±é¢˜åº“ ({{ publicQuestionBank.length }})
                            </div>
                            <div 
                                class="bank-tab" 
                                :class="{active: currentBankTab === 'personal'}" 
                                @click="currentBankTab = 'personal'"
                            >
                                ä¸ªäººé¢˜åº“ ({{ personalQuestionBank.length }})
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="manageFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æœç´¢</label>
                                        <input type="text" v-model="manageFilter.search" placeholder="æœç´¢é¢˜ç›®å†…å®¹..." class="w-full p-2 border rounded-lg">
                                    </div>
                                    <div class="mt-4">
                                        <button class="btn-primary w-full mb-2" @click="addNewQuestion">
                                            â• æ–°å¢é¢˜ç›®
                                        </button>
                                        <button class="btn-secondary w-full text-sm" @click="exportCurrentBank">
                                            ğŸ“¤ å¯¼å‡ºå½“å‰é¢˜åº“
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredManageQuestions.length }} é“é¢˜ç›®
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" :checked="isAllSelected" @change="toggleSelectAllQuestions" class="mr-2">
                                            <span class="text-sm">å…¨é€‰</span>
                                        </label>
                                        <button class="btn-danger text-sm" @click="deleteSelectedQuestions">
                                            æ‰¹é‡åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                                <div class="question-manager space-y-4">
                                    <div v-for="(question, index) in filteredManageQuestions" :key="question.id" class="border rounded-lg p-4 question-item relative">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <label class="inline-block mr-2 cursor-pointer">
                                                    <input type="checkbox" v-model="question.selected" class="mr-1">
                                                </label>
                                                <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(question.type) }}
                                                </span>
                                                <span class="source-badge" :class="question.source">
                                                    {{ question.source === 'public' ? 'å…¬å…±' : 'ä¸ªäºº' }}
                                                </span>
                                                <span class="text-gray-500 text-sm">#{{ index + 1 }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button v-if="question.source === 'public'" class="action-button secondary" @click="copyToPersonalFromManage(question)">
                                                    ğŸ“‹ å¤åˆ¶
                                                </button>
                                                <button class="action-button secondary" @click="editQuestion(question)">
                                                    âœï¸ ç¼–è¾‘
                                                </button>
                                                <button class="action-button danger" @click="deleteQuestion(question)">
                                                    ğŸ—‘ï¸ åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="question.content.substring(0, 200) + (question.content.length > 200 ? '...' : '')"></div>
                                        <div class="text-sm text-gray-600">
                                            <div v-if="question.options && question.options.length">
                                                <strong>é€‰é¡¹:</strong> {{ question.options.length }} ä¸ª
                                            </div>
                                            <div v-if="question.analysis">
                                                <strong>è§£æ:</strong> {{ question.analysis.substring(0, 100) + (question.analysis.length > 100 ? '...' : '') }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
        </main>
        <!-- ç™»å½•å¯¹è¯æ¡† -->
        <div v-if="showLoginDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showLoginDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">ç”¨æˆ·ç™»å½•</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
                        <input 
                            type="text" 
                            v-model="loginForm.username" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">å¯†ç </label>
                        <input 
                            type="password" 
                            v-model="loginForm.password" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button class="btn-secondary" @click="showLoginDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="login">
                        ç™»å½•
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">é¦–æ¬¡ç™»å½•å°†è‡ªåŠ¨åˆ›å»ºè´¦æˆ·</p>
                </div>
            </div>
        </div>
        <!-- é¢˜ç›®ç±»å‹é€‰æ‹©å¯¹è¯æ¡† -->
        <div v-if="showQuestionTypeDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">é€‰æ‹©é¢˜åº“ç±»å‹</h3>
                <div class="space-y-3 mb-6">
                    <div v-for="(question, index) in pendingQuestions" :key="index" class="border rounded-lg p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">é¢˜ç›® {{ index + 1 }}</span>
                            <select v-model="question.selectedType" class="text-sm p-1 border rounded">
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="fill">å¡«ç©ºé¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="text-sm" v-html="question.content.substring(0, 100) + (question.content.length > 100 ? '...' : '')"></div>
                        <label class="flex items-center mt-2">
                            <input type="checkbox" v-model="question.selected" class="mr-2">
                            <span class="text-sm">å¯¼å…¥æ­¤é¢˜</span>
                        </label>
                    </div>
                </div>
                <!-- æ‰¹é‡æ“ä½œ -->
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" v-model="selectAllPending" @change="toggleSelectAll" class="mr-2">
                            <span class="text-sm">å…¨é€‰</span>
                        </label>
                        <select v-model="batchType" class="text-sm p-1 border rounded">
                            <option value="">æ‰¹é‡è®¾ç½®ç±»å‹</option>
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                            <option value="judge">åˆ¤æ–­é¢˜</option>
                            <option value="fill">å¡«ç©ºé¢˜</option>
                            <option value="essay">ç®€ç­”é¢˜</option>
                        </select>
                        <button @click="applyBatchType" class="btn-primary text-sm">åº”ç”¨</button>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button class="btn-secondary" @click="showQuestionTypeDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="confirmImport">
                        ç¡®è®¤å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>
        <!-- æ ¼å¼è¯´æ˜å¯¹è¯æ¡† -->
        <div v-if="showFormatSample" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">æ–‡ä»¶æ ¼å¼è¯´æ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-2">TXTæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
**å•é€‰é¢˜**<br>
1. ä»¥ä¸‹å“ªä¸ªæ˜¯JavaScriptçš„å…³é”®å­—ï¼Ÿ<br>
   A. class<br>
   B. function<br>
   C. method<br>
   D. type<br>
   ç­”æ¡ˆï¼šB<br>
   è§£æï¼šfunctionæ˜¯JavaScriptä¸­å®šä¹‰å‡½æ•°çš„å…³é”®å­—<br>
<br>
**å¤šé€‰é¢˜**<br>
<br>
1. ä»¥ä¸‹å“ªäº›å±äºä¸‰å‰‚ç±»ç‰©èµ„ï¼Ÿ<br>
   A.å‚¬åŒ–å‰‚<br>
   B.æ·»åŠ å‰‚<br>
   C.æº¶å‰‚<br>
   D.é˜€é—¨ç±»<br>
   ç­”æ¡ˆï¼šA,B,C<br>
   è§£æï¼šä¸‰å‰‚ç±»ä¸»è¦æŒ‡å‚¬åŒ–å‰‚ã€æ·»åŠ å‰‚ã€æº¶å‰‚ç­‰...
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Excelæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
è¡¨å¤´ï¼šé¢˜å‹ | é¢˜å¹² | é€‰é¡¹A | é€‰é¡¹B | é€‰é¡¹C | é€‰é¡¹D | ç­”æ¡ˆ | è§£æ<br>
ç¤ºä¾‹ï¼š<br>
single | é¢˜ç›®å†…å®¹ | é€‰é¡¹1 | é€‰é¡¹2 | é€‰é¡¹3 | é€‰é¡¹4 | B | è§£æå†…å®¹
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">JSONæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
[<br>
  {<br>
    "type": "single",<br>
    "content": "é¢˜ç›®å†…å®¹",<br>
    "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"],<br>
    "answer": 1,<br>
    "analysis": "è§£æå†…å®¹"<br>
  }<br>
]
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn-primary" @click="showFormatSample = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
        <!-- åˆ†äº«é€‰é¡¹å¼¹çª— -->
        <div v-if="showQRCode" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showQRCode = false">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">åˆ†äº«å­¦ä¹ åº”ç”¨</h3>
                <div class="space-y-3 mb-4">
                    <button class="btn-primary w-full" @click="copyLink">
                        ğŸ“‹ å¤åˆ¶åˆ†äº«é“¾æ¥
                    </button>
                    <button class="btn-secondary w-full" @click="exportData">
                        ğŸ’¾ å¯¼å‡ºå­¦ä¹ æ•°æ®
                    </button>
                    <button class="btn-secondary w-full" @click="importData">
                        ğŸ“¥ å¯¼å…¥å­¦ä¹ æ•°æ®
                    </button>
                </div>
                <!-- äºŒç»´ç  -->
                <div class="text-center mb-4">
                    <div id="qrcode" class="inline-block"></div>
                    <p class="text-xs text-gray-500 mt-2">æ‰«ç è®¿é—®å­¦ä¹ ç³»ç»Ÿ</p>
                </div>
                <div class="share-link text-center mb-4">
                    <small>{{ currentUrl }}</small>
                </div>
                <p class="text-xs text-gray-500 text-center mb-4">
                    é“¾æ¥åˆ†äº«æ›´ä¾¿æ·ï¼Œé€‚åˆå„ç§è®¾å¤‡ä½¿ç”¨
                </p>
                <button class="btn-secondary w-full" @click="showQRCode = false">
                    å…³é—­
                </button>
            </div>
        </div>
        <!-- æš‚åœè€ƒè¯•å¯¹è¯æ¡† -->
        <div v-if="pauseExamDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 text-center">
                <div class="text-4xl mb-4">â¸ï¸</div>
                <h3 class="text-xl font-bold mb-2">è€ƒè¯•å·²æš‚åœ</h3>
                <p class="text-gray-600 mb-6">æ‚¨çš„è€ƒè¯•è¿›åº¦å·²ä¿å­˜ï¼Œå¯ä»¥éšæ—¶ç»§ç»­</p>
                <div class="space-y-3">
                    <button class="btn-primary w-full" @click="resumeExam">
                        â–¶ï¸ ç»§ç»­è€ƒè¯•
                    </button>
                    <button class="btn-secondary w-full" @click="submitExam">
                        ğŸ“¤ æäº¤è€ƒè¯•
                    </button>
                    <button class="btn-danger w-full" @click="abandonExam">
                        âŒ æ”¾å¼ƒè€ƒè¯•
                    </button>
                </div>
            </div>
        </div>
        <!-- å®æ—¶ç­”æ¡ˆæ˜¾ç¤º -->
        <div v-if="showRealTimeAnswer && currentAnswerShown" class="real-time-answer">
            <div class="text-sm font-semibold mb-2">ç­”æ¡ˆ</div>
            <div :class="currentAnswerClass">
                <div class="mb-1">
                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                </div>
                <div v-if="currentQuestion.analysis">
                    <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                </div>
                <div v-if="userAnswers[currentQuestionIndex] !== undefined">
                    <div v-if="isAnswerCorrect(currentQuestionIndex)" class="text-green-600">
                        âœ… å›ç­”æ­£ç¡®ï¼
                    </div>
                    <div v-else class="text-red-600">
                        âŒ å›ç­”é”™è¯¯
                    </div>
                </div>
            </div>
        </div>
        <!-- åº•éƒ¨å¯¼èˆªï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
        <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40 bottom-nav" style="padding-bottom: env(safe-area-inset-bottom);">
            <div class="flex justify-around py-2">
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                    <span class="text-xl mb-1">ğŸ </span>
                    <span class="text-xs">é¦–é¡µ</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                    <span class="text-xl mb-1">ğŸ“</span>
                    <span class="text-xs">è€ƒè¯•</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                    <span class="text-xl mb-1">âŒ</span>
                    <span class="text-xs">é”™é¢˜</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'records'}" @click="switchMode('records')">
                    <span class="text-xl mb-1">ğŸ“Š</span>
                    <span class="text-xs">è®°å½•</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                    <span class="text-xl mb-1">âš™ï¸</span>
                    <span class="text-xs">ç®¡ç†</span>
                </button>
            </div>
        </div>
        <!-- è€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡† -->
        <div v-if="showExamDetail" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showExamDetail = false">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ“Š è€ƒè¯•è¯¦æƒ…</h3>
                    <button class="text-gray-500 hover:text-gray-700" @click="showExamDetail = false">
                        âœ•
                    </button>
                </div>
                
                <div v-if="currentExamDetail" class="space-y-6">
                    <!-- è€ƒè¯•æ¦‚è§ˆ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">å¾—åˆ†</div>
                                <div class="text-2xl font-bold" :class="getScoreClass(currentExamDetail.score)">
                                    {{ currentExamDetail.score }}åˆ†
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">ç­‰çº§</div>
                                <div class="text-xl font-bold" :class="getGradeClass(currentExamDetail.grade)">
                                    {{ currentExamDetail.grade }}
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">æ­£ç¡®é¢˜æ•°</div>
                                <div class="text-xl font-bold text-green-600">
                                    {{ currentExamDetail.correctCount }}
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">é”™è¯¯é¢˜æ•°</div>
                                <div class="text-xl font-bold text-red-600">
                                    {{ currentExamDetail.wrongCount }}
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-center text-sm text-gray-600">
                            è€ƒè¯•æ—¶é—´ï¼š{{ formatDate(currentExamDetail.date) }} | 
                            ç”¨æ—¶ï¼š{{ formatDuration(currentExamDetail.duration) }}
                        </div>
                    </div>
                    
                    <!-- é¢˜ç›®è¯¦æƒ…åˆ—è¡¨ -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4">é¢˜ç›®è¯¦æƒ…</h4>
                        <div class="space-y-4">
                            <div v-for="(question, index) in currentExamDetail.questions" :key="index" 
                                 class="border rounded-lg p-4" :class="question.isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center">
                                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2">
                                            {{ index + 1 }}
                                        </span>
                                        <span class="text-sm font-medium">{{ getQuestionTypeText(question.type) }}</span>
                                    </div>
                                    <span :class="question.isCorrect ? 'text-green-600' : 'text-red-600'">
                                        {{ question.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯' }}
                                    </span>
                                </div>
                                
                                <div class="mb-3 text-sm" v-html="question.content"></div>
                                
                                <div class="space-y-2 text-sm">
                                    <div>
                                        <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong>
                                        <span :class="question.isCorrect ? 'text-green-600' : 'text-red-600'">
                                            {{ formatAnswer(question.userAnswer) }}
                                        </span>
                                    </div>
                                    <div v-if="!question.isCorrect">
                                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>
                                        <span class="text-green-600">
                                            {{ formatAnswer(question.correctAnswer) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button class="btn-secondary" @click="showExamDetail = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç¼–è¾‘é¢˜ç›®å¯¹è¯æ¡† -->
        <div v-if="showEditDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">ç¼–è¾‘é¢˜ç›®</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">é¢˜ç›®ç±»å‹</label>
                        <select v-model="editingQuestion.type" class="w-full p-2 border rounded-lg">
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                            <option value="judge">åˆ¤æ–­é¢˜</option>
                            <option value="fill">å¡«ç©ºé¢˜</option>
                            <option value="essay">ç®€ç­”é¢˜</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">é¢˜ç›®å†…å®¹</label>
                        <textarea v-model="editingQuestion.content" class="w-full p-2 border rounded-lg" rows="3" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
                    </div>
                    
                    <!-- é€‰æ‹©é¢˜å’Œåˆ¤æ–­é¢˜çš„é€‰é¡¹ -->
                    <div v-if="editingQuestion.type === 'single' || editingQuestion.type === 'multiple' || editingQuestion.type === 'judge'" class="p-3 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">é€‰é¡¹</label>
                        <div v-if="editingQuestion.type === 'judge'" class="text-sm text-gray-600 mb-2">
                            åˆ¤æ–­é¢˜å°†è‡ªåŠ¨ä½¿ç”¨"æ­£ç¡®"å’Œ"é”™è¯¯"ä½œä¸ºé€‰é¡¹
                        </div>
                        <div v-if="editingQuestion.type !== 'judge'" class="space-y-2">
                            <div v-for="(option, index) in editingQuestion.options" :key="index" class="flex items-center space-x-2">
                                <span class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-sm font-medium">
                                    {{ String.fromCharCode(65 + index) }}
                                </span>
                                <input type="text" v-model="editingQuestion.options[index]" class="flex-1 p-2 border rounded-lg" placeholder="è¯·è¾“å…¥é€‰é¡¹å†…å®¹...">
                                <button @click="removeOption(index)" class="btn-danger text-sm" :disabled="editingQuestion.options.length <= 2">åˆ é™¤</button>
                            </div>
                            <button @click="addOption" class="btn-secondary text-sm" :disabled="editingQuestion.options.length >= 10">
                                æ·»åŠ é€‰é¡¹
                            </button>
                        </div>
                    </div>
                    
                    <!-- å•é€‰é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'single'" class="p-3 bg-blue-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <select v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg">
                            <option value="" disabled>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>
                            <option v-for="(option, index) in editingQuestion.options" :key="index" :value="index">
                                {{ String.fromCharCode(65 + index) }}. {{ option }}
                            </option>
                        </select>
                    </div>
                    
                    <!-- å¤šé€‰é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'multiple'" class="p-3 bg-purple-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆï¼ˆå¯å¤šé€‰ï¼‰</label>
                        <div class="space-y-2">
                            <div v-for="(option, index) in editingQuestion.options" :key="index" class="flex items-center">
                                <input type="checkbox" :value="index" v-model="editingQuestion.answer" class="mr-2">
                                <span>{{ String.fromCharCode(65 + index) }}. {{ option }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åˆ¤æ–­é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'judge'" class="p-3 bg-green-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <select v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg">
                            <option value="" disabled>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>
                            <option value="0">æ­£ç¡®</option>
                            <option value="1">é”™è¯¯</option>
                        </select>
                    </div>
                    
                    <!-- å¡«ç©ºé¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'fill'" class="p-3 bg-yellow-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <input type="text" v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg" placeholder="è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆ...">
                        <div class="text-xs text-gray-600 mt-1">
                            æç¤ºï¼šå¯ä»¥ä½¿ç”¨å¤šä¸ªç­”æ¡ˆï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ï¼šç­”æ¡ˆ1,ç­”æ¡ˆ2,ç­”æ¡ˆ3ï¼‰
                        </div>
                    </div>
                    
                    <!-- ç®€ç­”é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'essay'" class="p-3 bg-red-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">å‚è€ƒç­”æ¡ˆ</label>
                        <textarea v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg" rows="4" placeholder="è¯·è¾“å…¥å‚è€ƒç­”æ¡ˆ..."></textarea>
                        <div class="text-xs text-gray-600 mt-1">
                            æç¤ºï¼šç®€ç­”é¢˜ç­”æ¡ˆç”¨äºå‚è€ƒï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨è¯„åˆ†
                        </div>
                    </div>
                    
                    <!-- è§£æ -->
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">è§£æ</label>
                        <textarea v-model="editingQuestion.analysis" class="w-full p-2 border rounded-lg" rows="3" placeholder="è¯·è¾“å…¥é¢˜ç›®è§£æ..."></textarea>
                    </div>
                    
                    <!-- æ ‡ç­¾ -->
                    <div>
                        <label class="block text-sm font-medium mb-2">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šjavascript,åŸºç¡€,å‡½æ•°ï¼‰</label>
                        <input type="text" v-model="editingQuestion.tags" class="w-full p-2 border rounded-lg" placeholder="è¯·è¾“å…¥æ ‡ç­¾...">
                    </div>
                    
                    <!-- é¢˜åº“æ¥æº -->
                    <div v-if="editingQuestion.source === 'personal'">
                        <label class="block text-sm font-medium mb-2">é¢˜åº“æ¥æº</label>
                        <select v-model="editingQuestion.source" class="w-full p-2 border rounded-lg">
                            <option value="personal">ä¸ªäººé¢˜åº“</option>
                        </select>
                        <div class="text-xs text-gray-600 mt-1">
                            æç¤ºï¼šå…¬å…±é¢˜åº“çš„é¢˜ç›®åªèƒ½åœ¨å…¬å…±é¢˜åº“ä¸­ç¼–è¾‘
                        </div>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button class="btn-secondary" @click="closeEditDialog">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="saveEditQuestion">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>

        <!-- è€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡† -->
        <div v-if="showExamDetailDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showExamDetailDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto" @click.stop>
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ“Š è€ƒè¯•è¯¦æƒ…</h3>
                    <button class="text-gray-500 hover:text-gray-700" @click="showExamDetailDialog = false">
                        âœ•
                    </button>
                </div>
                
                <!-- è€ƒè¯•æ¦‚è§ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">{{ examResult.score }}</div>
                        <div class="text-sm text-gray-600">å¾—åˆ†</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">{{ examResult.totalQuestions }}</div>
                        <div class="text-sm text-gray-600">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">{{ examResult.correctCount }}</div>
                        <div class="text-sm text-gray-600">æ­£ç¡®æ•°</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">{{ examResult.wrongCount }}</div>
                        <div class="text-sm text-gray-600">é”™è¯¯æ•°</div>
                    </div>
                </div>
                
                <!-- é¢˜ç›®è¯¦æƒ… -->
                <div class="space-y-6">
                    <div v-for="(question, index) in currentQuestions" :key="index" class="border rounded-lg p-4">
                        <div class="flex items-center mb-3">
                            <div class="question-number mr-3">{{ index + 1 }}</div>
                            <div class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                {{ getQuestionTypeText(question.type) }}
                            </div>
                            <div class="ml-2" v-if="question.source">
                                <span class="source-badge" :class="question.source">
                                    {{ question.source === 'public' ? 'å…¬å…±' : 'ä¸ªäºº' }}
                                </span>
                            </div>
                            <div class="ml-auto">
                                <span :class="isAnswerCorrect(index) ? 'text-green-600 font-medium' : 'text-red-600 font-medium'">
                                    {{ isAnswerCorrect(index) ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯' }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="mb-3" v-html="question.content"></div>
                        
                        <!-- é€‰é¡¹ -->
                        <div v-if="question.options && question.options.length > 0" class="space-y-2 mb-3">
                            <div 
                                v-for="(option, optIndex) in question.options" 
                                :key="optIndex"
                                class="text-sm"
                                :class="{
                                    'text-green-600 bg-green-50 p-2 rounded': question.answer === optIndex || (Array.isArray(question.answer) && question.answer.includes(optIndex)),
                                    'text-red-600 bg-red-50 p-2 rounded': userAnswers[index] === optIndex && question.answer !== optIndex || 
                                                                           (Array.isArray(userAnswers[index]) && userAnswers[index].includes(optIndex) && 
                                                                            Array.isArray(question.answer) && !question.answer.includes(optIndex))
                                }"
                            >
                                <strong>{{ String.fromCharCode(65 + optIndex) }}.</strong> {{ option }}
                                <span v-if="question.answer === optIndex || (Array.isArray(question.answer) && question.answer.includes(optIndex))" class="ml-2">âœ“</span>
                                <span v-if="userAnswers[index] === optIndex && question.answer !== optIndex || 
                                           (Array.isArray(userAnswers[index]) && userAnswers[index].includes(optIndex) && 
                                            Array.isArray(question.answer) && !question.answer.includes(optIndex))" class="ml-2">âœ—</span>
                            </div>
                        </div>
                        
                        <!-- å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜ -->
                        <div v-else class="mb-3">
                            <div class="text-sm mb-2">
                                <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ userAnswers[index] || 'æœªä½œç­”' }}
                            </div>
                            <div class="text-sm text-green-600">
                                <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(question.answer) }}
                            </div>
                        </div>
                        
                        <!-- è§£æ -->
                        <div v-if="question.analysis && examConfig.showAnalysis" class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                            <strong>è§£æï¼š</strong> {{ question.analysis }}
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-center mt-6">
                    <button class="btn-primary" @click="showExamDetailDialog = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
        
        <!-- åŒæ­¥å¯¹è¯æ¡† -->
        <div v-if="showSyncDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showSyncDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">ğŸ”„ æ•°æ®åŒæ­¥</h3>
                
                <div class="mb-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">ğŸ“Š</div>
                        <div class="text-sm text-gray-600">å½“å‰åŒæ­¥çŠ¶æ€ï¼š{{ syncStatusText }}</div>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>å…¬å…±é¢˜åº“ç‰ˆæœ¬ï¼š</span>
                            <span class="font-medium">{{ publicBankVersion }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>ä¸ªäººé¢˜åº“å¤§å°ï¼š</span>
                            <span>{{ formatBytes(personalBankSize) }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æœ€ååŒæ­¥æ—¶é—´ï¼š</span>
                            <span>{{ lastSyncTime || 'ä»æœª' }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <button class="btn-primary w-full" @click="syncData">
                        ğŸ”„ ç«‹å³åŒæ­¥
                    </button>
                    <button class="btn-secondary w-full" @click="resolveConflicts">
                        âš¡ è§£å†³å†²çª
                    </button>
                    <button class="btn-secondary w-full" @click="exportData">
                        ğŸ’¾ å¯¼å‡ºæ•°æ®
                    </button>
                    <button class="btn-secondary w-full" @click="importData">
                        ğŸ“¥ å¯¼å…¥æ•°æ®
                    </button>
                </div>
                
                <div class="mt-4 text-center">
                    <button class="btn-secondary" @click="showSyncDialog = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯åº•éƒ¨é—´è· -->
        <div class="md:hidden h-16"></div>
        
        <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
        <div class="version-info">
            æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ v2.0.0 | æ”¯æŒå¤šç”¨æˆ·é¢˜åº“åŒæ­¥
        </div>
    </div>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    currentMode: 'home',
                    currentUrl: window.location.href,
                    // ç”¨æˆ·ç³»ç»Ÿ
                    currentUser: null,
                    showLoginDialog: false,
                    saveTimer: null,
                    _examStatsCache: null,
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    // é¢˜åº“æ•°æ® - æ–°å¢å¤šç”¨æˆ·æ”¯æŒ
                    publicQuestionBank: [], // å…¬å…±é¢˜åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
                    personalQuestionBank: [], // ä¸ªäººé¢˜åº“ï¼ˆç§æœ‰ï¼‰
                    // é”™é¢˜æœ¬
                    mistakeBank: [],
                    mistakeFilter: {
                        type: '',
                        timeRange: '',
                        importantOnly: false
                    },
                    // é¢˜ç›®ç®¡ç†
                    manageFilter: {
                        type: '',
                        search: ''
                    },
                    currentBankTab: 'all', // all, public, personal
                    // æ–‡ä»¶ä¸Šä¼ 
                    uploadProgress: 0,
                    pendingQuestions: [],
                    showQuestionTypeDialog: false,
                    showFormatSample: false,
                    isDragging: false,
                    importTarget: 'public', // public or personal
                    // åˆ†äº«
                    showQRCode: false,
                    showExamDetail: false,
                    currentExamDetail: null,
                    scoreChart: null,
                    // å­¦ä¹ ç»Ÿè®¡
                    studyStats: {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    },
                    // æ‰¹é‡æ“ä½œ
                    selectAllPending: false,
                    batchType: '',
                    // ç¼–è¾‘åŠŸèƒ½
                    editingQuestion: null,
                    showEditDialog: false,
                    // åŒæ­¥ç›¸å…³
                    showSyncDialog: false,
                    syncStatus: 'synced', // synced, unsynced, conflict
                    publicBankVersion: '1.0',
                    personalBankSize: 0,
                    lastSyncTime: null,
                    
                    // ğŸ‘‡ æ–°å¢ï¼šè€ƒè¯•åŠŸèƒ½ç›¸å…³æ•°æ® ğŸ‘‡
                    // è€ƒè¯•é…ç½®
                    examConfig: {
                        single: 5,
                        multiple: 3,
                        judge: 5,
                        fill: 2,
                        essay: 1,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true,
                        showAnalysis: true,
                        bankSource: 'all' // all, public, personal
                    },
                    // è€ƒè¯•çŠ¶æ€
                    isExamStarted: false,
                    isExamFinished: false,
                    currentQuestions: [],
                    currentQuestionIndex: 0,
                    userAnswers: {},
                    markedQuestions: new Set(),
                    submittedAnswers: new Set(),
                    currentAnswerSubmitted: false,
                    currentAnswerShown: false,
                    examStartTime: null,
                    remainingTime: 0,
                    examTimer: null,
                    pauseExamDialog: false,
                    // è€ƒè¯•ç»“æœ
                    examResult: {
                        score: 0,
                        grade: '',
                        gradeClass: '',
                        totalQuestions: 0,
                        correctCount: 0,
                        wrongCount: 0,
                        duration: 0
                    },
                    // æ˜¾ç¤ºè€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡†
                    showExamDetailDialog: false
                    // ğŸ‘† æ–°å¢ç»“æŸ ğŸ‘†
                }
            },
            computed: {
                totalQuestions() {
                    return this.publicQuestionBank.length + this.personalQuestionBank.length;
                },
                correctRate() {
                    if (this.studyStats.totalQuestions === 0) return 0;
                    return Math.round((this.studyStats.correctAnswers / this.studyStats.totalQuestions) * 100);
                },
                studyHours() {
                    return Math.round(this.studyStats.totalStudyTime / 3600 * 10) / 10;
                },
                mistakeCount() {
                    return this.mistakeBank.length;
                },
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½è¢«é€‰ä¸­
                isAllSelected() {
                    return this.filteredManageQuestions.length > 0 && 
                           this.filteredManageQuestions.every(q => q.selected);
                },
                
                questionTypeCount() {
                    const count = {
                        single: 0,
                        multiple: 0,
                        judge: 0,
                        fill: 0,
                        essay: 0
                    };
                    
                    // åˆå¹¶å…¬å…±é¢˜åº“å’Œä¸ªäººé¢˜åº“çš„ç»Ÿè®¡
                    const allQuestions = [...this.publicQuestionBank, ...this.personalQuestionBank];
                    allQuestions.forEach(q => {
                        if (count.hasOwnProperty(q.type)) {
                            count[q.type]++;
                        }
                    });
                    
                    return count;
                },
                
                filteredMistakes() {
                    let filtered = this.mistakeBank;
                    if (this.mistakeFilter.type) {
                        filtered = filtered.filter(m => m.type === this.mistakeFilter.type);
                    }
                    if (this.mistakeFilter.timeRange) {
                        const now = new Date();
                        const filterDate = new Date();
                        switch (this.mistakeFilter.timeRange) {
                            case 'today':
                                filterDate.setDate(now.getDate() - 1);
                                break;
                            case 'week':
                                filterDate.setDate(now.getDate() - 7);
                                break;
                            case 'month':
                                filterDate.setMonth(now.getMonth() - 1);
                                break;
                        }
                        if (this.mistakeFilter.timeRange !== '') {
                            filtered = filtered.filter(m => new Date(m.mistakeTime) >= filterDate);
                        }
                    }
                    if (this.mistakeFilter.importantOnly) {
                        filtered = filtered.filter(m => m.isImportant);
                    }
                    return filtered;
                },
                
                totalStudySessions() {
                    return this.studyStats.examRecords.length;
                },
                
                filteredManageQuestions() {
                    let questions = [];
                    
                    // æ ¹æ®å½“å‰æ ‡ç­¾é¡µé€‰æ‹©é¢˜åº“
                    switch (this.currentBankTab) {
                        case 'public':
                            questions = this.publicQuestionBank;
                            break;
                        case 'personal':
                            questions = this.personalQuestionBank;
                            break;
                        default: // all
                            questions = [...this.publicQuestionBank, ...this.personalQuestionBank];
                    }
                    
                    // åº”ç”¨ç­›é€‰æ¡ä»¶
                    let filtered = questions;
                    if (this.manageFilter.type) {
                        filtered = filtered.filter(q => q.type === this.manageFilter.type);
                    }
                    if (this.manageFilter.search) {
                        filtered = filtered.filter(q => 
                            q.content.toLowerCase().includes(this.manageFilter.search.toLowerCase())
                        );
                    }
                    
                    return filtered;
                },
                
                // ğŸ‘‡ æ–°å¢ï¼šè€ƒè¯•ç›¸å…³è®¡ç®—å±æ€§ ğŸ‘‡
                totalExamQuestions() {
                    return this.examConfig.single + this.examConfig.multiple + 
                           this.examConfig.judge + this.examConfig.fill + this.examConfig.essay;
                },
                
                suggestedTime() {
                    // å»ºè®®æ—¶é—´ï¼šå•é€‰2åˆ†é’Ÿï¼Œå¤šé€‰3åˆ†é’Ÿï¼Œåˆ¤æ–­1åˆ†é’Ÿï¼Œå¡«ç©º3åˆ†é’Ÿï¼Œç®€ç­”5åˆ†é’Ÿ
                    return this.examConfig.single * 2 + this.examConfig.multiple * 3 + 
                           this.examConfig.judge * 1 + this.examConfig.fill * 3 + this.examConfig.essay * 5;
                },
                
                currentQuestion() {
                    return this.currentQuestions[this.currentQuestionIndex] || {};
                },
                
                currentAnswerClass() {
                    if (!this.currentAnswerSubmitted) return '';
                    return this.isAnswerCorrect(this.currentQuestionIndex) ? 'answer-correct' : 'answer-wrong';
                },
                
                hasAnswerForCurrentQuestion() {
                    const answer = this.userAnswers[this.currentQuestionIndex];
                    if (answer === undefined || answer === null) return false;
                    
                    if (this.currentQuestion.type === 'multiple') {
                        return Array.isArray(answer) && answer.length > 0;
                    } else if (this.currentQuestion.type === 'fill' || this.currentQuestion.type === 'essay') {
                        return answer.toString().trim().length > 0;
                    }
                    return true;
                },
                
                // åŒæ­¥çŠ¶æ€æ–‡æœ¬
                syncStatusText() {
                    switch (this.syncStatus) {
                        case 'synced': return 'å·²åŒæ­¥';
                        case 'unsynced': return 'æœªåŒæ­¥';
                        case 'conflict': return 'æœ‰å†²çª';
                        default: return 'æœªçŸ¥';
                    }
                },
                
                syncStatusClass() {
                    return this.syncStatus;
                }
                // ğŸ‘† æ–°å¢ç»“æŸ ğŸ‘†
            },
            methods: {
                // ç”¨æˆ·ç³»ç»Ÿ
                login() {
                    if (!this.loginForm.username.trim()) {
                        alert('è¯·è¾“å…¥ç”¨æˆ·åï¼');
                        return;
                    }
                    // æ¨¡æ‹Ÿç™»å½•/æ³¨å†Œ
                    const userId = 'user_' + this.loginForm.username;
                    this.currentUser = {
                        id: userId,
                        username: this.loginForm.username
                    };
                    // åŠ è½½ç”¨æˆ·æ•°æ®
                    this.loadUserData();
                    this.showLoginDialog = false;
                    this.loginForm = { username: '', password: '' };
                    alert('ç™»å½•æˆåŠŸï¼');
                },
                
                logout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        this.saveUserData();
                        this.currentUser = null;
                        this.clearAllData();
                        alert('å·²é€€å‡ºç™»å½•ï¼');
                    }
                },
                
                loadUserData() {
                    if (!this.currentUser) return;
                    
                    // åŠ è½½å…¬å…±é¢˜åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
                    try {
                        const publicData = localStorage.getItem('publicQuestionBank');
                        if (publicData) {
                            this.publicQuestionBank = JSON.parse(publicData);
                        }
                    } catch (e) {
                        console.error('å…¬å…±é¢˜åº“åŠ è½½å¤±è´¥:', e);
                    }
                    
                    // åŠ è½½ç”¨æˆ·ä¸ªäººæ•°æ®
                    const userData = localStorage.getItem(`examAppData_${this.currentUser.id}`);
                    if (userData) {
                        try {
                            const data = JSON.parse(userData);
                            if (data.personalQuestionBank) this.personalQuestionBank = data.personalQuestionBank;
                            if (data.mistakeBank) this.mistakeBank = data.mistakeBank;
                            if (data.studyStats) this.studyStats = data.studyStats;
                            if (data.syncStatus) this.syncStatus = data.syncStatus;
                            if (data.lastSyncTime) this.lastSyncTime = data.lastSyncTime;
                        } catch (e) {
                            console.error('ç”¨æˆ·æ•°æ®åŠ è½½å¤±è´¥:', e);
                        }
                    } else {
                        // æ–°ç”¨æˆ·åŠ è½½ç¤ºä¾‹é¢˜åº“
                        this.loadSampleQuestions();
                    }
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    this.updateBankStats();
                },
                
                saveUserData() {
                    if (!this.currentUser) return;
                    
                    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                    if (this.saveTimer) {
                        clearTimeout(this.saveTimer);
                    }
                    
                    // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿä¿å­˜
                    this.saveTimer = setTimeout(() => {
                        try {
                            // ä¿å­˜å…¬å…±é¢˜åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
                            localStorage.setItem('publicQuestionBank', JSON.stringify(this.publicQuestionBank));
                            
                            // ä¿å­˜ç”¨æˆ·ä¸ªäººæ•°æ®
                            const data = {
                                personalQuestionBank: this.personalQuestionBank,
                                mistakeBank: this.mistakeBank,
                                studyStats: this.studyStats,
                                syncStatus: this.syncStatus,
                                lastSyncTime: new Date().toISOString()
                            };
                            localStorage.setItem(`examAppData_${this.currentUser.id}`, JSON.stringify(data));
                            
                            // æ›´æ–°åŒæ­¥çŠ¶æ€
                            this.syncStatus = 'synced';
                            this.lastSyncTime = new Date().toISOString();
                            
                        } catch (error) {
                            console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                            this.syncStatus = 'unsynced';
                        }
                    }, 300); // 300æ¯«ç§’é˜²æŠ–å»¶è¿Ÿ
                },
                
                clearAllData() {
                    this.publicQuestionBank = [];
                    this.personalQuestionBank = [];
                    this.mistakeBank = [];
                    this.studyStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    };
                },
                
                // æ›´æ–°é¢˜åº“ç»Ÿè®¡ä¿¡æ¯
                updateBankStats() {
                    // è®¡ç®—ä¸ªäººé¢˜åº“å¤§å°ï¼ˆå­—èŠ‚ï¼‰
                    const personalData = JSON.stringify(this.personalQuestionBank);
                    this.personalBankSize = new Blob([personalData]).size;
                    
                    // æ›´æ–°å…¬å…±é¢˜åº“ç‰ˆæœ¬
                    this.publicBankVersion = '1.0';
                },
                
                // æ¨¡å¼åˆ‡æ¢
                switchMode(mode) {
                    // å¦‚æœæ­£åœ¨è€ƒè¯•ä¸­ï¼Œæç¤ºç”¨æˆ·
                    if (this.isExamStarted && !this.isExamFinished && mode !== 'exam') {
                        if (!confirm('è€ƒè¯•æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ')) {
                            return;
                        }
                        this.abandonExam();
                    }
                    this.currentMode = mode;
                    this.saveUserData();
                    
                    // å½“åˆ‡æ¢åˆ°è€ƒè¯•è®°å½•é¡µé¢æ—¶ï¼Œæ¸²æŸ“æˆç»©è¶‹åŠ¿å›¾
                    if (mode === 'records') {
                        this.$nextTick(() => {
                            this.renderScoreChart();
                        });
                    }
                },
                
                // åŠ è½½ç¤ºä¾‹é¢˜åº“
                loadSampleQuestions() {
                    const sampleQuestions = [
                        {
                            id: 'q1',
                            type: 'single',
                            content: 'ä»¥ä¸‹å“ªä¸ªæ˜¯ Vue 3 çš„ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Ÿ',
                            options: [
                                'createApp',
                                'ref',
                                'component',
                                'mount'
                            ],
                            answer: 1,
                            analysis: 'ref æ˜¯ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Œç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®ã€‚',
                            difficulty: 2,
                            tags: ['vue', 'composition-api'],
                            source: 'public' // æ–°å¢ï¼šé¢˜ç›®æ¥æº
                        },
                        {
                            id: 'q2',
                            type: 'multiple',
                            content: 'ä»¥ä¸‹å“ªäº›æ˜¯ JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ',
                            options: [
                                'String',
                                'Number',
                                'Array',
                                'Object',
                                'Boolean'
                            ],
                            answer: [0, 1, 4],
                            analysis: 'JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬ï¼šStringã€Numberã€Booleanã€Nullã€Undefinedã€Symbolã€BigIntã€‚Array å’Œ Object æ˜¯å¼•ç”¨ç±»å‹ã€‚',
                            difficulty: 1,
                            tags: ['javascript', 'basics'],
                            source: 'public'
                        },
                        {
                            id: 'q3',
                            type: 'judge',
                            content: 'CSS ä¸­çš„ flexbox å¸ƒå±€åªèƒ½ç”¨äºæ°´å¹³å¸ƒå±€ã€‚',
                            options: ['æ­£ç¡®', 'é”™è¯¯'],
                            answer: 1,
                            analysis: 'Flexbox æ—¢æ”¯æŒæ°´å¹³å¸ƒå±€ï¼ˆflex-direction: rowï¼‰ï¼Œä¹Ÿæ”¯æŒå‚ç›´å¸ƒå±€ï¼ˆflex-direction: columnï¼‰ã€‚',
                            difficulty: 2,
                            tags: ['css', 'flexbox'],
                            source: 'public'
                        },
                        {
                            id: 'q4',
                            type: 'fill',
                            content: 'JavaScript ä¸­ä½¿ç”¨ ______ å…³é”®å­—æ¥å£°æ˜å¸¸é‡ã€‚',
                            options: [],
                            answer: 'const',
                            analysis: 'const å…³é”®å­—ç”¨äºå£°æ˜å¸¸é‡ï¼Œå£°æ˜åä¸èƒ½å†é‡æ–°èµ‹å€¼ã€‚',
                            difficulty: 1,
                            tags: ['javascript', 'basics'],
                            source: 'personal' // ä¸ªäººé¢˜åº“ç¤ºä¾‹
                        },
                        {
                            id: 'q5',
                            type: 'essay',
                            content: 'è¯·ç®€è¿° Vue 3 ç›¸å¯¹äº Vue 2 çš„ä¸»è¦æ”¹è¿›ç‚¹ã€‚',
                            options: [],
                            answer: 'Vue 3 çš„ä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š1. æ€§èƒ½æå‡ï¼ˆæ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦ã€æ›´å°çš„åŒ…ä½“ç§¯ï¼‰ï¼›2. Composition API æä¾›æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼›3. æ›´å¥½çš„ TypeScript æ”¯æŒï¼›4. æ–°å¢ Fragmentã€Teleportã€Suspense ç­‰å†…ç½®ç»„ä»¶ï¼›5. å“åº”å¼ç³»ç»Ÿä½¿ç”¨ Proxy æ›¿ä»£ Object.definePropertyã€‚',
                            analysis: 'Vue 3 åœ¨æ€§èƒ½ã€å¼€å‘ä½“éªŒã€TypeScript æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚',
                            difficulty: 3,
                            tags: ['vue', 'composition-api'],
                            source: 'personal'
                        }
                    ];
                    
                    // æ ¹æ®å¯¼å…¥ç›®æ ‡åˆ†é…é¢˜ç›®
                    sampleQuestions.forEach(q => {
                        if (q.source === 'public') {
                            this.publicQuestionBank.push(q);
                        } else {
                            this.personalQuestionBank.push(q);
                        }
                    });
                    
                    this.saveUserData();
                    this.updateBankStats();
                },
                
                // æ–‡ä»¶å¤„ç†ç›¸å…³æ–¹æ³•
                triggerFileInput() {
                    this.$refs.fileInput.click();
                },
                
                handleFileSelect(event) {
                    const files = event.target.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                
                handleFileDrop(event) {
                    event.preventDefault();
                    this.isDragging = false;
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                
                handleDragOver(event) {
                    event.preventDefault();
                    this.isDragging = true;
                },
                
                handleDragLeave(event) {
                    event.preventDefault();
                    this.isDragging = false;
                },
                
                async processFiles(files) {
                    this.uploadProgress = 0;
                    const totalFiles = files.length;
                    let processedFiles = 0;
                    for (let file of files) {
                        try {
                            await this.processFile(file);
                            processedFiles++;
                            this.uploadProgress = Math.round((processedFiles / totalFiles) * 100);
                        } catch (error) {
                            console.error('æ–‡ä»¶å¤„ç†é”™è¯¯:', error);
                            alert(`æ–‡ä»¶ ${file.name} å¤„ç†å¤±è´¥: ${error.message}`);
                        }
                    }
                    this.uploadProgress = 0;
                    this.saveUserData();
                    this.updateBankStats();
                },
                
                async processFile(file) {
                    let questions = [];
                    const fileName = file.name.toLowerCase();
                    try {
                        if (fileName.endsWith('.json')) {
                            questions = await this.parseJSON(file);
                        } else if (fileName.endsWith('.txt')) {
                            questions = await this.parseTXT(file);
                        } else if (fileName.endsWith('.xlsx')) {
                            questions = await this.parseExcel(file);
                        } else if (fileName.endsWith('.docx')) {
                            questions = await this.parseDocx(file);
                        } else {
                            throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
                        }
                        if (questions.length > 0) {
                            // ä¸ºæ¯ä¸ªé¢˜ç›®æ·»åŠ IDå’Œé»˜è®¤ç±»å‹
                            questions = questions.map((q, index) => ({
                                ...q,
                                id: q.id || `import_${Date.now()}_${index}`,
                                selectedType: q.type || 'single',
                                selected: true,
                                source: this.importTarget // æ–°å¢ï¼šè®¾ç½®é¢˜ç›®æ¥æº
                            }));
                            this.pendingQuestions = questions;
                            this.showQuestionTypeDialog = true;
                        } else {
                            alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®');
                        }
                    } catch (error) {
                        console.error('æ–‡ä»¶è§£æé”™è¯¯:', error);
                        throw new Error(`æ–‡ä»¶è§£æå¤±è´¥: ${error.message}`);
                    }
                },
                
                async parseTXT(file) {
                    const text = await file.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    const questions = [];
                    let currentQuestion = null;
                    let questionType = 'single';
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        // æ£€æµ‹é¢˜å‹æ ‡é¢˜
                        if (line.includes('å•é€‰é¢˜')) {
                            questionType = 'single';
                            continue;
                        } else if (line.includes('å¤šé€‰é¢˜')) {
                            questionType = 'multiple';
                            continue;
                        } else if (line.includes('åˆ¤æ–­é¢˜')) {
                            questionType = 'judge';
                            continue;
                        } else if (line.includes('å¡«ç©ºé¢˜')) {
                            questionType = 'fill';
                            continue;
                        } else if (line.includes('ç®€ç­”é¢˜')) {
                            questionType = 'essay';
                            continue;
                        }
                        // æ£€æµ‹é¢˜ç›®ç¼–å·
                        const questionMatch = line.match(/^\d+\.\s*(.+)/);
                        if (questionMatch) {
                            if (currentQuestion) {
                                questions.push(currentQuestion);
                            }
                            currentQuestion = {
                                id: `txt_${Date.now()}_${questions.length}`,
                                type: questionType,
                                content: questionMatch[1].trim(),
                                options: [],
                                answer: null,
                                analysis: ''
                            };
                            continue;
                        }
                        // æ£€æµ‹é€‰é¡¹
                        const optionMatch = line.match(/^([A-Z])\.\s*(.+)/);
                        if (optionMatch && currentQuestion) {
                            currentQuestion.options.push(optionMatch[2].trim());
                            continue;
                        }
                        // æ£€æµ‹ç­”æ¡ˆ
                        const answerMatch = line.match(/ç­”æ¡ˆï¼š(.+)/);
                        if (answerMatch && currentQuestion) {
                            const answerText = answerMatch[1].trim();
                            if (questionType === 'multiple') {
                                currentQuestion.answer = answerText.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else if (questionType === 'single' || questionType === 'judge') {
                                currentQuestion.answer = answerText.charCodeAt(0) - 65;
                            } else {
                                currentQuestion.answer = answerText;
                            }
                            continue;
                        }
                        // æ£€æµ‹è§£æ
                        const analysisMatch = line.match(/è§£æï¼š(.+)/);
                        if (analysisMatch && currentQuestion) {
                            currentQuestion.analysis = analysisMatch[1].trim();
                            continue;
                        }
                        // å¦‚æœæ˜¯åˆ¤æ–­é¢˜ï¼Œæ·»åŠ æ ‡å‡†é€‰é¡¹
                        if (questionType === 'judge' && currentQuestion && currentQuestion.options.length === 0) {
                            currentQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                        }
                    }
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    return questions;
                },
                
                async parseJSON(file) {
                    const text = await file.text();
                    return JSON.parse(text);
                },
                
                async parseExcel(file) {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    return json.map((row, index) => {
                        const question = {
                            id: 'excel_' + Date.now() + '_' + index,
                            type: row['é¢˜å‹'] || 'single',
                            content: row['é¢˜å¹²'] || row['é¢˜ç›®'] || '',
                            options: [],
                            answer: null,
                            analysis: row['è§£æ'] || ''
                        };
                        // å¤„ç†é€‰é¡¹
                        for (let i = 0; i < 10; i++) {
                            const option = row[`é€‰é¡¹${String.fromCharCode(65 + i)}`] || row[`é€‰é¡¹${i + 1}`];
                            if (option) {
                                question.options.push(option);
                            }
                        }
                        // å¤„ç†ç­”æ¡ˆ
                        const answer = row['ç­”æ¡ˆ'];
                        if (typeof answer === 'string') {
                            if (question.type === 'multiple') {
                                question.answer = answer.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else {
                                question.answer = answer.trim().charCodeAt(0) - 65;
                            }
                        } else {
                            question.answer = answer;
                        }
                        return question;
                    }).filter(q => q.content);
                },
                
                async parseDocx(file) {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    const text = result.value;
                    // å°†docxæ–‡æœ¬è½¬æ¢ä¸ºç±»ä¼¼TXTçš„æ ¼å¼ï¼Œç„¶åå¤ç”¨TXTè§£æé€»è¾‘
                    const lines = text.split('\n').filter(line => line.trim());
                    const formattedText = lines.join('\n');
                    const blob = new Blob([formattedText], { type: 'text/plain' });
                    return await this.parseTXT(blob);
                },
                
                // æ‰¹é‡æ“ä½œç›¸å…³æ–¹æ³•
                toggleSelectAll() {
                    this.pendingQuestions.forEach(q => {
                        q.selected = this.selectAllPending;
                    });
                },
                
                applyBatchType() {
                    if (this.batchType) {
                        this.pendingQuestions.forEach(q => {
                            if (q.selected) {
                                q.selectedType = this.batchType;
                            }
                        });
                        this.batchType = '';
                    }
                },
                
                confirmImport() {
                    const selectedQuestions = this.pendingQuestions.filter(q => q.selected);
                    selectedQuestions.forEach(q => {
                        const question = {
                            ...q,
                            type: q.selectedType,
                            difficulty: q.difficulty || 2,
                            tags: q.tags || [],
                            source: q.source || this.importTarget // ä½¿ç”¨é¢˜ç›®æ¥æºæˆ–å½“å‰å¯¼å…¥ç›®æ ‡
                        };
                        delete question.selectedType;
                        delete question.selected;
                        
                        // æ ¹æ®æ¥æºæ·»åŠ åˆ°å¯¹åº”çš„é¢˜åº“
                        if (question.source === 'public') {
                            this.publicQuestionBank.push(question);
                        } else {
                            this.personalQuestionBank.push(question);
                        }
                    });
                    this.showQuestionTypeDialog = false;
                    this.pendingQuestions = [];
                    this.saveUserData();
                    this.updateBankStats();
                    alert(`æˆåŠŸå¯¼å…¥ ${selectedQuestions.length} é“é¢˜ç›®ï¼`);
                },
                
                // å·¥å…·æ–¹æ³•
                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                },
                
                // è·å–é¢˜å‹æ–‡æœ¬
                getQuestionTypeText(type) {
                    const typeMap = {
                        'single': 'å•é€‰é¢˜',
                        'multiple': 'å¤šé€‰é¢˜',
                        'judge': 'åˆ¤æ–­é¢˜',
                        'fill': 'å¡«ç©ºé¢˜',
                        'essay': 'ç®€ç­”é¢˜'
                    };
                    return typeMap[type] || 'æœªçŸ¥é¢˜å‹';
                },
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                formatDate(dateString, showTime = false) {
                    const date = new Date(dateString);
                    if (showTime) {
                        return date.toLocaleString('zh-CN', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                    return date.toLocaleDateString('zh-CN');
                },
                
                // æ ¼å¼åŒ–å­—èŠ‚å¤§å°
                formatBytes(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },
                
                // åˆ†äº«åŠŸèƒ½
                shareLink() {
                    this.showQRCode = true;
                    this.$nextTick(() => {
                        this.generateQRCode();
                    });
                },
                
                copyLink() {
                    navigator.clipboard.writeText(this.currentUrl).then(() => {
                        alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    });
                },
                
                generateQRCode() {
                    this.$nextTick(() => {
                        const qrcodeElement = document.getElementById('qrcode');
                        if (qrcodeElement) {
                            // æ¸…é™¤ä¹‹å‰çš„äºŒç»´ç 
                            qrcodeElement.innerHTML = '';
                            // ç”Ÿæˆæ–°çš„äºŒç»´ç 
                            new QRCode(qrcodeElement, {
                                text: this.currentUrl,
                                width: 128,
                                height: 128,
                                colorDark: '#07c160',
                                colorLight: '#ffffff',
                                correctLevel: QRCode.CorrectLevel.H
                            });
                        }
                    });
                },
                
                // æ•°æ®åŒæ­¥åŠŸèƒ½
                syncData() {
                    try {
                        // è·å–å½“å‰æ—¶é—´
                        const now = new Date();
                        const currentTime = now.toISOString();
                        const displayTime = now.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        
                        this.syncStatus = 'synced';
                        this.lastSyncTime = displayTime;
                        
                        // ç«‹å³ä¿å­˜æ•°æ®ï¼Œä¸ä½¿ç”¨é˜²æŠ–å»¶è¿Ÿ
                        if (this.currentUser) {
                            // ä¿å­˜å…¬å…±é¢˜åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
                            localStorage.setItem('publicQuestionBank', JSON.stringify(this.publicQuestionBank));
                            
                            // ä¿å­˜ç”¨æˆ·ä¸ªäººæ•°æ®
                            const data = {
                                personalQuestionBank: this.personalQuestionBank,
                                mistakeBank: this.mistakeBank,
                                studyStats: this.studyStats,
                                syncStatus: this.syncStatus,
                                lastSyncTime: displayTime
                            };
                            localStorage.setItem(`examAppData_${this.currentUser.id}`, JSON.stringify(data));
                            
                            console.log('æ•°æ®åŒæ­¥æˆåŠŸï¼Œæ—¶é—´ï¼š', displayTime);
                        }
                        
                        alert(`æ•°æ®åŒæ­¥æˆåŠŸï¼\nåŒæ­¥æ—¶é—´ï¼š${displayTime}`);
                    } catch (error) {
                        console.error('åŒæ­¥å¤±è´¥:', error);
                        this.syncStatus = 'conflict';
                        alert('åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼');
                    }
                },
                
                resolveConflicts() {
                    // æ¨¡æ‹Ÿå†²çªè§£å†³
                    this.syncStatus = 'synced';
                    this.lastSyncTime = new Date().toISOString();
                    alert('å†²çªå·²è§£å†³ï¼');
                },
                
                // æ•°æ®å…±äº«åŠŸèƒ½
                exportData() {
                    if (!this.currentUser) {
                        alert('è¯·å…ˆç™»å½•åå†å¯¼å‡ºæ•°æ®ï¼');
                        return;
                    }
                    const data = {
                        publicQuestionBank: this.publicQuestionBank,
                        personalQuestionBank: this.personalQuestionBank,
                        mistakeBank: this.mistakeBank,
                        studyStats: this.studyStats,
                        exportTime: new Date().toISOString(),
                        version: '2.0',
                        userId: this.currentUser.id,
                        username: this.currentUser.username
                    };
                    const dataStr = JSON.stringify(data, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `åˆ·é¢˜æ•°æ®_${this.currentUser.username}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                importData() {
                    if (!this.currentUser) {
                        alert('è¯·å…ˆç™»å½•åå†å¯¼å…¥æ•°æ®ï¼');
                        return;
                    }
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const data = JSON.parse(e.target.result);
                                    let importCount = 0;
                                    
                                    // å¯¼å…¥å…¬å…±é¢˜åº“
                                    if (data.publicQuestionBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.publicQuestionBank.length} é“å…¬å…±é¢˜ç›®ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é¢˜ç›®
                                        const existingIds = new Set(this.publicQuestionBank.map(q => q.id));
                                        const newQuestions = data.publicQuestionBank.filter(q => !existingIds.has(q.id));
                                        this.publicQuestionBank.push(...newQuestions);
                                        importCount += newQuestions.length;
                                    }
                                    
                                    // å¯¼å…¥ä¸ªäººé¢˜åº“
                                    if (data.personalQuestionBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.personalQuestionBank.length} é“ä¸ªäººé¢˜ç›®ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é¢˜ç›®
                                        const existingIds = new Set(this.personalQuestionBank.map(q => q.id));
                                        const newQuestions = data.personalQuestionBank.filter(q => !existingIds.has(q.id));
                                        this.personalQuestionBank.push(...newQuestions);
                                        importCount += newQuestions.length;
                                    }
                                    
                                    // å¯¼å…¥é”™é¢˜æœ¬
                                    if (data.mistakeBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.mistakeBank.length} é“é”™é¢˜ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é”™é¢˜
                                        const existingMistakeIds = new Set(this.mistakeBank.map(m => m.id));
                                        const newMistakes = data.mistakeBank.filter(m => !existingMistakeIds.has(m.id));
                                        this.mistakeBank.push(...newMistakes);
                                        importCount += newMistakes.length;
                                    }
                                    
                                    // å¯¼å…¥å­¦ä¹ ç»Ÿè®¡
                                    if (data.studyStats && confirm('æ˜¯å¦å¯¼å…¥å­¦ä¹ ç»Ÿè®¡æ•°æ®ï¼Ÿ')) {
                                        // åˆå¹¶å­¦ä¹ ç»Ÿè®¡
                                        this.studyStats.totalQuestions += data.studyStats.totalQuestions || 0;
                                        this.studyStats.correctAnswers += data.studyStats.correctAnswers || 0;
                                        this.studyStats.totalStudyTime += data.studyStats.totalStudyTime || 0;
                                        if (data.studyStats.examRecords) {
                                            this.studyStats.examRecords.push(...data.studyStats.examRecords);
                                        }
                                    }
                                    
                                    this.saveUserData();
                                    this.updateBankStats();
                                    alert(`æ•°æ®å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${importCount} æ¡æ•°æ®ã€‚`);
                                } catch (error) {
                                    alert('æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                },
                
                // é”™é¢˜ç»ƒä¹ 
                startMistakePractice() {
                    if (this.mistakeBank.length === 0) {
                        alert('é”™é¢˜æœ¬ä¸ºç©ºï¼');
                        return;
                    }
                    this.examMode = 'practice';
                    this.currentQuestions = this.shuffleArray([...this.mistakeBank]);
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                
                // æ¸…ç©ºé”™é¢˜
                clearMistakes() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™é¢˜å—ï¼Ÿ')) {
                        this.mistakeBank = [];
                        this.saveUserData();
                    }
                },
                
                // åˆ é™¤é”™é¢˜
                removeMistake(mistake) {
                    const index = this.mistakeBank.findIndex(m => m.id === mistake.id);
                    if (index > -1) {
                        this.mistakeBank.splice(index, 1);
                        this.saveUserData();
                    }
                },
                
                // åˆ‡æ¢é‡ç‚¹æ ‡è®°
                toggleImportant(mistake) {
                    mistake.isImportant = !mistake.isImportant;
                    this.saveUserData();
                },
                
                // é‡æ–°ç»ƒä¹ é”™é¢˜
                reviewMistake(mistake) {
                    this.examMode = 'practice';
                    this.currentQuestions = [mistake];
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                
                // å¤åˆ¶é”™é¢˜åˆ°ä¸ªäººé¢˜åº“
                copyToPersonal(mistake) {
                    const question = {
                        id: `copy_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        type: mistake.type,
                        content: mistake.content,
                        options: mistake.options || [],
                        answer: mistake.answer,
                        analysis: mistake.analysis || '',
                        difficulty: 2,
                        tags: [],
                        source: 'personal'
                    };
                    this.personalQuestionBank.push(question);
                    this.saveUserData();
                    this.updateBankStats();
                    alert('å·²å¤åˆ¶åˆ°ä¸ªäººé¢˜åº“ï¼');
                },
                
                // æ¸…ç©ºé¢˜åº“
                clearQuestionBank() {
                    const confirmMsg = this.currentBankTab === 'all' 
                        ? 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é¢˜åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼'
                        : this.currentBankTab === 'public'
                        ? 'ç¡®å®šè¦æ¸…ç©ºå…¬å…±é¢˜åº“å—ï¼Ÿæ­¤æ“ä½œå°†å½±å“æ‰€æœ‰ç”¨æˆ·ï¼'
                        : 'ç¡®å®šè¦æ¸…ç©ºä¸ªäººé¢˜åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼';
                        
                    if (confirm(confirmMsg)) {
                        switch (this.currentBankTab) {
                            case 'all':
                                this.publicQuestionBank = [];
                                this.personalQuestionBank = [];
                                break;
                            case 'public':
                                this.publicQuestionBank = [];
                                break;
                            case 'personal':
                                this.personalQuestionBank = [];
                                break;
                        }
                        this.saveUserData();
                        this.updateBankStats();
                        alert('é¢˜åº“å·²æ¸…ç©ºï¼');
                    }
                },
                
                // åˆ é™¤é¢˜ç›®
                deleteQuestion(question) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                        if (question.source === 'public') {
                            const index = this.publicQuestionBank.findIndex(q => q.id === question.id);
                            if (index > -1) {
                                this.publicQuestionBank.splice(index, 1);
                            }
                        } else {
                            const index = this.personalQuestionBank.findIndex(q => q.id === question.id);
                            if (index > -1) {
                                this.personalQuestionBank.splice(index, 1);
                            }
                        }
                        this.saveUserData();
                        this.updateBankStats();
                    }
                },
                
                // ä»ç®¡ç†é¡µé¢å¤åˆ¶åˆ°ä¸ªäººé¢˜åº“
                copyToPersonalFromManage(question) {
                    const existing = this.personalQuestionBank.find(q => q.content === question.content);
                    if (existing) {
                        alert('ä¸ªäººé¢˜åº“ä¸­å·²å­˜åœ¨ç›¸åŒå†…å®¹çš„é¢˜ç›®ï¼');
                        return;
                    }
                    
                    const copy = {
                        ...question,
                        id: `copy_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        source: 'personal'
                    };
                    this.personalQuestionBank.push(copy);
                    this.saveUserData();
                    this.updateBankStats();
                    alert('å·²å¤åˆ¶åˆ°ä¸ªäººé¢˜åº“ï¼');
                },
                
                // ç¼–è¾‘é¢˜ç›®
                editQuestion(question) {
                    this.editingQuestion = JSON.parse(JSON.stringify(question));
                    // ç¡®ä¿ç­”æ¡ˆæ ¼å¼æ­£ç¡®
                    if (this.editingQuestion.type === 'multiple' && !Array.isArray(this.editingQuestion.answer)) {
                        this.editingQuestion.answer = [];
                    }
                    if (this.editingQuestion.type === 'judge' && (!this.editingQuestion.options || this.editingQuestion.options.length === 0)) {
                        this.editingQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                    }
                    // ç¡®ä¿é€‰é¡¹å­˜åœ¨
                    if (!this.editingQuestion.options) {
                        this.editingQuestion.options = [];
                    }
                    this.showEditDialog = true;
                },
                
                // æ–°å¢é¢˜ç›®
                addNewQuestion() {
                    this.editingQuestion = {
                        id: `new_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        type: 'single',
                        content: '',
                        options: ['é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D'],
                        answer: 0,
                        analysis: '',
                        difficulty: 2,
                        tags: [],
                        source: this.currentBankTab === 'public' ? 'public' : 'personal'
                    };
                    this.showEditDialog = true;
                },
                
                // å…³é—­ç¼–è¾‘å¯¹è¯æ¡†
                closeEditDialog() {
                    this.showEditDialog = false;
                    this.editingQuestion = null;
                },
                
                // ä¿å­˜ç¼–è¾‘çš„é¢˜ç›®
                saveEditQuestion() {
                    // éªŒè¯æ•°æ®
                    if (!this.editingQuestion.content.trim()) {
                        alert('è¯·è¾“å…¥é¢˜ç›®å†…å®¹ï¼');
                        return;
                    }
                    
                    // éªŒè¯é€‰æ‹©é¢˜å¿…é¡»æœ‰æ­£ç¡®ç­”æ¡ˆ
                    if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                        if (this.editingQuestion.answer === null || this.editingQuestion.answer === undefined) {
                            alert('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    } else if (this.editingQuestion.type === 'multiple') {
                        if (!Array.isArray(this.editingQuestion.answer) || this.editingQuestion.answer.length === 0) {
                            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    } else {
                        if (!this.editingQuestion.answer || !this.editingQuestion.answer.trim()) {
                            alert('è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    }
                    
                    // å¤„ç†æ ‡ç­¾
                    if (typeof this.editingQuestion.tags === 'string') {
                        this.editingQuestion.tags = this.editingQuestion.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                    }
                    
                    // æ›´æ–°é¢˜ç›®
                    const targetBank = this.editingQuestion.source === 'public' ? this.publicQuestionBank : this.personalQuestionBank;
                    const index = targetBank.findIndex(q => q.id === this.editingQuestion.id);
                    
                    if (index !== -1) {
                        targetBank[index] = JSON.parse(JSON.stringify(this.editingQuestion));
                    } else {
                        // æ–°å¢é¢˜ç›®
                        targetBank.push(JSON.parse(JSON.stringify(this.editingQuestion)));
                    }
                    
                    this.saveUserData();
                    this.updateBankStats();
                    alert('é¢˜ç›®ä¿å­˜æˆåŠŸï¼');
                    this.closeEditDialog();
                },
                
                // æ·»åŠ é€‰é¡¹
                addOption() {
                    if (!this.editingQuestion.options) {
                        this.editingQuestion.options = [];
                    }
                    if (this.editingQuestion.options.length < 10) {
                        this.editingQuestion.options.push('');
                    }
                },
                
                // åˆ é™¤é€‰é¡¹
                removeOption(index) {
                    if (this.editingQuestion.options && this.editingQuestion.options.length > 2) {
                        this.editingQuestion.options.splice(index, 1);
                        // é‡æ–°è°ƒæ•´ç­”æ¡ˆ
                        if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                            if (this.editingQuestion.answer >= this.editingQuestion.options.length) {
                                this.editingQuestion.answer = 0;
                            }
                        } else if (this.editingQuestion.type === 'multiple') {
                            this.editingQuestion.answer = this.editingQuestion.answer.filter(a => a < this.editingQuestion.options.length);
                        }
                    }
                },
                
                // æ‰¹é‡åˆ é™¤é¢˜ç›®
                deleteSelectedQuestions() {
                    const selectedQuestions = this.filteredManageQuestions.filter(q => q.selected);
                    if (selectedQuestions.length === 0) {
                        alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®ï¼');
                        return;
                    }
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedQuestions.length} é“é¢˜ç›®å—ï¼Ÿ`)) {
                        const selectedIds = new Set(selectedQuestions.map(q => q.id));
                        
                        // ä»å¯¹åº”çš„é¢˜åº“ä¸­åˆ é™¤
                        this.publicQuestionBank = this.publicQuestionBank.filter(q => !selectedIds.has(q.id));
                        this.personalQuestionBank = this.personalQuestionBank.filter(q => !selectedIds.has(q.id));
                        
                        this.saveUserData();
                        this.updateBankStats();
                        
                        // æ¸…é™¤é€‰æ‹©çŠ¶æ€
                        this.filteredManageQuestions.forEach(q => delete q.selected);
                        alert(`å·²åˆ é™¤ ${selectedQuestions.length} é“é¢˜ç›®ï¼`);
                    }
                },
                
                // åˆ‡æ¢é¢˜ç›®é€‰æ‹©çŠ¶æ€
                toggleSelectAllQuestions() {
                    // åˆ‡æ¢å…¨é€‰çŠ¶æ€
                    const currentAllSelected = this.isAllSelected;
                    this.filteredManageQuestions.forEach(q => {
                        q.selected = !currentAllSelected;
                    });
                },
                
                // å¯¼å‡ºå½“å‰é¢˜åº“
                exportCurrentBank() {
                    let questions = [];
                    let fileName = '';
                    
                    switch (this.currentBankTab) {
                        case 'public':
                            questions = this.publicQuestionBank;
                            fileName = 'å…¬å…±é¢˜åº“';
                            break;
                        case 'personal':
                            questions = this.personalQuestionBank;
                            fileName = 'ä¸ªäººé¢˜åº“';
                            break;
                        default:
                            questions = [...this.publicQuestionBank, ...this.personalQuestionBank];
                            fileName = 'å…¨éƒ¨é¢˜åº“';
                    }
                    
                    if (questions.length === 0) {
                        alert('å½“å‰é¢˜åº“ä¸ºç©ºï¼');
                        return;
                    }
                    
                    const data = JSON.stringify(questions, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${fileName}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                // ğŸ‘‡ æ–°å¢ï¼šè€ƒè¯•åŠŸèƒ½ç›¸å…³æ–¹æ³• ğŸ‘‡
                // å¼€å§‹è€ƒè¯•
                startExam() {
                    if (this.totalExamQuestions === 0) {
                        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€é“é¢˜ç›®ï¼');
                        return;
                    }
                    
                    // æ ¹æ®é…ç½®æŠ½å–é¢˜ç›®
                    this.currentQuestions = this.selectQuestions();
                    
                    if (this.currentQuestions.length === 0) {
                        alert('é¢˜åº“ä¸­æ²¡æœ‰è¶³å¤Ÿçš„é¢˜ç›®ï¼');
                        return;
                    }
                    
                    // åˆå§‹åŒ–è€ƒè¯•çŠ¶æ€
                    this.isExamStarted = true;
                    this.isExamFinished = false;
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.submittedAnswers.clear();
                    this.currentAnswerSubmitted = false;
                    this.currentAnswerShown = false;
                    this.examStartTime = Date.now();
                    this.remainingTime = this.examConfig.time * 60;
                    
                    // å¯åŠ¨è®¡æ—¶å™¨
                    if (this.examConfig.enableTimer) {
                        this.startTimer();
                    }
                },
                
                // é€‰æ‹©é¢˜ç›®
                selectQuestions() {
                    const selectedQuestions = [];
                    const questionCounts = {
                        single: this.examConfig.single,
                        multiple: this.examConfig.multiple,
                        judge: this.examConfig.judge,
                        fill: this.examConfig.fill,
                        essay: this.examConfig.essay
                    };
                    
                    // æ ¹æ®é¢˜åº“æ¥æºé€‰æ‹©é¢˜ç›®æ± 
                    let questionPool = [];
                    switch (this.examConfig.bankSource) {
                        case 'public':
                            questionPool = [...this.publicQuestionBank];
                            break;
                        case 'personal':
                            questionPool = [...this.personalQuestionBank];
                            break;
                        default: // all
                            questionPool = [...this.publicQuestionBank, ...this.personalQuestionBank];
                    }
                    
                    // æŒ‰é¢˜å‹æŠ½å–é¢˜ç›®
                    Object.entries(questionCounts).forEach(([type, count]) => {
                        if (count <= 0) return;
                        
                        let questionsOfType = questionPool.filter(q => q.type === type);
                        
                        // æ ¹æ®è§„åˆ™æ’åº
                        switch (this.examConfig.rule) {
                            case 'random':
                                questionsOfType = this.shuffleArray(questionsOfType);
                                break;
                            case 'sequential':
                                // ä¿æŒåŸé¡ºåº
                                break;
                            case 'difficulty':
                                questionsOfType.sort((a, b) => (a.difficulty || 2) - (b.difficulty || 2));
                                break;
                        }
                        
                        // æŠ½å–æŒ‡å®šæ•°é‡çš„é¢˜ç›®
                        const selected = questionsOfType.slice(0, count);
                        selectedQuestions.push(...selected);
                    });
                    
                    // æœ€åéšæœºæ‰“ä¹±é¡ºåº
                    if (this.examConfig.rule === 'random') {
                        return this.shuffleArray(selectedQuestions);
                    }
                    
                    return selectedQuestions;
                },
                
                // å¼€å§‹è®¡æ—¶å™¨
                startTimer() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                    }
                    this.examTimer = setInterval(() => {
                        if (this.remainingTime > 0) {
                            this.remainingTime--;
                        } else {
                            this.submitExam();
                        }
                    }, 1000);
                },
                
                // æ ¼å¼åŒ–æ—¶é—´
                formatTime(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },
                
                // é€‰æ‹©é€‰é¡¹
                selectOption(index) {
                    if (this.currentAnswerSubmitted) return;
                    
                    if (this.currentQuestion.type === 'multiple') {
                        // å¤šé€‰é¢˜
                        if (!this.userAnswers[this.currentQuestionIndex]) {
                            this.userAnswers[this.currentQuestionIndex] = [];
                        }
                        const answers = this.userAnswers[this.currentQuestionIndex];
                        const optionIndex = answers.indexOf(index);
                        if (optionIndex > -1) {
                            answers.splice(optionIndex, 1);
                        } else {
                            answers.push(index);
                        }
                        // è§¦å‘å“åº”å¼æ›´æ–°
                        this.userAnswers = { ...this.userAnswers };
                    } else {
                        // å•é€‰é¢˜
                        this.userAnswers[this.currentQuestionIndex] = index;
                    }
                },
                
                // ä¿å­˜å¡«ç©ºé¢˜ç­”æ¡ˆ
                saveFillAnswer() {
                    // å¡«ç©ºé¢˜ç­”æ¡ˆå·²ç»é€šè¿‡ v-model ç»‘å®šï¼Œè¿™é‡Œåªæ˜¯ç¡®ä¿å“åº”å¼æ›´æ–°
                    this.userAnswers = { ...this.userAnswers };
                },
                
                // ä¿å­˜ç®€ç­”é¢˜ç­”æ¡ˆ
                saveEssayAnswer() {
                    // ç®€ç­”é¢˜ç­”æ¡ˆå·²ç»é€šè¿‡ v-model ç»‘å®šï¼Œè¿™é‡Œåªæ˜¯ç¡®ä¿å“åº”å¼æ›´æ–°
                    this.userAnswers = { ...this.userAnswers };
                },
                
                // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                isAnswerCorrect(questionIndex) {
                    const question = this.currentQuestions[questionIndex];
                    const userAnswer = this.userAnswers[questionIndex];
                    
                    if (userAnswer === undefined) return false;
                    
                    if (question.type === 'multiple') {
                        return this.arraysEqual(userAnswer.sort(), question.answer.sort());
                    } else if (question.type === 'fill') {
                        // å¡«ç©ºé¢˜æ”¯æŒå¤šä¸ªç­”æ¡ˆï¼Œç”¨é€—å·åˆ†éš”
                        const correctAnswers = question.answer.toString().split(',').map(a => a.trim().toLowerCase());
                        return correctAnswers.includes(userAnswer.toString().trim().toLowerCase());
                    } else if (question.type === 'essay') {
                        // ç®€ç­”é¢˜è¯„åˆ†ï¼šæ£€æŸ¥å…³é”®è¯åŒ¹é…
                        const userContent = userAnswer.toString().trim().toLowerCase();
                        const correctAnswer = question.answer.toString().trim().toLowerCase();
                        
                        // å¦‚æœæ²¡æœ‰ç­”æ¡ˆæˆ–ç­”æ¡ˆä¸ºç©ºï¼Œä¸ç®—å¯¹
                        if (!userContent || !correctAnswer) return false;
                        
                        // æ£€æŸ¥æ˜¯å¦åŒ…å«å…³é”®è¯ï¼ˆç®€å•å®ç°ï¼‰
                        // å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„ç®—æ³•ï¼Œå¦‚è¯­ä¹‰åˆ†æ
                        const keywords = correctAnswer.split(/[,ï¼Œ.ã€‚;ï¼›\s]+/).filter(word => word.length > 1);
                        const matchedKeywords = keywords.filter(keyword => userContent.includes(keyword));
                        
                        // å¦‚æœåŒ¹é…å…³é”®è¯æ•°é‡è¶…è¿‡50%ï¼Œè®¤ä¸ºåŸºæœ¬æ­£ç¡®
                        return matchedKeywords.length >= Math.ceil(keywords.length * 0.5);
                    } else {
                        return userAnswer === question.answer;
                    }
                },
                
                // æ•°ç»„æ¯”è¾ƒ
                arraysEqual(a, b) {
                    return a.length === b.length && a.every((val, i) => val === b[i]);
                },
                
                // æ ¼å¼åŒ–ç­”æ¡ˆæ˜¾ç¤º
                formatAnswer(answer) {
                    if (Array.isArray(answer)) {
                        return answer.map(i => String.fromCharCode(65 + i)).join(', ');
                    } else if (typeof answer === 'number') {
                        return String.fromCharCode(65 + answer);
                    } else {
                        return answer;
                    }
                },
                
                // ä¸Šä¸€é¢˜
                previousQuestion() {
                    if (this.currentQuestionIndex > 0) {
                        this.currentQuestionIndex--;
                        this.currentAnswerShown = false;
                        this.currentAnswerSubmitted = this.submittedAnswers.has(this.currentQuestionIndex);
                    }
                },
                
                // ä¸‹ä¸€é¢˜
                nextQuestion() {
                    try {
                        if (this.currentQuestionIndex < this.currentQuestions.length - 1) {
                            // ç›´æ¥è¿›å…¥ä¸‹ä¸€é¢˜
                            this.currentQuestionIndex++;
                            this.currentAnswerShown = false;
                            this.currentAnswerSubmitted = this.submittedAnswers.has(this.currentQuestionIndex);
                            
                            // è®°å½•æ“ä½œ
                            console.log('åˆ‡æ¢åˆ°é¢˜ç›®:', this.currentQuestionIndex + 1);
                        } else {
                            // å·²ç»æ˜¯æœ€åä¸€é¢˜ï¼Œæç¤ºæäº¤
                            if (confirm('å·²ç»æ˜¯æœ€åä¸€é¢˜ï¼Œæ˜¯å¦æäº¤è€ƒè¯•ï¼Ÿ')) {
                                this.submitExam();
                            }
                        }
                    } catch (error) {
                        console.error('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºé”™:', error);
                        alert('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•');
                    }
                },
                
                // æäº¤å½“å‰ç­”æ¡ˆ
                submitCurrentAnswer() {
                    if (!this.hasAnswerForCurrentQuestion) {
                        alert('è¯·å…ˆé€‰æ‹©ç­”æ¡ˆï¼');
                        return;
                    }
                    
                    this.currentAnswerSubmitted = true;
                    this.submittedAnswers.add(this.currentQuestionIndex);
                    
                    // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                    const isCorrect = this.isAnswerCorrect(this.currentQuestionIndex);
                    
                    // å¦‚æœæ˜¯é”™é¢˜ï¼Œæ·»åŠ åˆ°é”™é¢˜æœ¬
                    if (!isCorrect) {
                        this.addToMistakeBank(this.currentQuestion, this.userAnswers[this.currentQuestionIndex]);
                    }
                    
                    // è‡ªåŠ¨æ˜¾ç¤ºç­”æ¡ˆ
                    if (this.examConfig.showAnswerImmediately) {
                        this.currentAnswerShown = true;
                    }
                },
                
                // è·³è½¬åˆ°æŒ‡å®šé¢˜ç›®
                jumpToQuestion(index) {
                    this.currentQuestionIndex = index;
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = this.submittedAnswers.has(index);
                },
                
                // æ ‡è®°é¢˜ç›®
                markQuestion() {
                    if (this.markedQuestions.has(this.currentQuestionIndex)) {
                        this.markedQuestions.delete(this.currentQuestionIndex);
                    } else {
                        this.markedQuestions.add(this.currentQuestionIndex);
                    }
                },
                
                // è·å–ç­”é¢˜å¡æ ·å¼
                getAnswerCardClass(index) {
                    const baseClass = 'answer-card-item';
                    const classes = [baseClass];
                    
                    if (index === this.currentQuestionIndex) {
                        classes.push('current');
                    }
                    
                    if (this.submittedAnswers.has(index)) {
                        if (this.isAnswerCorrect(index)) {
                            classes.push('answered');
                        } else {
                            classes.push('wrong');
                        }
                    } else if (this.userAnswers[index] !== undefined) {
                        classes.push('unanswered');
                    } else {
                        classes.push('unanswered');
                    }
                    
                    if (this.markedQuestions.has(index)) {
                        classes.push('marked');
                    }
                    
                    return classes.join(' ');
                },
                
                // æš‚åœè€ƒè¯•
                pauseExam() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                        this.examTimer = null;
                    }
                },
                
                // ç»§ç»­è€ƒè¯•
                resumeExam() {
                    this.pauseExamDialog = false;
                    if (this.examConfig.enableTimer) {
                        this.startTimer();
                    }
                },
                
                // æ”¾å¼ƒè€ƒè¯•
                abandonExam() {
                    if (confirm('ç¡®å®šè¦æ”¾å¼ƒè€ƒè¯•å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸ä¼šä¿å­˜ã€‚')) {
                        this.pauseExam();
                        this.isExamStarted = false;
                        this.isExamFinished = false;
                        this.pauseExamDialog = false;
                        this.switchMode('home');
                    }
                },
                
                // æäº¤è€ƒè¯•
                // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                formatDuration(seconds) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${minutes}åˆ†${secs}ç§’`;
                },
                
                // è·å–ç­‰çº§æ ·å¼
                getGradeClass(grade) {
                    switch(grade) {
                        case 'ä¼˜ç§€': return 'text-green-600';
                        case 'è‰¯å¥½': return 'text-blue-600';
                        case 'åŠæ ¼': return 'text-orange-600';
                        default: return 'text-gray-600';
                    }
                },
                
                // è·å–æˆç»©æ ·å¼
                getScoreClass(score) {
                    if (score >= 90) return 'text-green-600';
                    if (score >= 80) return 'text-blue-600';
                    if (score >= 60) return 'text-orange-600';
                    return 'text-red-600';
                },
                
                // è·å–æœ€é«˜åˆ†
                // è®¡ç®—è€ƒè¯•ç»Ÿè®¡æ•°æ®ï¼ˆç¼“å­˜ç»“æœé¿å…é‡å¤è®¡ç®—ï¼‰
                getExamStats() {
                    const records = this.studyStats.examRecords;
                    if (records.length === 0) {
                        return { max: 0, average: 0, latest: 0 };
                    }
                    
                    // ç¼“å­˜è®¡ç®—ç»“æœ
                    if (!this._examStatsCache || this._examStatsCache.timestamp !== records.length) {
                        const scores = records.map(r => r.score);
                        this._examStatsCache = {
                            max: Math.max(...scores),
                            average: Math.round(scores.reduce((acc, score) => acc + score, 0) / scores.length),
                            latest: records[records.length - 1].score,
                            timestamp: records.length
                        };
                    }
                    
                    return this._examStatsCache;
                },
                
                // è·å–æœ€é«˜åˆ†
                getMaxScore() {
                    return this.getExamStats().max;
                },
                
                // è·å–å¹³å‡åˆ†
                getAverageScore() {
                    return this.getExamStats().average;
                },
                
                // è·å–æœ€è¿‘æˆç»©
                getLatestScore() {
                    return this.getExamStats().latest;
                },
                
                // æŸ¥çœ‹è€ƒè¯•è¯¦æƒ…
                viewExamDetail(record) {
                    this.currentExamDetail = record;
                    this.showExamDetail = true;
                },
                
                // åˆ é™¤è€ƒè¯•è®°å½•
                deleteExamRecord(index) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è€ƒè¯•è®°å½•å—ï¼Ÿ')) {
                        this.studyStats.examRecords.splice(index, 1);
                        this.saveUserData();
                        this.renderScoreChart();
                    }
                },
                
                // ç»˜åˆ¶æˆç»©è¶‹åŠ¿å›¾
                renderScoreChart() {
                    if (this.studyStats.examRecords.length <= 1) return;
                    
                    const ctx = document.getElementById('scoreChart');
                    if (!ctx) return;
                    
                    // é”€æ¯ä¹‹å‰çš„å›¾è¡¨
                    if (this.scoreChart) {
                        this.scoreChart.destroy();
                    }
                    
                    const records = this.studyStats.examRecords.slice(-10); // æœ€è¿‘10æ¬¡è€ƒè¯•
                    const labels = records.map(r => this.formatDate(r.date, true));
                    const scores = records.map(r => r.score);
                    
                    this.scoreChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'è€ƒè¯•æˆç»©',
                                data: scores,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        stepSize: 10
                                    }
                                }
                            }
                        }
                    });
                },
                
                // æ·»åŠ é”™é¢˜åˆ°é”™é¢˜æœ¬
                addToMistakeBank(question, wrongAnswer) {
                    const mistake = {
                        id: Date.now() + Math.random(),
                        content: question.content,
                        type: question.type,
                        options: question.options || [],
                        answer: question.answer,
                        wrongAnswer: wrongAnswer,
                        analysis: question.analysis || '',
                        mistakeTime: new Date().toISOString(),
                        isImportant: false,
                        reviewCount: 0,
                        lastReviewTime: null,
                        source: question.source || 'unknown' // ä¿ç•™é¢˜ç›®æ¥æº
                    };
                    
                    this.mistakeBank.push(mistake);
                    this.saveUserData();
                },
                
                submitExam() {
                    try {
                        // ç¡®ä¿è®¡æ—¶å™¨åœæ­¢
                        if (this.examTimer) {
                            clearInterval(this.examTimer);
                            this.examTimer = null;
                        }
                        
                        // è®¡ç®—å¾—åˆ†
                        const totalQuestions = this.currentQuestions.length;
                        let correctCount = 0;
                        
                        // ä½¿ç”¨ç°æœ‰çš„isAnswerCorrectæ–¹æ³•è¿›è¡Œè¯„åˆ†
                        for (let i = 0; i < totalQuestions; i++) {
                            const userAnswer = this.userAnswers[i];
                            const question = this.currentQuestions[i];
                            
                            if (userAnswer !== undefined) {
                                if (this.isAnswerCorrect(i)) {
                                    correctCount++;
                                } else {
                                    this.addToMistakeBank(question, userAnswer);
                                }
                            } else {
                                // æœªå›ç­”çš„é¢˜ç›®è§†ä¸ºé”™é¢˜ï¼ŒåŠ å…¥é”™é¢˜æœ¬
                                this.addToMistakeBank(question, null);
                            }
                        }
                        
                        const score = Math.round((correctCount / totalQuestions) * 100);
                        
                        // è®¡ç®—ç­‰çº§
                        let grade = '';
                        if (score >= 90) grade = 'ä¼˜ç§€';
                        else if (score >= 80) grade = 'è‰¯å¥½';
                        else if (score >= 60) grade = 'åŠæ ¼';
                        else grade = 'ä¸åŠæ ¼';
                        
                        // è®°å½•è€ƒè¯•ç»“æœ
                        this.studyStats.examRecords.push({
                            date: new Date().toISOString(),
                            score: score,
                            grade: grade,
                            correctCount: correctCount,
                            wrongCount: totalQuestions - correctCount,
                            totalQuestions: totalQuestions,
                            duration: Math.round((Date.now() - this.examStartTime) / 1000),
                            questions: this.currentQuestions.map((q, i) => {
                                const userAnswer = this.userAnswers[i];
                                let isCorrect = false;
                                
                                if (userAnswer !== undefined) {
                                    if (q.type === 'multiple') {
                                        isCorrect = JSON.stringify(userAnswer.sort()) === JSON.stringify(q.answer.sort());
                                    } else if (q.type === 'fill') {
                                        const correctAnswers = q.answer.toString().split(',').map(a => a.trim().toLowerCase());
                                        isCorrect = correctAnswers.includes(userAnswer.toString().trim().toLowerCase());
                                    } else if (q.type === 'essay') {
                                        // ç®€ç­”é¢˜è¯„åˆ†ï¼šæ£€æŸ¥å…³é”®è¯åŒ¹é…
                                        const userContent = userAnswer.toString().trim().toLowerCase();
                                        const correctAnswer = q.answer.toString().trim().toLowerCase();
                                        
                                        if (userContent && correctAnswer) {
                                            const keywords = correctAnswer.split(/[,ï¼Œ.ã€‚;ï¼›\s]+/).filter(word => word.length > 1);
                                            const matchedKeywords = keywords.filter(keyword => userContent.includes(keyword));
                                            isCorrect = matchedKeywords.length >= Math.ceil(keywords.length * 0.5);
                                        }
                                    } else {
                                        isCorrect = userAnswer == q.answer;
                                    }
                                }
                                
                                return {
                                    content: q.content,
                                    type: q.type,
                                    userAnswer: userAnswer,
                                    correctAnswer: q.answer,
                                    isCorrect: isCorrect,
                                    source: q.source // ä¿ç•™é¢˜ç›®æ¥æº
                                };
                            })
                        });
                        
                        this.studyStats.totalQuestions += totalQuestions;
                        this.studyStats.correctAnswers += correctCount;
                        
                        // ä¿å­˜æ•°æ®
                        this.saveUserData();
                        
                        // è®¾ç½®è€ƒè¯•ç»“æœå¯¹è±¡
                        this.examResult = {
                            score: score,
                            grade: grade,
                            gradeClass: grade,
                            totalQuestions: totalQuestions,
                            correctCount: correctCount,
                            wrongCount: totalQuestions - correctCount,
                            duration: Math.round((Date.now() - this.examStartTime) / 1000)
                        };
                        
                        // æ ‡è®°è€ƒè¯•å®Œæˆï¼Œæ˜¾ç¤ºç»“ç®—é¡µé¢
                        this.isExamFinished = true;
                        this.isExamStarted = false;
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        console.log('è€ƒè¯•æäº¤æˆåŠŸï¼å¾—åˆ†ï¼š' + score + 'åˆ†ï¼Œç­‰çº§ï¼š' + grade);
                        
                    } catch (error) {
                        console.error('æäº¤è€ƒè¯•æ—¶å‡ºé”™:', error);
                        
                        // å³ä½¿å‡ºé”™ä¹Ÿè¦æ˜¾ç¤ºç»“ç®—é¡µé¢
                        this.examResult = {
                            score: correctCount || 0,
                            grade: 'å¾…è¯„å®š',
                            gradeClass: 'average',
                            totalQuestions: totalQuestions || 0,
                            correctCount: correctCount || 0,
                            wrongCount: (totalQuestions || 0) - (correctCount || 0),
                            duration: Math.round((Date.now() - (this.examStartTime || Date.now())) / 1000)
                        };
                        
                        this.isExamFinished = true;
                        this.isExamStarted = false;
                        
                        alert('è€ƒè¯•å·²å®Œæˆï¼Œç³»ç»Ÿå·²è®°å½•æ‚¨çš„ç­”é¢˜æƒ…å†µã€‚');
                    }
                },
                
                // æŸ¥çœ‹è€ƒè¯•è¯¦æƒ…
                reviewExam() {
                    // æ˜¾ç¤ºè€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡†
                    this.showExamDetailDialog = true;
                },
                
                // é‡æ–°è€ƒè¯•
                startNewExam() {
                    this.isExamStarted = false;
                    this.isExamFinished = false;
                },
                
                // åŠ è½½æ¨èé…ç½®
                loadRecommendedConfig() {
                    const totalAvailable = this.totalQuestions;
                    const recommendedCount = Math.min(totalAvailable, 20);
                    
                    // æ ¹æ®é¢˜å‹æ¯”ä¾‹åˆ†é…é¢˜ç›®æ•°é‡
                    const typeRatios = {
                        single: 0.4,
                        multiple: 0.2,
                        judge: 0.3,
                        fill: 0.05,
                        essay: 0.05
                    };
                    
                    Object.entries(typeRatios).forEach(([type, ratio]) => {
                        const available = this.questionTypeCount[type] || 0;
                        const recommended = Math.round(recommendedCount * ratio);
                        this.examConfig[type] = Math.min(recommended, available);
                    });
                    
                    // è°ƒæ•´æ—¶é—´
                    this.examConfig.time = this.suggestedTime;
                    this.examConfig.enableTimer = true;
                    this.examConfig.showAnswerImmediately = true;
                    this.examConfig.showAnalysis = true;
                },
                
                // é‡ç½®é…ç½®
                resetConfig() {
                    this.examConfig = {
                        single: 5,
                        multiple: 3,
                        judge: 5,
                        fill: 2,
                        essay: 1,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true,
                        showAnalysis: true,
                        bankSource: 'all'
                    };
                }
                // ğŸ‘† æ–°å¢ç»“æŸ ğŸ‘†
            },
            mounted() {
                // ä¸è‡ªåŠ¨ç™»å½•ï¼Œä¿æŒæœªç™»å½•çŠ¶æ€
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„ç”¨æˆ·ä¼šè¯
                localStorage.removeItem('currentUser');
                this.currentUser = null;
                
                // åŠ è½½å…¬å…±é¢˜åº“ï¼ˆå³ä½¿æœªç™»å½•ä¹Ÿå¯æŸ¥çœ‹ï¼‰
                try {
                    const publicData = localStorage.getItem('publicQuestionBank');
                    if (publicData) {
                        this.publicQuestionBank = JSON.parse(publicData);
                    }
                } catch (e) {
                    console.error('å…¬å…±é¢˜åº“åŠ è½½å¤±è´¥:', e);
                }
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                this.updateBankStats();
            }
        }).mount('#app');
    </script>
</body>
</html>