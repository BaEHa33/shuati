<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ - é«˜æ•ˆå­¦ä¹ åŠ©æ‰‹</title>
    <!-- æ ¸å¿ƒåº“ CDN å¼•å…¥ -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        
        :root {
            --primary: #07c160;
            --primary-light: #19be6b;
            --secondary: #f5f5f5;
            --accent: #ff6900;
            --danger: #fa5151;
            --success: #19be6b;
            --text-primary: #333333;
            --text-secondary: #666666;
            --bg-white: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        * {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }
        
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
        }
        
        .card {
            background: var(--bg-white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: scale(1.02);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .btn-danger:hover {
            background: #e64545;
            transform: scale(1.02);
        }
        
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .nav-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .nav-tab:hover:not(.active) {
            background: var(--secondary);
        }
        
        .question-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .question-option:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        
        .question-option.selected {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        
        .question-option.correct {
            border-color: var(--success);
            background: rgba(25, 190, 107, 0.1);
        }
        
        .question-option.wrong {
            border-color: var(--danger);
            background: rgba(250, 81, 81, 0.1);
        }
        
        .question-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .slider-container {
            position: relative;
            margin: 20px 0;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.5);
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        
        .file-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        .slide-enter-active, .slide-leave-active {
            transition: all 0.3s ease;
        }
        
        .slide-enter-from {
            transform: translateX(100px);
            opacity: 0;
        }
        
        .slide-leave-to {
            transform: translateX(-100px);
            opacity: 0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .mobile-full {
                width: 100%;
                margin: 8px 0;
            }
            
            .mobile-stack {
                flex-direction: column;
            }
            
            .mobile-padding {
                padding: 16px;
            }
            
            .bottom-nav button.active {
                color: #07c160;
                background: rgba(7, 193, 96, 0.1);
            }
            
            body {
                padding-bottom: 80px;
            }
            
            .mobile-dialog {
                margin: 16px;
                max-height: calc(100vh - 32px);
            }
        }
        
        /* åº•éƒ¨å¯¼èˆªæ¿€æ´»çŠ¶æ€ */
        .bottom-nav button.active {
            color: #07c160;
        }
        
        /* ç­”æ¡ˆæ˜¾ç¤ºæ ·å¼ */
        .answer-show {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
        
        .answer-correct {
            background: #f0fdf4;
            border-color: #16a34a;
        }
        
        .answer-wrong {
            background: #fef2f2;
            border-color: #dc2626;
        }
        
        .real-time-answer {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
        }
        
        @media (max-width: 768px) {
            .real-time-answer {
                position: fixed;
                bottom: 80px;
                top: auto;
                right: 10px;
                left: 10px;
                transform: none;
                max-width: none;
            }
        }
        
        /* æ ¼å¼è¯´æ˜æ ·å¼ */
        .format-sample {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* è€ƒè¯•æ¨¡å¼æ ·å¼ */
        .exam-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .exam-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 20px;
        }
        
        .exam-timer {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px 16px;
            display: inline-block;
        }
        
        .question-number {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .answer-card {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }
        
        .answer-card-item {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .answer-card-item:hover {
            transform: scale(1.05);
        }
        
        .answer-card-item.current {
            border: 3px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.2);
        }
        
        .answer-card-item.answered {
            background: var(--success);
            color: white;
        }
        
        .answer-card-item.unanswered {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .answer-card-item.marked {
            background: var(--accent);
            color: white;
        }
        
        .answer-card-item.wrong {
            background: var(--danger);
            color: white;
        }
        
        /* å¡«ç©ºé¢˜æ ·å¼ */
        .fill-input {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .fill-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        
        /* ç®€ç­”é¢˜æ ·å¼ */
        .essay-textarea {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            font-size: 16px;
            width: 100%;
            min-height: 200px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .essay-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        
        /* é…ç½®è¡¨å•æ ·å¼ */
        .config-form label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-primary);
        }
        
        .config-form input[type="number"],
        .config-form input[type="text"],
        .config-form select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .config-form input[type="number"]:focus,
        .config-form input[type="text"]:focus,
        .config-form select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(7, 193, 96, 0.1);
        }
        
        .config-tip {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 12px 16px;
            margin: 12px 0;
            border-radius: 4px;
        }
        
        .config-tip h4 {
            color: #0369a1;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .config-tip p {
            color: #0c4a6e;
            font-size: 14px;
        }
        
        /* è€ƒè¯•ç»“æœæ ·å¼ */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .result-score {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
        }
        
        .result-grade {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 32px;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .result-stat-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
        }
        
        .result-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .result-stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .result-grade.excellent { color: #16a34a; }
        .result-grade.good { color: #2563eb; }
        .result-grade.average { color: #d97706; }
        .result-grade.poor { color: #dc2626; }
        
        /* é€šçŸ¥ç³»ç»Ÿæ ·å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #16a34a;
        }
        
        .notification.error {
            background: #dc2626;
        }
        
        .notification.warning {
            background: #d97706;
        }
        
        .notification.info {
            background: #2563eb;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* éª¨æ¶å± */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* ä¼˜åŒ–çš„æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            padding: 2rem;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .loading-spinner-large {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å…¨å±€åŠ è½½çŠ¶æ€ -->
        <div v-if="isLoading" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner-large"></div>
                <div class="text-gray-600">{{ loadingMessage }}</div>
            </div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <nav class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-green-600">ğŸ“š æ™ºèƒ½åˆ·é¢˜</div>
                    </div>
                    <div class="hidden md:flex space-x-2">
                        <div class="nav-tab" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                            é¦–é¡µ
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                            è€ƒè¯•
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                            é”™é¢˜
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'records'}" @click="switchMode('records')">
                            è€ƒè¯•è®°å½•
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                            ç®¡ç†
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button class="btn-secondary text-sm" @click="shareLink">
                            åˆ†äº«
                        </button>
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" v-if="!currentUser">
                            <span class="text-green-600 text-sm cursor-pointer" @click="showLoginDialog = true">ğŸ‘¤</span>
                        </div>
                        <div class="flex items-center space-x-2" v-else>
                            <span class="text-sm text-gray-600">{{ currentUser.username }}</span>
                            <button class="text-red-600 text-sm" @click="logout">é€€å‡º</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="max-w-6xl mx-auto px-4 py-6">
            <!-- é¦–é¡µæ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'home'" key="home">
                    <!-- Hero åŒºåŸŸ -->
                    <div class="hero-bg rounded-2xl p-8 mb-8 relative">
                        <div class="relative z-10">
                            <h1 class="text-4xl font-bold text-white mb-4">
                                æ™ºèƒ½åˆ·é¢˜ï¼Œé«˜æ•ˆå­¦ä¹ 
                            </h1>
                            <p class="text-xl text-white mb-6">
                                æ”¯æŒå¤šç§é¢˜å‹ç»ƒä¹ ï¼Œæ”¯æŒå¯¼å…¥é¢˜åº“ï¼Œè®©å­¦ä¹ æ›´ç®€å•
                            </p>
                            <div class="flex flex-wrap gap-4">
                                <button class="btn-primary bg-white text-green-600 hover:bg-gray-100" @click="switchMode('exam')">
                                    å¼€å§‹è€ƒè¯•
                                </button>
                                <button class="btn-secondary bg-white text-gray-700 hover:bg-gray-100" @click="switchMode('manage')">
                                    é¢˜ç›®ç®¡ç†
                                </button>
                                <button class="btn-danger bg-orange-500 text-white hover:bg-orange-600" @click="switchMode('mistakes')">
                                    é”™é¢˜å¤ä¹ 
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- å­¦ä¹ ç»Ÿè®¡ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="stats-card">
                            <div class="stats-number">{{ totalQuestions }}</div>
                            <div class="stats-label">æ€»é¢˜æ•°</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ correctRate }}%</div>
                            <div class="stats-label">æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ studyHours }}</div>
                            <div class="stats-label">å­¦ä¹ æ—¶é•¿(h)</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ mistakeCount }}</div>
                            <div class="stats-label">é”™é¢˜æ•°</div>
                        </div>
                    </div>

                    <!-- åŠŸèƒ½å¡ç‰‡ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 cursor-pointer" @click="switchMode('exam')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“</div>
                                <h3 class="text-xl font-bold">å¼€å§‹è€ƒè¯•</h3>
                            </div>
                            <p class="text-gray-600 mb-4">é€‰æ‹©é¢˜å‹å’Œæ•°é‡ï¼Œå¼€å§‹ä¸€æ¬¡å®Œæ•´çš„æ¨¡æ‹Ÿè€ƒè¯•</p>
                            <div class="text-green-600 font-medium">ç«‹å³å¼€å§‹ â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="switchMode('mistakes')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">âŒ</div>
                                <h3 class="text-xl font-bold">é”™é¢˜ç®¡ç†</h3>
                            </div>
                            <p class="text-gray-600 mb-4">è‡ªåŠ¨æ”¶é›†é”™é¢˜ï¼Œé’ˆå¯¹æ€§å¤ä¹ ï¼Œæé«˜å­¦ä¹ æ•ˆç‡</p>
                            <div class="text-green-600 font-medium">æŸ¥çœ‹é”™é¢˜ â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="switchMode('manage')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“š</div>
                                <h3 class="text-xl font-bold">é¢˜åº“ç®¡ç†</h3>
                            </div>
                            <p class="text-gray-600 mb-4">å¯¼å…¥ã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®ï¼Œæ„å»ºä¸ªæ€§åŒ–é¢˜åº“</p>
                            <div class="text-green-600 font-medium">ç®¡ç†é¢˜åº“ â†’</div>
                        </div>
                    </div>

                    <!-- é¢˜åº“ç®¡ç† -->
                    <div class="card p-6">
                        <h3 class="text-2xl font-bold mb-6">é¢˜åº“ç®¡ç†</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-semibold mb-4">å¯¼å…¥é¢˜åº“</h4>
                                <div class="file-upload-area" 
                                     @drop="handleFileDrop" 
                                     @dragover="handleDragOver" 
                                     @dragleave="handleDragLeave" 
                                     @click="triggerFileInput"
                                     :class="{dragover: isDragging}">
                                    <div class="text-4xl mb-4">ğŸ“</div>
                                    <div class="text-lg font-medium mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                                    <div class="text-sm text-gray-500">æ”¯æŒ .txt, .docx, .json, .xlsx æ ¼å¼æ–‡ä»¶</div>
                                </div>
                                <input type="file" ref="fileInput" multiple accept=".txt,.docx,.json,.xlsx" @change="handleFileSelect" class="hidden">
                                <div class="mt-4">
                                    <button class="btn-primary w-full" @click="showFormatSample = true">
                                        æŸ¥çœ‹æ ¼å¼è¯´æ˜
                                    </button>
                                </div>
                                <div class="mt-4" v-if="uploadProgress > 0">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span>å¯¼å…¥è¿›åº¦</span>
                                        <span>{{ uploadProgress }}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" :style="{width: uploadProgress + '%'}"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-4">é¢˜åº“æ“ä½œ</h4>
                                <div class="space-y-3">
                                    <button class="btn-secondary w-full" @click="loadSampleQuestions">
                                        åŠ è½½ç¤ºä¾‹é¢˜åº“
                                    </button>
                                    <button class="btn-danger w-full" @click="clearQuestionBank">
                                        æ¸…ç©ºé¢˜åº“
                                    </button>
                                    <button class="btn-primary w-full" @click="switchMode('manage')">
                                        é¢˜ç›®ç®¡ç†
                                    </button>
                                </div>
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h5 class="font-semibold mb-2">å½“å‰é¢˜åº“çŠ¶æ€</h5>
                                    <div class="space-y-1 text-sm">
                                        <div>æ€»é¢˜æ•°ï¼š{{ questionBank.length }}</div>
                                        <div>å•é€‰é¢˜ï¼š{{ questionTypeCount.single }}</div>
                                        <div>å¤šé€‰é¢˜ï¼š{{ questionTypeCount.multiple }}</div>
                                        <div>åˆ¤æ–­é¢˜ï¼š{{ questionTypeCount.judge }}</div>
                                        <div>å¡«ç©ºé¢˜ï¼š{{ questionTypeCount.fill }}</div>
                                        <div>ç®€ç­”é¢˜ï¼š{{ questionTypeCount.essay }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- è€ƒè¯•æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'exam'" key="exam">
                    <!-- è€ƒè¯•é…ç½® -->
                    <div v-if="!isExamStarted" class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-center">è€ƒè¯•é…ç½®</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="config-form space-y-4">
                                <div>
                                    <label>è€ƒè¯•ç±»å‹</label>
                                    <select v-model="examConfig.rule" class="w-full p-3 border rounded-lg">
                                        <option value="random">éšæœºæŠ½é¢˜</option>
                                        <option value="sequential">é¡ºåºå‡ºé¢˜</option>
                                        <option value="difficulty">æŒ‰éš¾åº¦å‡ºé¢˜</option>
                                    </select>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label>å•é€‰é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.single" min="0" :max="questionTypeCount.single" class="w-full">
                                    </div>
                                    <div>
                                        <label>å¤šé€‰é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.multiple" min="0" :max="questionTypeCount.multiple" class="w-full">
                                    </div>
                                    <div>
                                        <label>åˆ¤æ–­é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.judge" min="0" :max="questionTypeCount.judge" class="w-full">
                                    </div>
                                    <div>
                                        <label>å¡«ç©ºé¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.fill" min="0" :max="questionTypeCount.fill" class="w-full">
                                    </div>
                                    <div>
                                        <label>ç®€ç­”é¢˜æ•°é‡</label>
                                        <input type="number" v-model.number="examConfig.essay" min="0" :max="questionTypeCount.essay" class="w-full">
                                    </div>
                                </div>
                                
                                <div>
                                    <label>è€ƒè¯•æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                    <input type="number" v-model.number="examConfig.time" min="1" max="300" class="w-full">
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.enableTimer" id="enableTimer">
                                    <label for="enableTimer">å¯ç”¨è®¡æ—¶å™¨</label>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.showAnswerImmediately" id="showAnswerImmediately">
                                    <label for="showAnswerImmediately">ç«‹å³æ˜¾ç¤ºç­”æ¡ˆ</label>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" v-model="examConfig.showAnalysis" id="showAnalysis">
                                    <label for="showAnalysis">æ˜¾ç¤ºè§£æ</label>
                                </div>
                            </div>
                            
                            <div>
                                <div class="config-tip mb-6">
                                    <h4>ğŸ“Š é¢˜åº“ç»Ÿè®¡</h4>
                                    <p>å½“å‰é¢˜åº“å…±æœ‰ {{ questionBank.length }} é“é¢˜ç›®ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„é¢˜ç›®æ•°é‡ã€‚</p>
                                </div>
                                
                                <div class="config-tip mb-6">
                                    <h4>â° æ—¶é—´å»ºè®®</h4>
                                    <p>å»ºè®®æ¯é“å•é€‰é¢˜2åˆ†é’Ÿï¼Œå¤šé€‰é¢˜3åˆ†é’Ÿï¼Œåˆ¤æ–­é¢˜1åˆ†é’Ÿï¼Œå¡«ç©ºé¢˜3åˆ†é’Ÿï¼Œç®€ç­”é¢˜5åˆ†é’Ÿã€‚</p>
                                </div>
                                
                                <div class="config-tip mb-6">
                                    <h4>ğŸ¯ è€ƒè¯•å»ºè®®</h4>
                                    <p>å»ºè®®ä¸€æ¬¡æ€§é€‰æ‹©ä¸è¶…è¿‡50é“é¢˜ç›®ï¼Œä¿æŒæ³¨æ„åŠ›é›†ä¸­ï¼Œæé«˜å­¦ä¹ æ•ˆç‡ã€‚</p>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                                    <h4 class="text-green-700 font-semibold mb-2">ğŸ“ è€ƒè¯•é¢„è§ˆ</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>å•é€‰é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.single }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å¤šé€‰é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.multiple }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>åˆ¤æ–­é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.judge }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å¡«ç©ºé¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.fill }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>ç®€ç­”é¢˜ï¼š</span>
                                            <span class="font-medium">{{ examConfig.essay }} é“</span>
                                        </div>
                                        <hr class="my-2">
                                        <div class="flex justify-between font-semibold">
                                            <span>æ€»è®¡ï¼š</span>
                                            <span>{{ totalExamQuestions }} é“</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>å»ºè®®æ—¶é—´ï¼š</span>
                                            <span>{{ suggestedTime }} åˆ†é’Ÿ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <button class="btn-primary w-full" @click="startExam" :disabled="totalExamQuestions === 0">
                                        ğŸš€ å¼€å§‹è€ƒè¯•
                                    </button>
                                    <button class="btn-secondary w-full" @click="loadRecommendedConfig">
                                        ğŸ“‹ æ¨èé…ç½®
                                    </button>
                                    <button class="btn-secondary w-full" @click="resetConfig">
                                        ğŸ”„ é‡ç½®é…ç½®
                                    </button>
                                </div>
                                
                                <div v-if="totalExamQuestions === 0" class="mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm text-center">
                                    è¯·è‡³å°‘é€‰æ‹©ä¸€é“é¢˜ç›®ï¼
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•è¿›è¡Œä¸­ -->
                    <div v-else-if="isExamStarted && !isExamFinished" class="exam-container">
                        <!-- è€ƒè¯•å¤´éƒ¨ -->
                        <div class="exam-header flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold mb-2">æ™ºèƒ½åˆ·é¢˜è€ƒè¯•</h2>
                                <div class="text-sm opacity-90">
                                    ç¬¬ {{ currentQuestionIndex + 1 }} é¢˜ / å…± {{ currentQuestions.length }} é¢˜
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div v-if="examConfig.enableTimer" class="exam-timer">
                                    â° {{ formatTime(remainingTime) }}
                                </div>
                                <button class="btn-secondary text-sm" @click="pauseExamDialog = true">
                                    â¸ï¸ æš‚åœ
                                </button>
                            </div>
                        </div>
                        
                        <!-- é¢˜ç›®å†…å®¹ -->
                        <div class="p-6">
                            <div class="mb-6">
                                <div class="flex items-center mb-4">
                                    <div class="question-number mr-3">{{ currentQuestionIndex + 1 }}</div>
                                    <div class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                        {{ getQuestionTypeText(currentQuestion.type) }}
                                    </div>
                                </div>
                                <div class="text-lg mb-6" v-html="currentQuestion.content"></div>
                                
                                <!-- å•é€‰é¢˜ -->
                                <div v-if="currentQuestion.type === 'single'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] === index,
                                            correct: currentAnswerSubmitted && index === currentQuestion.answer,
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] === index && index !== currentQuestion.answer,
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¤šé€‰é¢˜ -->
                                <div v-if="currentQuestion.type === 'multiple'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].includes(index),
                                            correct: currentAnswerSubmitted && currentQuestion.answer.includes(index),
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].includes(index) && !currentQuestion.answer.includes(index),
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- åˆ¤æ–­é¢˜ -->
                                <div v-if="currentQuestion.type === 'judge'" class="space-y-3">
                                    <div 
                                        v-for="(option, index) in currentQuestion.options" 
                                        :key="index"
                                        class="question-option"
                                        :class="{
                                            selected: userAnswers[currentQuestionIndex] === index,
                                            correct: currentAnswerSubmitted && index === currentQuestion.answer,
                                            wrong: currentAnswerSubmitted && userAnswers[currentQuestionIndex] === index && index !== currentQuestion.answer,
                                            disabled: currentAnswerSubmitted
                                        }"
                                        @click="selectOption(index)"
                                    >
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 text-sm font-medium">
                                                {{ String.fromCharCode(65 + index) }}
                                            </div>
                                            <div>{{ option }}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¡«ç©ºé¢˜ -->
                                <div v-if="currentQuestion.type === 'fill'" class="mb-6">
                                    <input 
                                        type="text" 
                                        v-model="userAnswers[currentQuestionIndex]"
                                        class="fill-input"
                                        :disabled="currentAnswerSubmitted"
                                        placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..."
                                        @input="saveFillAnswer"
                                    >
                                </div>
                                
                                <!-- ç®€ç­”é¢˜ -->
                                <div v-if="currentQuestion.type === 'essay'" class="mb-6">
                                    <textarea 
                                        v-model="userAnswers[currentQuestionIndex]"
                                        class="essay-textarea"
                                        :disabled="currentAnswerSubmitted"
                                        placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..."
                                        @input="saveEssayAnswer"
                                    ></textarea>
                                </div>
                                
                                <!-- ç­”æ¡ˆè§£æ -->
                                <div v-if="currentAnswerSubmitted" class="answer-show mt-6" :class="currentAnswerClass">
                                    <div class="flex items-center mb-3">
                                        <div class="text-lg mr-2">ğŸ“</div>
                                        <h4 class="font-semibold">ç­”æ¡ˆè§£æ</h4>
                                    </div>
                                    <div class="mb-3">
                                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                                    </div>
                                    <div v-if="currentQuestion.analysis" class="text-sm text-gray-700">
                                        <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="flex flex-wrap gap-3">
                                <button 
                                    class="btn-primary" 
                                    @click="submitCurrentAnswer"
                                    :disabled="currentAnswerSubmitted || !hasAnswerForCurrentQuestion"
                                >
                                    {{ currentAnswerSubmitted ? 'âœ“ å·²æäº¤' : 'ğŸ“¤ æäº¤ç­”æ¡ˆ' }}
                                </button>
                                <button 
                                    class="btn-secondary" 
                                    @click="markQuestion"
                                    :class="{active: markedQuestions.has(currentQuestionIndex)}"
                                >
                                    {{ markedQuestions.has(currentQuestionIndex) ? 'â­ å·²æ ‡è®°' : 'â˜† æ ‡è®°' }}
                                </button>
                                <button 
                                    class="btn-secondary" 
                                    @click="nextQuestion"
                                >
                                    â¡ï¸ ä¸‹ä¸€é¢˜
                                </button>
                            </div>
                        </div>
                        
                        <!-- ç­”é¢˜å¡ -->
                        <div class="border-t p-6">
                            <h4 class="font-semibold mb-4">ğŸ“‹ ç­”é¢˜å¡</h4>
                            <div class="answer-card">
                                <div 
                                    v-for="(question, index) in currentQuestions" 
                                    :key="index"
                                    class="answer-card-item"
                                    :class="getAnswerCardClass(index)"
                                    @click="jumpToQuestion(index)"
                                >
                                    {{ index + 1 }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•ç»“æœ -->
                    <div v-if="isExamFinished" class="card p-6 text-center">
                        <div class="result-container">
                            <div class="result-score">{{ examResult.score }}åˆ†</div>
                            <div class="result-grade" :class="examResult.gradeClass">
                                {{ examResult.grade }}
                            </div>
                            
                            <div class="result-stats">
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.totalQuestions }}</div>
                                    <div class="result-stat-label">æ€»é¢˜æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.correctCount }}</div>
                                    <div class="result-stat-label">æ­£ç¡®æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ examResult.wrongCount }}</div>
                                    <div class="result-stat-label">é”™è¯¯æ•°</div>
                                </div>
                                <div class="result-stat-item">
                                    <div class="result-stat-number">{{ formatTime(examResult.duration) }}</div>
                                    <div class="result-stat-label">ç”¨æ—¶</div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <button class="btn-primary" @click="reviewExam">
                                    ğŸ“Š æŸ¥çœ‹è¯¦æƒ…
                                </button>
                                <button class="btn-secondary" @click="startNewExam">
                                    ğŸ”„ é‡æ–°è€ƒè¯•
                                </button>
                                <button class="btn-secondary" @click="switchMode('home')">
                                    ğŸ  è¿”å›é¦–é¡µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- é”™é¢˜æœ¬æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'records'" key="records">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-2">ğŸ“Š è€ƒè¯•è®°å½•</h2>
                        <p class="text-gray-600">æŸ¥çœ‹æ‚¨çš„å†å²è€ƒè¯•æˆç»©å’Œè¿›æ­¥</p>
                    </div>
                    
                    <!-- è€ƒè¯•ç»Ÿè®¡æ¦‚è§ˆ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æ€»è€ƒè¯•æ¬¡æ•°</div>
                            <div class="text-2xl font-bold">{{ studyStats.examRecords.length }}</div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æœ€é«˜åˆ†</div>
                            <div class="text-2xl font-bold text-green-600">
                                {{ getMaxScore() }}åˆ†
                            </div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">å¹³å‡åˆ†</div>
                            <div class="text-2xl font-bold text-blue-600">
                                {{ getAverageScore() }}åˆ†
                            </div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-sm text-gray-600 mb-1">æœ€è¿‘æˆç»©</div>
                            <div class="text-2xl font-bold" :class="getScoreClass(getLatestScore())">
                                {{ getLatestScore() }}åˆ†
                            </div>
                        </div>
                    </div>
                    
                    <!-- æˆç»©è¶‹åŠ¿å›¾ -->
                    <div class="card p-6 mb-6" v-if="studyStats.examRecords.length > 1">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ æˆç»©è¶‹åŠ¿</h3>
                        <div class="h-64">
                            <canvas id="scoreChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- è€ƒè¯•è®°å½•åˆ—è¡¨ -->
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“‹ å†å²è®°å½•</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">è€ƒè¯•æ—¶é—´</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">å¾—åˆ†</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ­£ç¡®é¢˜æ•°</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ€»é¢˜æ•°</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ç”¨æ—¶</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr v-for="(record, index) in studyStats.examRecords" :key="index" class="hover:bg-gray-50">
                                        <td class="px-4 py-3 text-sm">{{ formatDate(record.date) }}</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span :class="['font-medium', getScoreClass(record.score)]">
                                                {{ record.score }}åˆ†
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm">{{ record.correctCount }}</td>
                                        <td class="px-4 py-3 text-sm">{{ record.totalQuestions }}</td>
                                        <td class="px-4 py-3 text-sm">{{ formatDuration(record.duration) }}</td>
                                        <td class="px-4 py-3 text-sm">
                                            <button class="text-blue-600 hover:text-blue-800 mr-3" @click="viewExamDetail(record)">
                                                è¯¦æƒ…
                                            </button>
                                            <button class="text-red-600 hover:text-red-800" @click="deleteExamRecord(index)">
                                                åˆ é™¤
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div v-if="studyStats.examRecords.length === 0" class="text-center py-8 text-gray-500">
                            æš‚æ— è€ƒè¯•è®°å½•
                        </div>
                    </div>
                </div>
                
                <div v-if="currentMode === 'mistakes'" key="mistakes">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">é”™é¢˜æœ¬</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="mistakeFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æ—¶é—´èŒƒå›´</label>
                                        <select v-model="mistakeFilter.timeRange" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="today">ä»Šå¤©</option>
                                            <option value="week">æœ¬å‘¨</option>
                                            <option value="month">æœ¬æœˆ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" v-model="mistakeFilter.importantOnly" class="mr-2">
                                            <span class="text-sm">åªçœ‹é‡ç‚¹é”™é¢˜</span>
                                        </label>
                                    </div>
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">é¢˜ç›®ç®¡ç†</label>
                                        <button class="btn-primary w-full mb-2" @click="startMistakePractice">
                                            é”™é¢˜ç»ƒä¹ 
                                        </button>
                                        <button class="btn-secondary w-full text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredMistakes.length }} é“é”™é¢˜
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="btn-secondary text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                        <button class="btn-danger text-sm" @click="clearMistakes">
                                            æ¸…ç©ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div v-for="(mistake, index) in filteredMistakes" :key="mistake.id" class="border rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(mistake.type) }}
                                                </span>
                                                <span class="text-gray-500 text-sm">{{ formatDate(mistake.mistakeTime) }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button @click="toggleImportant(mistake)" class="text-sm" :class="mistake.isImportant ? 'text-orange-600' : 'text-gray-400'">
                                                    {{ mistake.isImportant ? 'â­' : 'â˜†' }}
                                                </button>
                                                <button @click="removeMistake(mistake)" class="text-red-600 text-sm">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="mistake.content"></div>
                                        <div class="text-sm text-gray-600 mb-3">
                                            <div><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.answer) }}</div>
                                            <div><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.wrongAnswer) }}</div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="btn-primary text-sm" @click="reviewMistake(mistake)">
                                                é‡æ–°ç»ƒä¹ 
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- ç®¡ç†é¡µé¢ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'manage'" key="manage">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6">é¢˜ç›®ç®¡ç†</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="manageFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æœç´¢</label>
                                        <input type="text" v-model="manageFilter.search" placeholder="æœç´¢é¢˜ç›®å†…å®¹..." class="w-full p-2 border rounded-lg">
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredManageQuestions.length }} é“é¢˜ç›®
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" :checked="isAllSelected" @change="toggleSelectAllQuestions" class="mr-2">
                                            <span class="text-sm">å…¨é€‰</span>
                                        </label>
                                        <button class="btn-danger text-sm" @click="deleteSelectedQuestions">
                                            æ‰¹é‡åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                                <div class="question-manager space-y-4">
                                    <div v-for="(question, index) in filteredManageQuestions" :key="question.id" class="border rounded-lg p-4 question-item relative">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <label class="inline-block mr-2 cursor-pointer">
                                                    <input type="checkbox" v-model="question.selected" class="mr-1">
                                                </label>
                                                <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(question.type) }}
                                                </span>
                                                <span class="text-gray-500 text-sm">#{{ index + 1 }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button @click="editQuestion(question)" class="text-blue-600 text-sm">
                                                    ç¼–è¾‘
                                                </button>
                                                <button @click="deleteQuestion(question)" class="text-red-600 text-sm">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="question.content.substring(0, 200) + (question.content.length > 200 ? '...' : '')"></div>
                                        <div class="text-sm text-gray-600">
                                            <div v-if="question.options && question.options.length">
                                                <strong>é€‰é¡¹:</strong> {{ question.options.length }} ä¸ª
                                            </div>
                                            <div v-if="question.analysis">
                                                <strong>è§£æ:</strong> {{ question.analysis.substring(0, 100) + (question.analysis.length > 100 ? '...' : '') }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
        </main>

        <!-- æ¨¡æ€å¯¹è¯æ¡† -->
        <!-- ç™»å½•å¯¹è¯æ¡† -->
        <div v-if="showLoginDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showLoginDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">ç”¨æˆ·ç™»å½•</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
                        <input 
                            type="text" 
                            v-model="loginForm.username" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">å¯†ç </label>
                        <input 
                            type="password" 
                            v-model="loginForm.password" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button class="btn-secondary" @click="showLoginDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="login">
                        ç™»å½•
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">é¦–æ¬¡ç™»å½•å°†è‡ªåŠ¨åˆ›å»ºè´¦æˆ·</p>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®ç±»å‹é€‰æ‹©å¯¹è¯æ¡† -->
        <div v-if="showQuestionTypeDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">é€‰æ‹©é¢˜åº“ç±»å‹</h3>
                <div class="space-y-3 mb-6">
                    <div v-for="(question, index) in pendingQuestions" :key="index" class="border rounded-lg p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">é¢˜ç›® {{ index + 1 }}</span>
                            <select v-model="question.selectedType" class="text-sm p-1 border rounded">
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="fill">å¡«ç©ºé¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="text-sm" v-html="question.content.substring(0, 100) + (question.content.length > 100 ? '...' : '')"></div>
                        <label class="flex items-center mt-2">
                            <input type="checkbox" v-model="question.selected" class="mr-2">
                            <span class="text-sm">å¯¼å…¥æ­¤é¢˜</span>
                        </label>
                    </div>
                </div>
                <!-- æ‰¹é‡æ“ä½œ -->
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" v-model="selectAllPending" @change="toggleSelectAll" class="mr-2">
                            <span class="text-sm">å…¨é€‰</span>
                        </label>
                        <select v-model="batchType" class="text-sm p-1 border rounded">
                            <option value="">æ‰¹é‡è®¾ç½®ç±»å‹</option>
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                            <option value="judge">åˆ¤æ–­é¢˜</option>
                            <option value="fill">å¡«ç©ºé¢˜</option>
                            <option value="essay">ç®€ç­”é¢˜</option>
                        </select>
                        <button @click="applyBatchType" class="btn-primary text-sm">åº”ç”¨</button>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button class="btn-secondary" @click="showQuestionTypeDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="confirmImport">
                        ç¡®è®¤å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>

        <!-- æ ¼å¼è¯´æ˜å¯¹è¯æ¡† -->
        <div v-if="showFormatSample" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">æ–‡ä»¶æ ¼å¼è¯´æ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-2">TXTæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
**å•é€‰é¢˜**<br>
1. ä»¥ä¸‹å“ªä¸ªæ˜¯JavaScriptçš„å…³é”®å­—ï¼Ÿ<br>
   A. class<br>
   B. function<br>
   C. method<br>
   D. type<br>
   ç­”æ¡ˆï¼šB<br>
   è§£æï¼šfunctionæ˜¯JavaScriptä¸­å®šä¹‰å‡½æ•°çš„å…³é”®å­—<br>
<br>
**å¤šé€‰é¢˜**<br>
<br>
1. ä»¥ä¸‹å“ªäº›å±äºä¸‰å‰‚ç±»ç‰©èµ„ï¼Ÿ<br>
   A.å‚¬åŒ–å‰‚<br>
   B.æ·»åŠ å‰‚<br>
   C.æº¶å‰‚<br>
   D.é˜€é—¨ç±»<br>
   ç­”æ¡ˆï¼šA,B,C<br>
   è§£æï¼šä¸‰å‰‚ç±»ä¸»è¦æŒ‡å‚¬åŒ–å‰‚ã€æ·»åŠ å‰‚ã€æº¶å‰‚ç­‰...
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Excelæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
è¡¨å¤´ï¼šé¢˜å‹ | é¢˜å¹² | é€‰é¡¹A | é€‰é¡¹B | é€‰é¡¹C | é€‰é¡¹D | ç­”æ¡ˆ | è§£æ<br>
ç¤ºä¾‹ï¼š<br>
single | é¢˜ç›®å†…å®¹ | é€‰é¡¹1 | é€‰é¡¹2 | é€‰é¡¹3 | é€‰é¡¹4 | B | è§£æå†…å®¹
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">JSONæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
[<br>
  {<br>
    "type": "single",<br>
    "content": "é¢˜ç›®å†…å®¹",<br>
    "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"],<br>
    "answer": 1,<br>
    "analysis": "è§£æå†…å®¹"<br>
  }<br>
]
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn-primary" @click="showFormatSample = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- åˆ†äº«é€‰é¡¹å¼¹çª— -->
        <div v-if="showQRCode" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showQRCode = false">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">åˆ†äº«å­¦ä¹ åº”ç”¨</h3>
                <div class="space-y-3 mb-4">
                    <button class="btn-primary w-full" @click="copyLink">
                        ğŸ“‹ å¤åˆ¶åˆ†äº«é“¾æ¥
                    </button>
                    <button class="btn-secondary w-full" @click="exportData">
                        ğŸ’¾ å¯¼å‡ºå­¦ä¹ æ•°æ®
                    </button>
                    <button class="btn-secondary w-full" @click="importData">
                        ğŸ“¥ å¯¼å…¥å­¦ä¹ æ•°æ®
                    </button>
                </div>
                <!-- äºŒç»´ç  -->
                <div class="text-center mb-4">
                    <div id="qrcode" class="inline-block"></div>
                    <p class="text-xs text-gray-500 mt-2">æ‰«ç è®¿é—®å­¦ä¹ ç³»ç»Ÿ</p>
                </div>
                <div class="share-link text-center mb-4">
                    <small>{{ currentUrl }}</small>
                </div>
                <p class="text-xs text-gray-500 text-center mb-4">
                    é“¾æ¥åˆ†äº«æ›´ä¾¿æ·ï¼Œé€‚åˆå„ç§è®¾å¤‡ä½¿ç”¨
                </p>
                <button class="btn-secondary w-full" @click="showQRCode = false">
                    å…³é—­
                </button>
            </div>
        </div>

        <!-- æš‚åœè€ƒè¯•å¯¹è¯æ¡† -->
        <div v-if="pauseExamDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 text-center">
                <div class="text-4xl mb-4">â¸ï¸</div>
                <h3 class="text-xl font-bold mb-2">è€ƒè¯•å·²æš‚åœ</h3>
                <p class="text-gray-600 mb-6">æ‚¨çš„è€ƒè¯•è¿›åº¦å·²ä¿å­˜ï¼Œå¯ä»¥éšæ—¶ç»§ç»­</p>
                <div class="space-y-3">
                    <button class="btn-primary w-full" @click="resumeExam">
                        â–¶ï¸ ç»§ç»­è€ƒè¯•
                    </button>
                    <button class="btn-secondary w-full" @click="submitExam">
                        ğŸ“¤ æäº¤è€ƒè¯•
                    </button>
                    <button class="btn-danger w-full" @click="abandonExam">
                        âŒ æ”¾å¼ƒè€ƒè¯•
                    </button>
                </div>
            </div>
        </div>

        <!-- å®æ—¶ç­”æ¡ˆæ˜¾ç¤º -->
        <div v-if="showRealTimeAnswer && currentAnswerShown" class="real-time-answer">
            <div class="text-sm font-semibold mb-2">ç­”æ¡ˆ</div>
            <div :class="currentAnswerClass">
                <div class="mb-1">
                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                </div>
                <div v-if="currentQuestion.analysis">
                    <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                </div>
                <div v-if="userAnswers[currentQuestionIndex] !== undefined">
                    <div v-if="isAnswerCorrect(currentQuestionIndex)" class="text-green-600">
                        âœ… å›ç­”æ­£ç¡®ï¼
                    </div>
                    <div v-else class="text-red-600">
                        âŒ å›ç­”é”™è¯¯
                    </div>
                </div>
            </div>
        </div>

        <!-- è€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡† -->
        <div v-if="showExamDetail" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showExamDetail = false">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ“Š è€ƒè¯•è¯¦æƒ…</h3>
                    <button class="text-gray-500 hover:text-gray-700" @click="showExamDetail = false">
                        âœ•
                    </button>
                </div>
                
                <div v-if="currentExamDetail" class="space-y-6">
                    <!-- è€ƒè¯•æ¦‚è§ˆ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">å¾—åˆ†</div>
                                <div class="text-2xl font-bold" :class="getScoreClass(currentExamDetail.score)">
                                    {{ currentExamDetail.score }}åˆ†
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">ç­‰çº§</div>
                                <div class="text-xl font-bold" :class="getGradeClass(currentExamDetail.grade)">
                                    {{ currentExamDetail.grade }}
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">æ­£ç¡®é¢˜æ•°</div>
                                <div class="text-xl font-bold text-green-600">
                                    {{ currentExamDetail.correctCount }}
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">é”™è¯¯é¢˜æ•°</div>
                                <div class="text-xl font-bold text-red-600">
                                    {{ currentExamDetail.wrongCount }}
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-center text-sm text-gray-600">
                            è€ƒè¯•æ—¶é—´ï¼š{{ formatDate(currentExamDetail.date) }} | 
                            ç”¨æ—¶ï¼š{{ formatDuration(currentExamDetail.duration) }}
                        </div>
                    </div>
                    
                    <!-- é¢˜ç›®è¯¦æƒ…åˆ—è¡¨ -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4">é¢˜ç›®è¯¦æƒ…</h4>
                        <div class="space-y-4">
                            <div v-for="(question, index) in currentExamDetail.questions" :key="index" 
                                 class="border rounded-lg p-4" :class="question.isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center">
                                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2">
                                            {{ index + 1 }}
                                        </span>
                                        <span class="text-sm font-medium">{{ getQuestionTypeText(question.type) }}</span>
                                    </div>
                                    <span :class="question.isCorrect ? 'text-green-600' : 'text-red-600'">
                                        {{ question.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯' }}
                                    </span>
                                </div>
                                
                                <div class="mb-3 text-sm" v-html="question.content"></div>
                                
                                <div class="space-y-2 text-sm">
                                    <div>
                                        <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong>
                                        <span :class="question.isCorrect ? 'text-green-600' : 'text-red-600'">
                                            {{ formatAnswer(question.userAnswer) }}
                                        </span>
                                    </div>
                                    <div v-if="!question.isCorrect">
                                        <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>
                                        <span class="text-green-600">
                                            {{ formatAnswer(question.correctAnswer) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button class="btn-secondary" @click="showExamDetail = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç¼–è¾‘é¢˜ç›®å¯¹è¯æ¡† -->
        <div v-if="showEditDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">ç¼–è¾‘é¢˜ç›®</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">é¢˜ç›®ç±»å‹</label>
                        <select v-model="editingQuestion.type" class="w-full p-2 border rounded-lg">
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                            <option value="judge">åˆ¤æ–­é¢˜</option>
                            <option value="fill">å¡«ç©ºé¢˜</option>
                            <option value="essay">ç®€ç­”é¢˜</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">é¢˜ç›®å†…å®¹</label>
                        <textarea v-model="editingQuestion.content" class="w-full p-2 border rounded-lg" rows="3" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
                    </div>
                    
                    <!-- é€‰æ‹©é¢˜å’Œåˆ¤æ–­é¢˜çš„é€‰é¡¹ -->
                    <div v-if="editingQuestion.type === 'single' || editingQuestion.type === 'multiple' || editingQuestion.type === 'judge'" class="p-3 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">é€‰é¡¹</label>
                        <div v-if="editingQuestion.type === 'judge'" class="text-sm text-gray-600 mb-2">
                            åˆ¤æ–­é¢˜å°†è‡ªåŠ¨ä½¿ç”¨"æ­£ç¡®"å’Œ"é”™è¯¯"ä½œä¸ºé€‰é¡¹
                        </div>
                        <div v-if="editingQuestion.type !== 'judge'" class="space-y-2">
                            <div v-for="(option, index) in editingQuestion.options" :key="index" class="flex items-center space-x-2">
                                <span class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-200 text-sm font-medium">
                                    {{ String.fromCharCode(65 + index) }}
                                </span>
                                <input type="text" v-model="editingQuestion.options[index]" class="flex-1 p-2 border rounded-lg" placeholder="è¯·è¾“å…¥é€‰é¡¹å†…å®¹...">
                                <button @click="removeOption(index)" class="btn-danger text-sm" :disabled="editingQuestion.options.length <= 2">åˆ é™¤</button>
                            </div>
                            <button @click="addOption" class="btn-secondary text-sm" :disabled="editingQuestion.options.length >= 10">
                                æ·»åŠ é€‰é¡¹
                            </button>
                        </div>
                    </div>
                    
                    <!-- å•é€‰é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'single'" class="p-3 bg-blue-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <select v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg">
                            <option value="" disabled>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>
                            <option v-for="(option, index) in editingQuestion.options" :key="index" :value="index">
                                {{ String.fromCharCode(65 + index) }}. {{ option }}
                            </option>
                        </select>
                    </div>
                    
                    <!-- å¤šé€‰é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'multiple'" class="p-3 bg-purple-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆï¼ˆå¯å¤šé€‰ï¼‰</label>
                        <div class="space-y-2">
                            <div v-for="(option, index) in editingQuestion.options" :key="index" class="flex items-center">
                                <input type="checkbox" :value="index" v-model="editingQuestion.answer" class="mr-2">
                                <span>{{ String.fromCharCode(65 + index) }}. {{ option }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åˆ¤æ–­é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'judge'" class="p-3 bg-green-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <select v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg">
                            <option value="" disabled>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>
                            <option value="0">æ­£ç¡®</option>
                            <option value="1">é”™è¯¯</option>
                        </select>
                    </div>
                    
                    <!-- å¡«ç©ºé¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'fill'" class="p-3 bg-yellow-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">æ­£ç¡®ç­”æ¡ˆ</label>
                        <input type="text" v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg" placeholder="è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆ...">
                        <div class="text-xs text-gray-600 mt-1">
                            æç¤ºï¼šå¯ä»¥ä½¿ç”¨å¤šä¸ªç­”æ¡ˆï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ï¼šç­”æ¡ˆ1,ç­”æ¡ˆ2,ç­”æ¡ˆ3ï¼‰
                        </div>
                    </div>
                    
                    <!-- ç®€ç­”é¢˜ç­”æ¡ˆ -->
                    <div v-if="editingQuestion.type === 'essay'" class="p-3 bg-red-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">å‚è€ƒç­”æ¡ˆ</label>
                        <textarea v-model="editingQuestion.answer" class="w-full p-2 border rounded-lg" rows="4" placeholder="è¯·è¾“å…¥å‚è€ƒç­”æ¡ˆ..."></textarea>
                        <div class="text-xs text-gray-600 mt-1">
                            æç¤ºï¼šç®€ç­”é¢˜ç­”æ¡ˆç”¨äºå‚è€ƒï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨è¯„åˆ†
                        </div>
                    </div>
                    
                    <!-- è§£æ -->
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium mb-2">è§£æ</label>
                        <textarea v-model="editingQuestion.analysis" class="w-full p-2 border rounded-lg" rows="3" placeholder="è¯·è¾“å…¥é¢˜ç›®è§£æ..."></textarea>
                    </div>
                    
                    <!-- æ ‡ç­¾ -->
                    <div>
                        <label class="block text-sm font-medium mb-2">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šjavascript,åŸºç¡€,å‡½æ•°ï¼‰</label>
                        <input type="text" v-model="editingQuestion.tags" class="w-full p-2 border rounded-lg" placeholder="è¯·è¾“å…¥æ ‡ç­¾...">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button class="btn-secondary" @click="closeEditDialog">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="saveEditQuestion">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>

        <!-- è€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡† -->
        <div v-if="showExamDetailDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showExamDetailDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto" @click.stop>
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ“Š è€ƒè¯•è¯¦æƒ…</h3>
                    <button class="text-gray-500 hover:text-gray-700" @click="showExamDetailDialog = false">
                        âœ•
                    </button>
                </div>
                
                <!-- è€ƒè¯•æ¦‚è§ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">{{ examResult.score }}</div>
                        <div class="text-sm text-gray-600">å¾—åˆ†</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">{{ examResult.totalQuestions }}</div>
                        <div class="text-sm text-gray-600">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">{{ examResult.correctCount }}</div>
                        <div class="text-sm text-gray-600">æ­£ç¡®æ•°</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">{{ examResult.wrongCount }}</div>
                        <div class="text-sm text-gray-600">é”™è¯¯æ•°</div>
                    </div>
                </div>
                
                <!-- é¢˜ç›®è¯¦æƒ… -->
                <div class="space-y-6">
                    <div v-for="(question, index) in currentQuestions" :key="index" class="border rounded-lg p-4">
                        <div class="flex items-center mb-3">
                            <div class="question-number mr-3">{{ index + 1 }}</div>
                            <div class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                {{ getQuestionTypeText(question.type) }}
                            </div>
                            <div class="ml-auto">
                                <span :class="isAnswerCorrect(index) ? 'text-green-600 font-medium' : 'text-red-600 font-medium'">
                                    {{ isAnswerCorrect(index) ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯' }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="mb-3" v-html="question.content"></div>
                        
                        <!-- é€‰é¡¹ -->
                        <div v-if="question.options && question.options.length > 0" class="space-y-2 mb-3">
                            <div 
                                v-for="(option, optIndex) in question.options" 
                                :key="optIndex"
                                class="text-sm"
                                :class="{
                                    'text-green-600 bg-green-50 p-2 rounded': question.answer === optIndex || (Array.isArray(question.answer) && question.answer.includes(optIndex)),
                                    'text-red-600 bg-red-50 p-2 rounded': userAnswers[index] === optIndex && question.answer !== optIndex || 
                                                                           (Array.isArray(userAnswers[index]) && userAnswers[index].includes(optIndex) && 
                                                                            Array.isArray(question.answer) && !question.answer.includes(optIndex))
                                }"
                            >
                                <strong>{{ String.fromCharCode(65 + optIndex) }}.</strong> {{ option }}
                                <span v-if="question.answer === optIndex || (Array.isArray(question.answer) && question.answer.includes(optIndex))" class="ml-2">âœ“</span>
                                <span v-if="userAnswers[index] === optIndex && question.answer !== optIndex || 
                                           (Array.isArray(userAnswers[index]) && userAnswers[index].includes(optIndex) && 
                                            Array.isArray(question.answer) && !question.answer.includes(optIndex))" class="ml-2">âœ—</span>
                            </div>
                        </div>
                        
                        <!-- å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜ -->
                        <div v-else class="mb-3">
                            <div class="text-sm mb-2">
                                <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ userAnswers[index] || 'æœªä½œç­”' }}
                            </div>
                            <div class="text-sm text-green-600">
                                <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(question.answer) }}
                            </div>
                        </div>
                        
                        <!-- è§£æ -->
                        <div v-if="question.analysis && examConfig.showAnalysis" class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                            <strong>è§£æï¼š</strong> {{ question.analysis }}
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-center mt-6">
                    <button class="btn-primary" @click="showExamDetailDialog = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª -->
        <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40 bottom-nav" style="padding-bottom: env(safe-area-inset-bottom);">
            <div class="flex justify-around py-2">
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                    <span class="text-xl mb-1">ğŸ </span>
                    <span class="text-xs">é¦–é¡µ</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                    <span class="text-xl mb-1">ğŸ“</span>
                    <span class="text-xs">è€ƒè¯•</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                    <span class="text-xl mb-1">âŒ</span>
                    <span class="text-xs">é”™é¢˜</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'records'}" @click="switchMode('records')">
                    <span class="text-xl mb-1">ğŸ“Š</span>
                    <span class="text-xs">è®°å½•</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                    <span class="text-xl mb-1">âš™ï¸</span>
                    <span class="text-xs">ç®¡ç†</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨é…ç½®
        const AppConfig = {
            questionTypes: {
                single: { label: 'å•é€‰é¢˜', icon: 'ğŸ“‹', color: 'blue' },
                multiple: { label: 'å¤šé€‰é¢˜', icon: 'âœ…', color: 'purple' },
                judge: { label: 'åˆ¤æ–­é¢˜', icon: 'âš–ï¸', color: 'green' },
                fill: { label: 'å¡«ç©ºé¢˜', icon: 'ğŸ“', color: 'yellow' },
                essay: { label: 'ç®€ç­”é¢˜', icon: 'ğŸ“„', color: 'red' }
            },
            
            gradeLevels: {
                excellent: { min: 90, label: 'ä¼˜ç§€', color: 'green' },
                good: { min: 80, label: 'è‰¯å¥½', color: 'blue' },
                average: { min: 60, label: 'åŠæ ¼', color: 'orange' },
                poor: { min: 0, label: 'ä¸åŠæ ¼', color: 'red' }
            },
            
            timeRecommendations: {
                single: 2,    // åˆ†é’Ÿ
                multiple: 3,
                judge: 1,
                fill: 3,
                essay: 5
            },
            
            storageKeys: {
                userData: 'examAppData',
                currentUser: 'currentUser'
            },
            
            debounceTime: 500,
            maxBatchSize: 500,
            maxFileSize: 10 * 1024 * 1024 // 10MB
        };

        // å·¥å…·å‡½æ•°
        const Utils = {
            // é˜²æŠ–å‡½æ•°
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            // èŠ‚æµå‡½æ•°
            throttle(func, limit) {
                let inThrottle;
                return function(...args) {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },
            
            // æ·±æ‹·è´
            deepClone(obj) {
                if (obj === null || typeof obj !== 'object') return obj;
                if (obj instanceof Date) return new Date(obj.getTime());
                if (obj instanceof Array) return obj.map(item => Utils.deepClone(item));
                
                const clonedObj = {};
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        clonedObj[key] = Utils.deepClone(obj[key]);
                    }
                }
                return clonedObj;
            },
            
            // æ•°ç»„æ´—ç‰Œ
            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            },
            
            // æ•°ç»„æ¯”è¾ƒ
            arraysEqual(a, b) {
                return a.length === b.length && a.every((val, i) => val === b[i]);
            },
            
            // å®‰å…¨çš„JSONè§£æ
            safeJsonParse(jsonString) {
                try {
                    const data = JSON.parse(jsonString);
                    if (typeof data !== 'object' || data === null) {
                        throw new Error('æ— æ•ˆçš„JSONæ•°æ®');
                    }
                    return data;
                } catch (error) {
                    console.error('JSONè§£æé”™è¯¯:', error);
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                }
            },
            
            // ç”Ÿæˆå”¯ä¸€ID
            generateId(prefix = 'id') {
                return `${prefix}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            },
            
            // æ ¼å¼åŒ–æ—¶é—´
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            },
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            formatDate(dateString, showTime = false) {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return 'æ— æ•ˆæ—¥æœŸ';
                }
                
                if (showTime) {
                    return date.toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
                return date.toLocaleDateString('zh-CN');
            },
            
            // æ ¼å¼åŒ–æ—¶é•¿
            formatDuration(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${minutes}åˆ†${secs}ç§’`;
            },
            
            // å»¶è¿Ÿæ‰§è¡Œ
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        };

        // ç­”æ¡ˆæ£€æŸ¥å™¨
        const AnswerCheckers = {
            single: (userAnswer, correctAnswer) => userAnswer === correctAnswer,
            
            multiple: (userAnswer, correctAnswer) => {
                if (!Array.isArray(userAnswer) || !Array.isArray(correctAnswer)) return false;
                return Utils.arraysEqual(userAnswer.sort(), correctAnswer.sort());
            },
            
            judge: (userAnswer, correctAnswer) => userAnswer === correctAnswer,
            
            fill: (userAnswer, correctAnswer) => {
                const correctAnswers = correctAnswer.toString().split(',')
                    .map(a => a.trim().toLowerCase());
                return correctAnswers.includes(userAnswer.toString().trim().toLowerCase());
            },
            
            essay: (userAnswer, correctAnswer) => {
                const userContent = userAnswer.toString().trim().toLowerCase();
                const correctContent = correctAnswer.toString().trim().toLowerCase();
                
                if (!userContent || !correctContent) return false;
                
                const keywords = correctContent.split(/[,ï¼Œ.ã€‚;ï¼›\s]+/)
                    .filter(word => word.length > 1);
                
                const matchedKeywords = keywords.filter(keyword => 
                    userContent.includes(keyword)
                );
                
                return matchedKeywords.length >= Math.ceil(keywords.length * 0.5);
            }
        };

        // æ•°æ®å­˜å‚¨ç®¡ç†å™¨
        const StorageManager = {
            // ä¿å­˜æ•°æ®ï¼ˆå¸¦é˜²æŠ–ï¼‰
            saveData: Utils.debounce((key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (error) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                    throw new Error('å­˜å‚¨ç©ºé—´ä¸è¶³');
                }
            }, AppConfig.debounceTime),
            
            // è¯»å–æ•°æ®
            loadData(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error('è¯»å–æ•°æ®å¤±è´¥:', error);
                    return defaultValue;
                }
            },
            
            // æ‰¹é‡å­˜å‚¨å¤§å‹æ•°æ®
            saveLargeData(key, data) {
                try {
                    const dataString = JSON.stringify(data);
                    const chunkSize = 1024 * 1024; // 1MB chunks
                    
                    if (dataString.length <= chunkSize) {
                        localStorage.setItem(key, dataString);
                        return;
                    }
                    
                    // åˆ†å—å­˜å‚¨
                    const chunks = [];
                    for (let i = 0; i < dataString.length; i += chunkSize) {
                        chunks.push(dataString.substring(i, i + chunkSize));
                    }
                    
                    localStorage.setItem(`${key}_chunks`, chunks.length);
                    chunks.forEach((chunk, index) => {
                        localStorage.setItem(`${key}_chunk_${index}`, chunk);
                    });
                } catch (error) {
                    console.error('æ‰¹é‡å­˜å‚¨å¤±è´¥:', error);
                    throw new Error('æ•°æ®è¿‡å¤§ï¼Œæ— æ³•å­˜å‚¨');
                }
            },
            
            // æ‰¹é‡è¯»å–å¤§å‹æ•°æ®
            loadLargeData(key, defaultValue = null) {
                try {
                    const chunks = localStorage.getItem(`${key}_chunks`);
                    
                    if (!chunks) {
                        // å°è¯•ç›´æ¥è¯»å–
                        const data = localStorage.getItem(key);
                        return data ? JSON.parse(data) : defaultValue;
                    }
                    
                    // åˆ†å—è¯»å–
                    const chunkCount = parseInt(chunks);
                    let dataString = '';
                    
                    for (let i = 0; i < chunkCount; i++) {
                        const chunk = localStorage.getItem(`${key}_chunk_${i}`);
                        if (!chunk) throw new Error('æ•°æ®æŸå');
                        dataString += chunk;
                    }
                    
                    return JSON.parse(dataString);
                } catch (error) {
                    console.error('æ‰¹é‡è¯»å–å¤±è´¥:', error);
                    return defaultValue;
                }
            },
            
            // åˆ é™¤æ•°æ®
            removeData(key) {
                try {
                    const chunks = localStorage.getItem(`${key}_chunks`);
                    if (chunks) {
                        const chunkCount = parseInt(chunks);
                        for (let i = 0; i < chunkCount; i++) {
                            localStorage.removeItem(`${key}_chunk_${i}`);
                        }
                        localStorage.removeItem(`${key}_chunks`);
                    }
                    localStorage.removeItem(key);
                } catch (error) {
                    console.error('åˆ é™¤æ•°æ®å¤±è´¥:', error);
                }
            },
            
            // æ£€æŸ¥å­˜å‚¨ç©ºé—´
            checkStorage() {
                try {
                    const test = 'test';
                    localStorage.setItem('test', test);
                    localStorage.removeItem('test');
                    return true;
                } catch (error) {
                    console.error('å­˜å‚¨ç©ºé—´æ£€æŸ¥å¤±è´¥:', error);
                    return false;
                }
            }
        };

        // é€šçŸ¥ç³»ç»Ÿ
        const NotificationSystem = {
            show(message, type = 'success', duration = 3000) {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, duration);
            },
            
            success(message, duration) {
                this.show(message, 'success', duration);
            },
            
            error(message, duration) {
                this.show(message, 'error', duration);
            },
            
            warning(message, duration) {
                this.show(message, 'warning', duration);
            },
            
            info(message, duration) {
                this.show(message, 'info', duration);
            }
        };

        // ä¸»åº”ç”¨
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    currentMode: 'home',
                    currentUrl: window.location.href,
                    
                    // ç”¨æˆ·ç³»ç»Ÿ
                    currentUser: null,
                    showLoginDialog: false,
                    saveTimer: null,
                    _examStatsCache: null,
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    
                    // é¢˜åº“æ•°æ®
                    questionBank: [],
                    
                    // é”™é¢˜æœ¬
                    mistakeBank: [],
                    mistakeFilter: {
                        type: '',
                        timeRange: '',
                        importantOnly: false
                    },
                    
                    // é¢˜ç›®ç®¡ç†
                    manageFilter: {
                        type: '',
                        search: ''
                    },
                    
                    // æ–‡ä»¶ä¸Šä¼ 
                    uploadProgress: 0,
                    pendingQuestions: [],
                    showQuestionTypeDialog: false,
                    showFormatSample: false,
                    isDragging: false,
                    
                    // åˆ†äº«
                    showQRCode: false,
                    showExamDetail: false,
                    currentExamDetail: null,
                    scoreChart: null,
                    
                    // å­¦ä¹ ç»Ÿè®¡
                    studyStats: {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    },
                    
                    // æ‰¹é‡æ“ä½œ
                    selectAllPending: false,
                    batchType: '',
                    
                    // ç¼–è¾‘åŠŸèƒ½
                    editingQuestion: null,
                    showEditDialog: false,
                    
                    // è€ƒè¯•åŠŸèƒ½ç›¸å…³æ•°æ®
                    examConfig: {
                        single: 5,
                        multiple: 3,
                        judge: 5,
                        fill: 2,
                        essay: 1,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true,
                        showAnalysis: true
                    },
                    
                    // è€ƒè¯•çŠ¶æ€
                    isExamStarted: false,
                    isExamFinished: false,
                    currentQuestions: [],
                    currentQuestionIndex: 0,
                    userAnswers: {},
                    markedQuestions: new Set(),
                    submittedAnswers: new Set(),
                    currentAnswerSubmitted: false,
                    currentAnswerShown: false,
                    examStartTime: null,
                    remainingTime: 0,
                    examTimer: null,
                    pauseExamDialog: false,
                    
                    // è€ƒè¯•ç»“æœ
                    examResult: {
                        score: 0,
                        grade: '',
                        gradeClass: '',
                        totalQuestions: 0,
                        correctCount: 0,
                        wrongCount: 0,
                        duration: 0
                    },
                    
                    // æ˜¾ç¤ºè€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡†
                    showExamDetailDialog: false,
                    
                    // å…¨å±€åŠ è½½çŠ¶æ€
                    isLoading: false,
                    loadingMessage: 'åŠ è½½ä¸­...'
                };
            },
            
            computed: {
                totalQuestions() {
                    return this.questionBank.length;
                },
                
                correctRate() {
                    if (this.studyStats.totalQuestions === 0) return 0;
                    return Math.round((this.studyStats.correctAnswers / this.studyStats.totalQuestions) * 100);
                },
                
                studyHours() {
                    return Math.round(this.studyStats.totalStudyTime / 3600 * 10) / 10;
                },
                
                mistakeCount() {
                    return this.mistakeBank.length;
                },
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½è¢«é€‰ä¸­
                isAllSelected() {
                    return this.filteredManageQuestions.length > 0 && 
                           this.filteredManageQuestions.every(q => q.selected);
                },
                
                questionTypeCount() {
                    const count = {
                        single: 0,
                        multiple: 0,
                        judge: 0,
                        fill: 0,
                        essay: 0
                    };
                    this.questionBank.forEach(q => {
                        if (count.hasOwnProperty(q.type)) {
                            count[q.type]++;
                        }
                    });
                    return count;
                },
                
                filteredMistakes() {
                    let filtered = this.mistakeBank;
                    
                    if (this.mistakeFilter.type) {
                        filtered = filtered.filter(m => m.type === this.mistakeFilter.type);
                    }
                    
                    if (this.mistakeFilter.timeRange) {
                        const now = new Date();
                        const filterDate = new Date();
                        switch (this.mistakeFilter.timeRange) {
                            case 'today':
                                filterDate.setDate(now.getDate() - 1);
                                break;
                            case 'week':
                                filterDate.setDate(now.getDate() - 7);
                                break;
                            case 'month':
                                filterDate.setMonth(now.getMonth() - 1);
                                break;
                        }
                        filtered = filtered.filter(m => new Date(m.mistakeTime) >= filterDate);
                    }
                    
                    if (this.mistakeFilter.importantOnly) {
                        filtered = filtered.filter(m => m.isImportant);
                    }
                    
                    return filtered;
                },
                
                totalStudySessions() {
                    return this.studyStats.examRecords.length;
                },
                
                filteredManageQuestions() {
                    let filtered = this.questionBank;
                    
                    if (this.manageFilter.type) {
                        filtered = filtered.filter(q => q.type === this.manageFilter.type);
                    }
                    
                    if (this.manageFilter.search) {
                        filtered = filtered.filter(q => 
                            q.content.toLowerCase().includes(this.manageFilter.search.toLowerCase())
                        );
                    }
                    
                    return filtered;
                },
                
                // è€ƒè¯•ç›¸å…³è®¡ç®—å±æ€§
                totalExamQuestions() {
                    return this.examConfig.single + this.examConfig.multiple + 
                           this.examConfig.judge + this.examConfig.fill + this.examConfig.essay;
                },
                
                suggestedTime() {
                    return this.examConfig.single * AppConfig.timeRecommendations.single + 
                           this.examConfig.multiple * AppConfig.timeRecommendations.multiple + 
                           this.examConfig.judge * AppConfig.timeRecommendations.judge + 
                           this.examConfig.fill * AppConfig.timeRecommendations.fill + 
                           this.examConfig.essay * AppConfig.timeRecommendations.essay;
                },
                
                currentQuestion() {
                    return this.currentQuestions[this.currentQuestionIndex] || {};
                },
                
                currentAnswerClass() {
                    if (!this.currentAnswerSubmitted) return '';
                    return this.isAnswerCorrect(this.currentQuestionIndex) ? 'answer-correct' : 'answer-wrong';
                },
                
                hasAnswerForCurrentQuestion() {
                    const answer = this.userAnswers[this.currentQuestionIndex];
                    if (answer === undefined || answer === null) return false;
                    
                    if (this.currentQuestion.type === 'multiple') {
                        return Array.isArray(answer) && answer.length > 0;
                    } else if (this.currentQuestion.type === 'fill' || this.currentQuestion.type === 'essay') {
                        return answer.toString().trim().length > 0;
                    }
                    return true;
                }
            },
            
            methods: {
                // ç”¨æˆ·ç³»ç»Ÿ
                login() {
                    if (!this.loginForm.username.trim()) {
                        NotificationSystem.error('è¯·è¾“å…¥ç”¨æˆ·åï¼');
                        return;
                    }
                    
                    try {
                        // æ¨¡æ‹Ÿç™»å½•/æ³¨å†Œ
                        const userId = 'user_' + this.loginForm.username;
                        this.currentUser = {
                            id: userId,
                            username: this.loginForm.username
                        };
                        
                        // ä¿å­˜å½“å‰ç”¨æˆ·
                        StorageManager.saveData(AppConfig.storageKeys.currentUser, this.currentUser);
                        
                        // åŠ è½½ç”¨æˆ·æ•°æ®
                        this.loadUserData();
                        this.showLoginDialog = false;
                        this.loginForm = { username: '', password: '' };
                        
                        NotificationSystem.success('ç™»å½•æˆåŠŸï¼');
                    } catch (error) {
                        console.error('ç™»å½•å¤±è´¥:', error);
                        NotificationSystem.error('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                },
                
                logout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        this.saveUserData();
                        this.currentUser = null;
                        StorageManager.removeData(AppConfig.storageKeys.currentUser);
                        this.clearAllData();
                        NotificationSystem.success('å·²é€€å‡ºç™»å½•ï¼');
                    }
                },
                
                loadUserData() {
                    if (!this.currentUser) return;
                    
                    this.setLoading(true, 'åŠ è½½ç”¨æˆ·æ•°æ®ä¸­...');
                    
                    try {
                        const userData = StorageManager.loadData(`examAppData_${this.currentUser.id}`);
                        if (userData) {
                            if (userData.questionBank) this.questionBank = userData.questionBank;
                            if (userData.mistakeBank) this.mistakeBank = userData.mistakeBank;
                            if (userData.studyStats) this.studyStats = userData.studyStats;
                        } else {
                            // æ–°ç”¨æˆ·åŠ è½½ç¤ºä¾‹é¢˜åº“
                            this.loadSampleQuestions();
                        }
                    } catch (error) {
                        console.error('ç”¨æˆ·æ•°æ®åŠ è½½å¤±è´¥:', error);
                        NotificationSystem.error('æ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                        this.loadSampleQuestions();
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                saveUserData() {
                    if (!this.currentUser) return;
                    
                    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                    if (this.saveTimer) {
                        clearTimeout(this.saveTimer);
                    }
                    
                    // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿä¿å­˜
                    this.saveTimer = setTimeout(() => {
                        try {
                            const data = {
                                questionBank: this.questionBank,
                                mistakeBank: this.mistakeBank,
                                studyStats: this.studyStats
                            };
                            
                            // ä½¿ç”¨æ‰¹é‡å­˜å‚¨å¤„ç†å¤§å‹æ•°æ®
                            StorageManager.saveLargeData(`examAppData_${this.currentUser.id}`, data);
                        } catch (error) {
                            console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                            NotificationSystem.error('æ•°æ®ä¿å­˜å¤±è´¥');
                        }
                    }, AppConfig.debounceTime);
                },
                
                clearAllData() {
                    this.questionBank = [];
                    this.mistakeBank = [];
                    this.studyStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    };
                },
                
                // æ¨¡å¼åˆ‡æ¢
                switchMode(mode) {
                    // å¦‚æœæ­£åœ¨è€ƒè¯•ä¸­ï¼Œæç¤ºç”¨æˆ·
                    if (this.isExamStarted && !this.isExamFinished && mode !== 'exam') {
                        if (!confirm('è€ƒè¯•æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ')) {
                            return;
                        }
                        this.abandonExam();
                    }
                    
                    this.currentMode = mode;
                    this.saveUserData();
                    
                    // å½“åˆ‡æ¢åˆ°è€ƒè¯•è®°å½•é¡µé¢æ—¶ï¼Œæ¸²æŸ“æˆç»©è¶‹åŠ¿å›¾
                    if (mode === 'records') {
                        this.$nextTick(() => {
                            this.renderScoreChart();
                        });
                    }
                },
                
                // åŠ è½½ç¤ºä¾‹é¢˜åº“
                loadSampleQuestions() {
                    this.setLoading(true, 'åŠ è½½ç¤ºä¾‹é¢˜åº“ä¸­...');
                    
                    try {
                        const sampleQuestions = [
                            {
                                id: Utils.generateId('q'),
                                type: 'single',
                                content: 'ä»¥ä¸‹å“ªä¸ªæ˜¯ Vue 3 çš„ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Ÿ',
                                options: [
                                    'createApp',
                                    'ref',
                                    'component',
                                    'mount'
                                ],
                                answer: 1,
                                analysis: 'ref æ˜¯ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Œç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®ã€‚',
                                difficulty: 2,
                                tags: ['vue', 'composition-api']
                            },
                            {
                                id: Utils.generateId('q'),
                                type: 'multiple',
                                content: 'ä»¥ä¸‹å“ªäº›æ˜¯ JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ',
                                options: [
                                    'String',
                                    'Number',
                                    'Array',
                                    'Object',
                                    'Boolean'
                                ],
                                answer: [0, 1, 4],
                                analysis: 'JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬ï¼šStringã€Numberã€Booleanã€Nullã€Undefinedã€Symbolã€BigIntã€‚Array å’Œ Object æ˜¯å¼•ç”¨ç±»å‹ã€‚',
                                difficulty: 1,
                                tags: ['javascript', 'basics']
                            },
                            {
                                id: Utils.generateId('q'),
                                type: 'judge',
                                content: 'CSS ä¸­çš„ flexbox å¸ƒå±€åªèƒ½ç”¨äºæ°´å¹³å¸ƒå±€ã€‚',
                                options: ['æ­£ç¡®', 'é”™è¯¯'],
                                answer: 1,
                                analysis: 'Flexbox æ—¢æ”¯æŒæ°´å¹³å¸ƒå±€ï¼ˆflex-direction: rowï¼‰ï¼Œä¹Ÿæ”¯æŒå‚ç›´å¸ƒå±€ï¼ˆflex-direction: columnï¼‰ã€‚',
                                difficulty: 2,
                                tags: ['css', 'flexbox']
                            },
                            {
                                id: Utils.generateId('q'),
                                type: 'fill',
                                content: 'JavaScript ä¸­ä½¿ç”¨ ______ å…³é”®å­—æ¥å£°æ˜å¸¸é‡ã€‚',
                                options: [],
                                answer: 'const',
                                analysis: 'const å…³é”®å­—ç”¨äºå£°æ˜å¸¸é‡ï¼Œå£°æ˜åä¸èƒ½å†é‡æ–°èµ‹å€¼ã€‚',
                                difficulty: 1,
                                tags: ['javascript', 'basics']
                            },
                            {
                                id: Utils.generateId('q'),
                                type: 'essay',
                                content: 'è¯·ç®€è¿° Vue 3 ç›¸å¯¹äº Vue 2 çš„ä¸»è¦æ”¹è¿›ç‚¹ã€‚',
                                options: [],
                                answer: 'Vue 3 çš„ä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š1. æ€§èƒ½æå‡ï¼ˆæ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦ã€æ›´å°çš„åŒ…ä½“ç§¯ï¼‰ï¼›2. Composition API æä¾›æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼›3. æ›´å¥½çš„ TypeScript æ”¯æŒï¼›4. æ–°å¢ Fragmentã€Teleportã€Suspense ç­‰å†…ç½®ç»„ä»¶ï¼›5. å“åº”å¼ç³»ç»Ÿä½¿ç”¨ Proxy æ›¿ä»£ Object.definePropertyã€‚',
                                analysis: 'Vue 3 åœ¨æ€§èƒ½ã€å¼€å‘ä½“éªŒã€TypeScript æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚',
                                difficulty: 3,
                                tags: ['vue', 'composition-api']
                            }
                        ];
                        
                        this.questionBank = sampleQuestions;
                        this.saveUserData();
                        NotificationSystem.success('ç¤ºä¾‹é¢˜åº“åŠ è½½æˆåŠŸï¼');
                    } catch (error) {
                        console.error('åŠ è½½ç¤ºä¾‹é¢˜åº“å¤±è´¥:', error);
                        NotificationSystem.error('åŠ è½½ç¤ºä¾‹é¢˜åº“å¤±è´¥');
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                // æ–‡ä»¶å¤„ç†ç›¸å…³æ–¹æ³•
                triggerFileInput() {
                    this.$refs.fileInput.click();
                },
                
                handleFileSelect(event) {
                    const files = event.target.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                
                handleFileDrop(event) {
                    event.preventDefault();
                    this.isDragging = false;
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                
                handleDragOver(event) {
                    event.preventDefault();
                    this.isDragging = true;
                },
                
                handleDragLeave(event) {
                    event.preventDefault();
                    this.isDragging = false;
                },
                
                async processFiles(files) {
                    this.uploadProgress = 0;
                    const totalFiles = files.length;
                    let processedFiles = 0;
                    
                    for (let file of files) {
                        try {
                            // æ£€æŸ¥æ–‡ä»¶å¤§å°
                            if (file.size > AppConfig.maxFileSize) {
                                throw new Error(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆæœ€å¤§${AppConfig.maxFileSize / 1024 / 1024}MBï¼‰`);
                            }
                            
                            await this.processFile(file);
                            processedFiles++;
                            this.uploadProgress = Math.round((processedFiles / totalFiles) * 100);
                        } catch (error) {
                            console.error('æ–‡ä»¶å¤„ç†é”™è¯¯:', error);
                            NotificationSystem.error(`æ–‡ä»¶ ${file.name} å¤„ç†å¤±è´¥: ${error.message}`);
                        }
                    }
                    
                    this.uploadProgress = 0;
                    this.saveUserData();
                },
                
                async processFile(file) {
                    let questions = [];
                    const fileName = file.name.toLowerCase();
                    
                    try {
                        if (fileName.endsWith('.json')) {
                            questions = await this.parseJSON(file);
                        } else if (fileName.endsWith('.txt')) {
                            questions = await this.parseTXT(file);
                        } else if (fileName.endsWith('.xlsx')) {
                            questions = await this.parseExcel(file);
                        } else if (fileName.endsWith('.docx')) {
                            questions = await this.parseDocx(file);
                        } else {
                            throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
                        }
                        
                        if (questions.length > 0) {
                            // ä¸ºæ¯ä¸ªé¢˜ç›®æ·»åŠ IDå’Œé»˜è®¤ç±»å‹
                            questions = questions.map((q, index) => ({
                                ...q,
                                id: q.id || Utils.generateId('import'),
                                selectedType: q.type || 'single',
                                selected: true
                            }));
                            
                            this.pendingQuestions = questions;
                            this.showQuestionTypeDialog = true;
                        } else {
                            NotificationSystem.warning('æœªæ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®');
                        }
                    } catch (error) {
                        console.error('æ–‡ä»¶è§£æé”™è¯¯:', error);
                        throw new Error(`æ–‡ä»¶è§£æå¤±è´¥: ${error.message}`);
                    }
                },
                
                async parseTXT(file) {
                    const text = await file.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    const questions = [];
                    let currentQuestion = null;
                    let questionType = 'single';
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        // æ£€æµ‹é¢˜å‹æ ‡é¢˜
                        if (line.includes('å•é€‰é¢˜')) {
                            questionType = 'single';
                            continue;
                        } else if (line.includes('å¤šé€‰é¢˜')) {
                            questionType = 'multiple';
                            continue;
                        } else if (line.includes('åˆ¤æ–­é¢˜')) {
                            questionType = 'judge';
                            continue;
                        } else if (line.includes('å¡«ç©ºé¢˜')) {
                            questionType = 'fill';
                            continue;
                        } else if (line.includes('ç®€ç­”é¢˜')) {
                            questionType = 'essay';
                            continue;
                        }
                        
                        // æ£€æµ‹é¢˜ç›®ç¼–å·
                        const questionMatch = line.match(/^\d+\.\s*(.+)/);
                        if (questionMatch) {
                            if (currentQuestion) {
                                questions.push(currentQuestion);
                            }
                            currentQuestion = {
                                id: Utils.generateId('txt'),
                                type: questionType,
                                content: questionMatch[1].trim(),
                                options: [],
                                answer: null,
                                analysis: ''
                            };
                            continue;
                        }
                        
                        // æ£€æµ‹é€‰é¡¹
                        const optionMatch = line.match(/^([A-Z])\.\s*(.+)/);
                        if (optionMatch && currentQuestion) {
                            currentQuestion.options.push(optionMatch[2].trim());
                            continue;
                        }
                        
                        // æ£€æµ‹ç­”æ¡ˆ
                        const answerMatch = line.match(/ç­”æ¡ˆï¼š(.+)/);
                        if (answerMatch && currentQuestion) {
                            const answerText = answerMatch[1].trim();
                            if (questionType === 'multiple') {
                                currentQuestion.answer = answerText.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else if (questionType === 'single' || questionType === 'judge') {
                                currentQuestion.answer = answerText.charCodeAt(0) - 65;
                            } else {
                                currentQuestion.answer = answerText;
                            }
                            continue;
                        }
                        
                        // æ£€æµ‹è§£æ
                        const analysisMatch = line.match(/è§£æï¼š(.+)/);
                        if (analysisMatch && currentQuestion) {
                            currentQuestion.analysis = analysisMatch[1].trim();
                            continue;
                        }
                        
                        // å¦‚æœæ˜¯åˆ¤æ–­é¢˜ï¼Œæ·»åŠ æ ‡å‡†é€‰é¡¹
                        if (questionType === 'judge' && currentQuestion && currentQuestion.options.length === 0) {
                            currentQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                        }
                    }
                    
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    
                    return questions;
                },
                
                async parseJSON(file) {
                    const text = await file.text();
                    const data = Utils.safeJsonParse(text);
                    
                    if (!Array.isArray(data)) {
                        throw new Error('JSONæ•°æ®å¿…é¡»æ˜¯æ•°ç»„æ ¼å¼');
                    }
                    
                    // éªŒè¯é¢˜ç›®æ ¼å¼
                    return data.map((q, index) => {
                        if (!q.content || !q.type) {
                            throw new Error(`ç¬¬${index + 1}é¢˜ç¼ºå°‘å¿…è¦å­—æ®µ`);
                        }
                        
                        return {
                            id: q.id || Utils.generateId('json'),
                            type: q.type,
                            content: q.content,
                            options: q.options || [],
                            answer: q.answer,
                            analysis: q.analysis || '',
                            difficulty: q.difficulty || 2,
                            tags: q.tags || []
                        };
                    });
                },
                
                async parseExcel(file) {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    
                    return json.map((row, index) => {
                        const question = {
                            id: Utils.generateId('excel'),
                            type: row['é¢˜å‹'] || 'single',
                            content: row['é¢˜å¹²'] || row['é¢˜ç›®'] || '',
                            options: [],
                            answer: null,
                            analysis: row['è§£æ'] || ''
                        };
                        
                        // å¤„ç†é€‰é¡¹
                        for (let i = 0; i < 10; i++) {
                            const option = row[`é€‰é¡¹${String.fromCharCode(65 + i)}`] || row[`é€‰é¡¹${i + 1}`];
                            if (option) {
                                question.options.push(option);
                            }
                        }
                        
                        // å¤„ç†ç­”æ¡ˆ
                        const answer = row['ç­”æ¡ˆ'];
                        if (typeof answer === 'string') {
                            if (question.type === 'multiple') {
                                question.answer = answer.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else {
                                question.answer = answer.trim().charCodeAt(0) - 65;
                            }
                        } else {
                            question.answer = answer;
                        }
                        
                        return question;
                    }).filter(q => q.content);
                },
                
                async parseDocx(file) {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    const text = result.value;
                    
                    // å°†docxæ–‡æœ¬è½¬æ¢ä¸ºç±»ä¼¼TXTçš„æ ¼å¼ï¼Œç„¶åå¤ç”¨TXTè§£æé€»è¾‘
                    const lines = text.split('\n').filter(line => line.trim());
                    const formattedText = lines.join('\n');
                    const blob = new Blob([formattedText], { type: 'text/plain' });
                    
                    return await this.parseTXT(blob);
                },
                
                // æ‰¹é‡æ“ä½œç›¸å…³æ–¹æ³•
                toggleSelectAll() {
                    this.pendingQuestions.forEach(q => {
                        q.selected = this.selectAllPending;
                    });
                },
                
                applyBatchType() {
                    if (this.batchType) {
                        this.pendingQuestions.forEach(q => {
                            if (q.selected) {
                                q.selectedType = this.batchType;
                            }
                        });
                        this.batchType = '';
                    }
                },
                
                confirmImport() {
                    const selectedQuestions = this.pendingQuestions.filter(q => q.selected);
                    
                    selectedQuestions.forEach(q => {
                        const question = {
                            ...q,
                            type: q.selectedType,
                            difficulty: q.difficulty || 2,
                            tags: q.tags || []
                        };
                        delete question.selectedType;
                        delete question.selected;
                        this.questionBank.push(question);
                    });
                    
                    this.showQuestionTypeDialog = false;
                    this.pendingQuestions = [];
                    this.saveUserData();
                    
                    NotificationSystem.success(`æˆåŠŸå¯¼å…¥ ${selectedQuestions.length} é“é¢˜ç›®ï¼`);
                },
                
                // è·å–é¢˜å‹æ–‡æœ¬
                getQuestionTypeText(type) {
                    return AppConfig.questionTypes[type]?.label || 'æœªçŸ¥é¢˜å‹';
                },
                
                // åˆ†äº«åŠŸèƒ½
                shareLink() {
                    this.showQRCode = true;
                    this.$nextTick(() => {
                        this.generateQRCode();
                    });
                },
                
                copyLink() {
                    navigator.clipboard.writeText(this.currentUrl).then(() => {
                        NotificationSystem.success('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    }).catch(() => {
                        NotificationSystem.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    });
                },
                
                generateQRCode() {
                    this.$nextTick(() => {
                        const qrcodeElement = document.getElementById('qrcode');
                        if (qrcodeElement) {
                            // æ¸…é™¤ä¹‹å‰çš„äºŒç»´ç 
                            qrcodeElement.innerHTML = '';
                            // ç”Ÿæˆæ–°çš„äºŒç»´ç 
                            new QRCode(qrcodeElement, {
                                text: this.currentUrl,
                                width: 128,
                                height: 128,
                                colorDark: '#07c160',
                                colorLight: '#ffffff',
                                correctLevel: QRCode.CorrectLevel.H
                            });
                        }
                    });
                },
                
                // æ•°æ®å…±äº«åŠŸèƒ½
                exportData() {
                    if (!this.currentUser) {
                        NotificationSystem.warning('è¯·å…ˆç™»å½•åå†å¯¼å‡ºæ•°æ®ï¼');
                        return;
                    }
                    
                    try {
                        const data = {
                            questionBank: this.questionBank,
                            mistakeBank: this.mistakeBank,
                            studyStats: this.studyStats,
                            exportTime: new Date().toISOString(),
                            version: '1.0',
                            userId: this.currentUser.id,
                            username: this.currentUser.username
                        };
                        
                        const dataStr = JSON.stringify(data, null, 2);
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `åˆ·é¢˜æ•°æ®_${this.currentUser.username}_${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        NotificationSystem.success('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
                    } catch (error) {
                        console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                        NotificationSystem.error('æ•°æ®å¯¼å‡ºå¤±è´¥');
                    }
                },
                
                importData() {
                    if (!this.currentUser) {
                        NotificationSystem.warning('è¯·å…ˆç™»å½•åå†å¯¼å…¥æ•°æ®ï¼');
                        return;
                    }
                    
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const data = Utils.safeJsonParse(e.target.result);
                                    let importCount = 0;
                                    
                                    if (data.questionBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.questionBank.length} é“é¢˜ç›®ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é¢˜ç›®
                                        const existingIds = new Set(this.questionBank.map(q => q.id));
                                        const newQuestions = data.questionBank.filter(q => !existingIds.has(q.id));
                                        this.questionBank.push(...newQuestions);
                                        importCount += newQuestions.length;
                                    }
                                    
                                    if (data.mistakeBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.mistakeBank.length} é“é”™é¢˜ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é”™é¢˜
                                        const existingMistakeIds = new Set(this.mistakeBank.map(m => m.id));
                                        const newMistakes = data.mistakeBank.filter(m => !existingMistakeIds.has(m.id));
                                        this.mistakeBank.push(...newMistakes);
                                        importCount += newMistakes.length;
                                    }
                                    
                                    if (data.studyStats && confirm('æ˜¯å¦å¯¼å…¥å­¦ä¹ ç»Ÿè®¡æ•°æ®ï¼Ÿ')) {
                                        // åˆå¹¶å­¦ä¹ ç»Ÿè®¡
                                        this.studyStats.totalQuestions += data.studyStats.totalQuestions || 0;
                                        this.studyStats.correctAnswers += data.studyStats.correctAnswers || 0;
                                        this.studyStats.totalStudyTime += data.studyStats.totalStudyTime || 0;
                                        if (data.studyStats.examRecords) {
                                            this.studyStats.examRecords.push(...data.studyStats.examRecords);
                                        }
                                    }
                                    
                                    this.saveUserData();
                                    NotificationSystem.success(`æ•°æ®å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${importCount} æ¡æ•°æ®ã€‚`);
                                } catch (error) {
                                    console.error('å¯¼å…¥æ•°æ®å¤±è´¥:', error);
                                    NotificationSystem.error('æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                },
                
                // é”™é¢˜ç»ƒä¹ 
                startMistakePractice() {
                    if (this.mistakeBank.length === 0) {
                        NotificationSystem.warning('é”™é¢˜æœ¬ä¸ºç©ºï¼');
                        return;
                    }
                    
                    this.examMode = 'practice';
                    this.currentQuestions = Utils.shuffleArray([...this.mistakeBank]);
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                
                // æ¸…ç©ºé”™é¢˜
                clearMistakes() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™é¢˜å—ï¼Ÿ')) {
                        this.mistakeBank = [];
                        this.saveUserData();
                        NotificationSystem.success('é”™é¢˜æœ¬å·²æ¸…ç©ºï¼');
                    }
                },
                
                // åˆ é™¤é”™é¢˜
                removeMistake(mistake) {
                    const index = this.mistakeBank.findIndex(m => m.id === mistake.id);
                    if (index > -1) {
                        this.mistakeBank.splice(index, 1);
                        this.saveUserData();
                        NotificationSystem.success('é”™é¢˜å·²åˆ é™¤ï¼');
                    }
                },
                
                // åˆ‡æ¢é‡ç‚¹æ ‡è®°
                toggleImportant(mistake) {
                    mistake.isImportant = !mistake.isImportant;
                    this.saveUserData();
                },
                
                // é‡æ–°ç»ƒä¹ é”™é¢˜
                reviewMistake(mistake) {
                    this.examMode = 'practice';
                    this.currentQuestions = [mistake];
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                
                // æ¸…ç©ºé¢˜åº“
                clearQuestionBank() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ•´ä¸ªé¢˜åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                        this.questionBank = [];
                        this.saveUserData();
                        NotificationSystem.success('é¢˜åº“å·²æ¸…ç©ºï¼');
                    }
                },
                
                // åˆ é™¤é¢˜ç›®
                deleteQuestion(question) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                        const index = this.questionBank.findIndex(q => q.id === question.id);
                        if (index > -1) {
                            this.questionBank.splice(index, 1);
                            this.saveUserData();
                            NotificationSystem.success('é¢˜ç›®å·²åˆ é™¤ï¼');
                        }
                    }
                },
                
                // ç¼–è¾‘é¢˜ç›®
                editQuestion(question) {
                    this.editingQuestion = Utils.deepClone(question);
                    
                    // ç¡®ä¿ç­”æ¡ˆæ ¼å¼æ­£ç¡®
                    if (this.editingQuestion.type === 'multiple' && !Array.isArray(this.editingQuestion.answer)) {
                        this.editingQuestion.answer = [];
                    }
                    
                    if (this.editingQuestion.type === 'judge' && (!this.editingQuestion.options || this.editingQuestion.options.length === 0)) {
                        this.editingQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                    }
                    
                    // ç¡®ä¿é€‰é¡¹å­˜åœ¨
                    if (!this.editingQuestion.options) {
                        this.editingQuestion.options = [];
                    }
                    
                    this.showEditDialog = true;
                },
                
                // å…³é—­ç¼–è¾‘å¯¹è¯æ¡†
                closeEditDialog() {
                    this.showEditDialog = false;
                    this.editingQuestion = null;
                },
                
                // ä¿å­˜ç¼–è¾‘çš„é¢˜ç›®
                saveEditQuestion() {
                    try {
                        // éªŒè¯æ•°æ®
                        if (!this.editingQuestion.content.trim()) {
                            NotificationSystem.error('è¯·è¾“å…¥é¢˜ç›®å†…å®¹ï¼');
                            return;
                        }
                        
                        // éªŒè¯é€‰æ‹©é¢˜å¿…é¡»æœ‰æ­£ç¡®ç­”æ¡ˆ
                        if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                            if (this.editingQuestion.answer === null || this.editingQuestion.answer === undefined) {
                                NotificationSystem.error('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼');
                                return;
                            }
                        } else if (this.editingQuestion.type === 'multiple') {
                            if (!Array.isArray(this.editingQuestion.answer) || this.editingQuestion.answer.length === 0) {
                                NotificationSystem.error('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼');
                                return;
                            }
                        } else {
                            if (!this.editingQuestion.answer || !this.editingQuestion.answer.toString().trim()) {
                                NotificationSystem.error('è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼');
                                return;
                            }
                        }
                        
                        // å¤„ç†æ ‡ç­¾
                        if (typeof this.editingQuestion.tags === 'string') {
                            this.editingQuestion.tags = this.editingQuestion.tags.split(',')
                                .map(tag => tag.trim())
                                .filter(tag => tag);
                        }
                        
                        // æ›´æ–°é¢˜ç›®
                        const index = this.questionBank.findIndex(q => q.id === this.editingQuestion.id);
                        if (index !== -1) {
                            this.questionBank[index] = Utils.deepClone(this.editingQuestion);
                            this.saveUserData();
                            NotificationSystem.success('é¢˜ç›®ä¿å­˜æˆåŠŸï¼');
                            this.closeEditDialog();
                        }
                    } catch (error) {
                        console.error('ä¿å­˜é¢˜ç›®å¤±è´¥:', error);
                        NotificationSystem.error('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                },
                
                // æ·»åŠ é€‰é¡¹
                addOption() {
                    if (!this.editingQuestion.options) {
                        this.editingQuestion.options = [];
                    }
                    
                    if (this.editingQuestion.options.length < 10) {
                        this.editingQuestion.options.push('');
                    }
                },
                
                // åˆ é™¤é€‰é¡¹
                removeOption(index) {
                    if (this.editingQuestion.options && this.editingQuestion.options.length > 2) {
                        this.editingQuestion.options.splice(index, 1);
                        
                        // é‡æ–°è°ƒæ•´ç­”æ¡ˆ
                        if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                            if (this.editingQuestion.answer >= this.editingQuestion.options.length) {
                                this.editingQuestion.answer = 0;
                            }
                        } else if (this.editingQuestion.type === 'multiple') {
                            this.editingQuestion.answer = this.editingQuestion.answer.filter(a => a < this.editingQuestion.options.length);
                        }
                    }
                },
                
                // æ‰¹é‡åˆ é™¤é¢˜ç›®
                deleteSelectedQuestions() {
                    const selectedQuestions = this.filteredManageQuestions.filter(q => q.selected);
                    
                    if (selectedQuestions.length === 0) {
                        NotificationSystem.warning('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®ï¼');
                        return;
                    }
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedQuestions.length} é“é¢˜ç›®å—ï¼Ÿ`)) {
                        const selectedIds = new Set(selectedQuestions.map(q => q.id));
                        this.questionBank = this.questionBank.filter(q => !selectedIds.has(q.id));
                        this.saveUserData();
                        
                        // æ¸…é™¤é€‰æ‹©çŠ¶æ€
                        this.filteredManageQuestions.forEach(q => delete q.selected);
                        
                        NotificationSystem.success(`å·²åˆ é™¤ ${selectedQuestions.length} é“é¢˜ç›®ï¼`);
                    }
                },
                
                // å…¨é€‰/å–æ¶ˆå…¨é€‰
                toggleSelectAllQuestions() {
                    // åˆ‡æ¢å…¨é€‰çŠ¶æ€
                    const currentAllSelected = this.isAllSelected;
                    this.filteredManageQuestions.forEach(q => {
                        q.selected = !currentAllSelected;
                    });
                },
                
                // è€ƒè¯•åŠŸèƒ½ç›¸å…³æ–¹æ³•
                // å¼€å§‹è€ƒè¯•
                startExam() {
                    if (this.totalExamQuestions === 0) {
                        NotificationSystem.warning('è¯·è‡³å°‘é€‰æ‹©ä¸€é“é¢˜ç›®ï¼');
                        return;
                    }
                    
                    this.setLoading(true, 'å‡†å¤‡è€ƒè¯•ä¸­...');
                    
                    try {
                        // æ ¹æ®é…ç½®æŠ½å–é¢˜ç›®
                        this.currentQuestions = this.selectQuestions();
                        
                        if (this.currentQuestions.length === 0) {
                            NotificationSystem.warning('é¢˜åº“ä¸­æ²¡æœ‰è¶³å¤Ÿçš„é¢˜ç›®ï¼');
                            return;
                        }
                        
                        // åˆå§‹åŒ–è€ƒè¯•çŠ¶æ€
                        this.isExamStarted = true;
                        this.isExamFinished = false;
                        this.currentQuestionIndex = 0;
                        this.userAnswers = {};
                        this.markedQuestions.clear();
                        this.submittedAnswers.clear();
                        this.currentAnswerSubmitted = false;
                        this.currentAnswerShown = false;
                        this.examStartTime = Date.now();
                        this.remainingTime = this.examConfig.time * 60;
                        
                        // å¯åŠ¨è®¡æ—¶å™¨
                        if (this.examConfig.enableTimer) {
                            this.startTimer();
                        }
                        
                        NotificationSystem.success('è€ƒè¯•å¼€å§‹ï¼');
                    } catch (error) {
                        console.error('å¼€å§‹è€ƒè¯•å¤±è´¥:', error);
                        NotificationSystem.error('è€ƒè¯•å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•');
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                // é€‰æ‹©é¢˜ç›®
                selectQuestions() {
                    const selectedQuestions = [];
                    const questionCounts = {
                        single: this.examConfig.single,
                        multiple: this.examConfig.multiple,
                        judge: this.examConfig.judge,
                        fill: this.examConfig.fill,
                        essay: this.examConfig.essay
                    };
                    
                    // ä½¿ç”¨ç”Ÿæˆå™¨æŒ‰é¢˜å‹æŠ½å–é¢˜ç›®
                    for (const [type, count] of Object.entries(questionCounts)) {
                        if (count <= 0) continue;
                        
                        let questionsOfType = this.questionBank.filter(q => q.type === type);
                        
                        // æ ¹æ®è§„åˆ™æ’åº
                        switch (this.examConfig.rule) {
                            case 'random':
                                questionsOfType = Utils.shuffleArray(questionsOfType);
                                break;
                            case 'sequential':
                                // ä¿æŒåŸé¡ºåº
                                break;
                            case 'difficulty':
                                questionsOfType.sort((a, b) => (a.difficulty || 2) - (b.difficulty || 2));
                                break;
                        }
                        
                        // æŠ½å–æŒ‡å®šæ•°é‡çš„é¢˜ç›®
                        const selected = questionsOfType.slice(0, count);
                        selectedQuestions.push(...selected);
                    }
                    
                    // æœ€åéšæœºæ‰“ä¹±é¡ºåº
                    if (this.examConfig.rule === 'random') {
                        return Utils.shuffleArray(selectedQuestions);
                    }
                    
                    return selectedQuestions;
                },
                
                // å¼€å§‹è®¡æ—¶å™¨
                startTimer() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                    }
                    
                    this.examTimer = setInterval(() => {
                        if (this.remainingTime > 0) {
                            this.remainingTime--;
                        } else {
                            this.submitExam();
                        }
                    }, 1000);
                },
                
                // é€‰æ‹©é€‰é¡¹
                selectOption(index) {
                    if (this.currentAnswerSubmitted) return;
                    
                    if (this.currentQuestion.type === 'multiple') {
                        // å¤šé€‰é¢˜
                        if (!this.userAnswers[this.currentQuestionIndex]) {
                            this.userAnswers[this.currentQuestionIndex] = [];
                        }
                        
                        const answers = this.userAnswers[this.currentQuestionIndex];
                        const optionIndex = answers.indexOf(index);
                        
                        if (optionIndex > -1) {
                            answers.splice(optionIndex, 1);
                        } else {
                            answers.push(index);
                        }
                        
                        // è§¦å‘å“åº”å¼æ›´æ–°
                        this.userAnswers = { ...this.userAnswers };
                    } else {
                        // å•é€‰é¢˜
                        this.userAnswers[this.currentQuestionIndex] = index;
                    }
                },
                
                // ä¿å­˜å¡«ç©ºé¢˜ç­”æ¡ˆ
                saveFillAnswer() {
                    // å¡«ç©ºé¢˜ç­”æ¡ˆå·²ç»é€šè¿‡ v-model ç»‘å®šï¼Œè¿™é‡Œåªæ˜¯ç¡®ä¿å“åº”å¼æ›´æ–°
                    this.userAnswers = { ...this.userAnswers };
                },
                
                // ä¿å­˜ç®€ç­”é¢˜ç­”æ¡ˆ
                saveEssayAnswer() {
                    // ç®€ç­”é¢˜ç­”æ¡ˆå·²ç»é€šè¿‡ v-model ç»‘å®šï¼Œè¿™é‡Œåªæ˜¯ç¡®ä¿å“åº”å¼æ›´æ–°
                    this.userAnswers = { ...this.userAnswers };
                },
                
                // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                isAnswerCorrect(questionIndex) {
                    const question = this.currentQuestions[questionIndex];
                    const userAnswer = this.userAnswers[questionIndex];
                    
                    if (userAnswer === undefined) return false;
                    
                    const checker = AnswerCheckers[question.type];
                    return checker ? checker(userAnswer, question.answer) : false;
                },
                
                // æ ¼å¼åŒ–ç­”æ¡ˆæ˜¾ç¤º
                formatAnswer(answer) {
                    if (Array.isArray(answer)) {
                        return answer.map(i => String.fromCharCode(65 + i)).join(', ');
                    } else if (typeof answer === 'number') {
                        return String.fromCharCode(65 + answer);
                    } else {
                        return answer;
                    }
                },
                
                // ä¸‹ä¸€é¢˜
                nextQuestion() {
                    try {
                        if (this.currentQuestionIndex < this.currentQuestions.length - 1) {
                            // ç›´æ¥è¿›å…¥ä¸‹ä¸€é¢˜
                            this.currentQuestionIndex++;
                            this.currentAnswerShown = false;
                            this.currentAnswerSubmitted = this.submittedAnswers.has(this.currentQuestionIndex);
                            
                            // è®°å½•æ“ä½œ
                            console.log('åˆ‡æ¢åˆ°é¢˜ç›®:', this.currentQuestionIndex + 1);
                        } else {
                            // å·²ç»æ˜¯æœ€åä¸€é¢˜ï¼Œæç¤ºæäº¤
                            if (confirm('å·²ç»æ˜¯æœ€åä¸€é¢˜ï¼Œæ˜¯å¦æäº¤è€ƒè¯•ï¼Ÿ')) {
                                this.submitExam();
                            }
                        }
                    } catch (error) {
                        console.error('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºé”™:', error);
                        NotificationSystem.error('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•');
                    }
                },
                
                // æäº¤å½“å‰ç­”æ¡ˆ
                submitCurrentAnswer() {
                    if (!this.hasAnswerForCurrentQuestion) {
                        NotificationSystem.warning('è¯·å…ˆé€‰æ‹©ç­”æ¡ˆï¼');
                        return;
                    }
                    
                    this.currentAnswerSubmitted = true;
                    this.submittedAnswers.add(this.currentQuestionIndex);
                    
                    // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                    const isCorrect = this.isAnswerCorrect(this.currentQuestionIndex);
                    
                    // å¦‚æœæ˜¯é”™é¢˜ï¼Œæ·»åŠ åˆ°é”™é¢˜æœ¬
                    if (!isCorrect) {
                        this.addToMistakeBank(this.currentQuestion, this.userAnswers[this.currentQuestionIndex]);
                    }
                    
                    // è‡ªåŠ¨æ˜¾ç¤ºç­”æ¡ˆ
                    if (this.examConfig.showAnswerImmediately) {
                        this.currentAnswerShown = true;
                    }
                },
                
                // è·³è½¬åˆ°æŒ‡å®šé¢˜ç›®
                jumpToQuestion(index) {
                    this.currentQuestionIndex = index;
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = this.submittedAnswers.has(index);
                },
                
                // æ ‡è®°é¢˜ç›®
                markQuestion() {
                    if (this.markedQuestions.has(this.currentQuestionIndex)) {
                        this.markedQuestions.delete(this.currentQuestionIndex);
                    } else {
                        this.markedQuestions.add(this.currentQuestionIndex);
                    }
                },
                
                // è·å–ç­”é¢˜å¡æ ·å¼
                getAnswerCardClass(index) {
                    const baseClass = 'answer-card-item';
                    const classes = [baseClass];
                    
                    if (index === this.currentQuestionIndex) {
                        classes.push('current');
                    }
                    
                    if (this.submittedAnswers.has(index)) {
                        if (this.isAnswerCorrect(index)) {
                            classes.push('answered');
                        } else {
                            classes.push('wrong');
                        }
                    } else if (this.userAnswers[index] !== undefined) {
                        classes.push('unanswered');
                    } else {
                        classes.push('unanswered');
                    }
                    
                    if (this.markedQuestions.has(index)) {
                        classes.push('marked');
                    }
                    
                    return classes.join(' ');
                },
                
                // æš‚åœè€ƒè¯•
                pauseExam() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                        this.examTimer = null;
                    }
                },
                
                // ç»§ç»­è€ƒè¯•
                resumeExam() {
                    this.pauseExamDialog = false;
                    if (this.examConfig.enableTimer) {
                        this.startTimer();
                    }
                },
                
                // æ”¾å¼ƒè€ƒè¯•
                abandonExam() {
                    if (confirm('ç¡®å®šè¦æ”¾å¼ƒè€ƒè¯•å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸ä¼šä¿å­˜ã€‚')) {
                        this.pauseExam();
                        this.isExamStarted = false;
                        this.isExamFinished = false;
                        this.pauseExamDialog = false;
                        this.switchMode('home');
                    }
                },
                
                // æ·»åŠ é”™é¢˜åˆ°é”™é¢˜æœ¬
                addToMistakeBank(question, wrongAnswer) {
                    const mistake = {
                        id: Utils.generateId('mistake'),
                        content: question.content,
                        type: question.type,
                        options: question.options || [],
                        answer: question.answer,
                        wrongAnswer: wrongAnswer,
                        analysis: question.analysis || '',
                        mistakeTime: new Date().toISOString(),
                        isImportant: false,
                        reviewCount: 0,
                        lastReviewTime: null
                    };
                    
                    this.mistakeBank.push(mistake);
                    this.saveUserData();
                },
                
                submitExam() {
                    this.setLoading(true, 'æ­£åœ¨æäº¤è€ƒè¯•...');
                    
                    try {
                        // ç¡®ä¿è®¡æ—¶å™¨åœæ­¢
                        if (this.examTimer) {
                            clearInterval(this.examTimer);
                            this.examTimer = null;
                        }
                        
                        // è®¡ç®—å¾—åˆ†
                        const totalQuestions = this.currentQuestions.length;
                        let correctCount = 0;
                        
                        // ä½¿ç”¨ç°æœ‰çš„isAnswerCorrectæ–¹æ³•è¿›è¡Œè¯„åˆ†
                        for (let i = 0; i < totalQuestions; i++) {
                            const userAnswer = this.userAnswers[i];
                            const question = this.currentQuestions[i];
                            
                            if (userAnswer !== undefined) {
                                if (this.isAnswerCorrect(i)) {
                                    correctCount++;
                                } else {
                                    this.addToMistakeBank(question, userAnswer);
                                }
                            } else {
                                // æœªå›ç­”çš„é¢˜ç›®è§†ä¸ºé”™é¢˜ï¼ŒåŠ å…¥é”™é¢˜æœ¬
                                this.addToMistakeBank(question, null);
                            }
                        }
                        
                        const score = Math.round((correctCount / totalQuestions) * 100);
                        
                        // è®¡ç®—ç­‰çº§
                        let grade = '';
                        let gradeClass = '';
                        
                        for (const [key, level] of Object.entries(AppConfig.gradeLevels)) {
                            if (score >= level.min) {
                                grade = level.label;
                                gradeClass = key;
                                break;
                            }
                        }
                        
                        // è®°å½•è€ƒè¯•ç»“æœ
                        this.studyStats.examRecords.push({
                            date: new Date().toISOString(),
                            score: score,
                            grade: grade,
                            correctCount: correctCount,
                            wrongCount: totalQuestions - correctCount,
                            totalQuestions: totalQuestions,
                            duration: Math.round((Date.now() - this.examStartTime) / 1000),
                            questions: this.currentQuestions.map((q, i) => {
                                const userAnswer = this.userAnswers[i];
                                let isCorrect = false;
                                
                                if (userAnswer !== undefined) {
                                    if (q.type === 'multiple') {
                                        isCorrect = JSON.stringify(userAnswer.sort()) === JSON.stringify(q.answer.sort());
                                    } else if (q.type === 'fill') {
                                        const correctAnswers = q.answer.toString().split(',').map(a => a.trim().toLowerCase());
                                        isCorrect = correctAnswers.includes(userAnswer.toString().trim().toLowerCase());
                                    } else if (q.type === 'essay') {
                                        // ç®€ç­”é¢˜è¯„åˆ†ï¼šæ£€æŸ¥å…³é”®è¯åŒ¹é…
                                        const userContent = userAnswer.toString().trim().toLowerCase();
                                        const correctAnswer = q.answer.toString().trim().toLowerCase();
                                        
                                        if (userContent && correctAnswer) {
                                            const keywords = correctAnswer.split(/[,ï¼Œ.ã€‚;ï¼›\s]+/).filter(word => word.length > 1);
                                            const matchedKeywords = keywords.filter(keyword => userContent.includes(keyword));
                                            isCorrect = matchedKeywords.length >= Math.ceil(keywords.length * 0.5);
                                        }
                                    } else {
                                        isCorrect = userAnswer == q.answer;
                                    }
                                }
                                
                                return {
                                    content: q.content,
                                    type: q.type,
                                    userAnswer: userAnswer,
                                    correctAnswer: q.answer,
                                    isCorrect: isCorrect
                                };
                            })
                        });
                        
                        this.studyStats.totalQuestions += totalQuestions;
                        this.studyStats.correctAnswers += correctCount;
                        
                        // ä¿å­˜æ•°æ®
                        this.saveUserData();
                        
                        // è®¾ç½®è€ƒè¯•ç»“æœå¯¹è±¡
                        this.examResult = {
                            score: score,
                            grade: grade,
                            gradeClass: gradeClass,
                            totalQuestions: totalQuestions,
                            correctCount: correctCount,
                            wrongCount: totalQuestions - correctCount,
                            duration: Math.round((Date.now() - this.examStartTime) / 1000)
                        };
                        
                        // æ ‡è®°è€ƒè¯•å®Œæˆï¼Œæ˜¾ç¤ºç»“ç®—é¡µé¢
                        this.isExamFinished = true;
                        this.isExamStarted = false;
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        console.log('è€ƒè¯•æäº¤æˆåŠŸï¼å¾—åˆ†ï¼š' + score + 'åˆ†ï¼Œç­‰çº§ï¼š' + grade);
                        
                    } catch (error) {
                        console.error('æäº¤è€ƒè¯•æ—¶å‡ºé”™:', error);
                        
                        // å³ä½¿å‡ºé”™ä¹Ÿè¦æ˜¾ç¤ºç»“ç®—é¡µé¢
                        this.examResult = {
                            score: correctCount || 0,
                            grade: 'å¾…è¯„å®š',
                            gradeClass: 'average',
                            totalQuestions: totalQuestions || 0,
                            correctCount: correctCount || 0,
                            wrongCount: (totalQuestions || 0) - (correctCount || 0),
                            duration: Math.round((Date.now() - (this.examStartTime || Date.now())) / 1000)
                        };
                        
                        this.isExamFinished = true;
                        this.isExamStarted = false;
                        
                        NotificationSystem.warning('è€ƒè¯•å·²å®Œæˆï¼Œç³»ç»Ÿå·²è®°å½•æ‚¨çš„ç­”é¢˜æƒ…å†µã€‚');
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                // æŸ¥çœ‹è€ƒè¯•è¯¦æƒ…
                reviewExam() {
                    // æ˜¾ç¤ºè€ƒè¯•è¯¦æƒ…å¯¹è¯æ¡†
                    this.showExamDetailDialog = true;
                },
                
                // é‡æ–°è€ƒè¯•
                startNewExam() {
                    this.isExamStarted = false;
                    this.isExamFinished = false;
                },
                
                // åŠ è½½æ¨èé…ç½®
                loadRecommendedConfig() {
                    const totalAvailable = this.questionBank.length;
                    const recommendedCount = Math.min(totalAvailable, 20);
                    
                    // æ ¹æ®é¢˜å‹æ¯”ä¾‹åˆ†é…é¢˜ç›®æ•°é‡
                    const typeRatios = {
                        single: 0.4,
                        multiple: 0.2,
                        judge: 0.3,
                        fill: 0.05,
                        essay: 0.05
                    };
                    
                    Object.entries(typeRatios).forEach(([type, ratio]) => {
                        const available = this.questionTypeCount[type] || 0;
                        const recommended = Math.round(recommendedCount * ratio);
                        this.examConfig[type] = Math.min(recommended, available);
                    });
                    
                    // è°ƒæ•´æ—¶é—´
                    this.examConfig.time = this.suggestedTime;
                    this.examConfig.enableTimer = true;
                    this.examConfig.showAnswerImmediately = true;
                    this.examConfig.showAnalysis = true;
                },
                
                // é‡ç½®é…ç½®
                resetConfig() {
                    this.examConfig = {
                        single: 5,
                        multiple: 3,
                        judge: 5,
                        fill: 2,
                        essay: 1,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true,
                        showAnalysis: true
                    };
                },
                
                // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                formatDuration(seconds) {
                    return Utils.formatDuration(seconds);
                },
                
                // è·å–ç­‰çº§æ ·å¼
                getGradeClass(grade) {
                    switch(grade) {
                        case 'ä¼˜ç§€': return 'text-green-600';
                        case 'è‰¯å¥½': return 'text-blue-600';
                        case 'åŠæ ¼': return 'text-orange-600';
                        case 'ä¸åŠæ ¼': return 'text-red-600';
                        default: return 'text-gray-600';
                    }
                },
                
                // è·å–æˆç»©æ ·å¼
                getScoreClass(score) {
                    if (score >= 90) return 'text-green-600';
                    if (score >= 80) return 'text-blue-600';
                    if (score >= 60) return 'text-orange-600';
                    return 'text-red-600';
                },
                
                // è®¡ç®—è€ƒè¯•ç»Ÿè®¡æ•°æ®ï¼ˆç¼“å­˜ç»“æœé¿å…é‡å¤è®¡ç®—ï¼‰
                getExamStats() {
                    const records = this.studyStats.examRecords;
                    if (records.length === 0) {
                        return { max: 0, average: 0, latest: 0 };
                    }
                    
                    // ç¼“å­˜è®¡ç®—ç»“æœ
                    if (!this._examStatsCache || this._examStatsCache.timestamp !== records.length) {
                        const scores = records.map(r => r.score);
                        this._examStatsCache = {
                            max: Math.max(...scores),
                            average: Math.round(scores.reduce((acc, score) => acc + score, 0) / scores.length),
                            latest: records[records.length - 1].score,
                            timestamp: records.length
                        };
                    }
                    
                    return this._examStatsCache;
                },
                
                // è·å–æœ€é«˜åˆ†
                getMaxScore() {
                    return this.getExamStats().max;
                },
                
                // è·å–å¹³å‡åˆ†
                getAverageScore() {
                    return this.getExamStats().average;
                },
                
                // è·å–æœ€è¿‘æˆç»©
                getLatestScore() {
                    return this.getExamStats().latest;
                },
                
                // æŸ¥çœ‹è€ƒè¯•è¯¦æƒ…
                viewExamDetail(record) {
                    this.currentExamDetail = record;
                    this.showExamDetail = true;
                },
                
                // åˆ é™¤è€ƒè¯•è®°å½•
                deleteExamRecord(index) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è€ƒè¯•è®°å½•å—ï¼Ÿ')) {
                        this.studyStats.examRecords.splice(index, 1);
                        this.saveUserData();
                        this.renderScoreChart();
                    }
                },
                
                // ç»˜åˆ¶æˆç»©è¶‹åŠ¿å›¾
                renderScoreChart() {
                    if (this.studyStats.examRecords.length <= 1) return;
                    
                    const ctx = document.getElementById('scoreChart');
                    if (!ctx) return;
                    
                    // é”€æ¯ä¹‹å‰çš„å›¾è¡¨
                    if (this.scoreChart) {
                        this.scoreChart.destroy();
                    }
                    
                    const records = this.studyStats.examRecords.slice(-10); // æœ€è¿‘10æ¬¡è€ƒè¯•
                    const labels = records.map(r => Utils.formatDate(r.date, true));
                    const scores = records.map(r => r.score);
                    
                    this.scoreChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'è€ƒè¯•æˆç»©',
                                data: scores,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        stepSize: 10
                                    }
                                }
                            }
                        }
                    });
                },
                
                // å¯¼å‡ºé”™é¢˜
                exportMistakes() {
                    if (this.mistakeBank.length === 0) {
                        NotificationSystem.warning('é”™é¢˜æœ¬ä¸ºç©ºï¼');
                        return;
                    }
                    
                    try {
                        const mistakes = this.mistakeBank.map(mistake => ({
                            id: mistake.id,
                            content: mistake.content,
                            type: mistake.type,
                            options: mistake.options || [],
                            correctAnswer: mistake.answer,
                            wrongAnswer: mistake.wrongAnswer,
                            analysis: mistake.analysis,
                            mistakeTime: mistake.mistakeTime,
                            isImportant: mistake.isImportant
                        }));
                        
                        const data = {
                            mistakes: mistakes,
                            exportTime: new Date().toISOString(),
                            totalCount: mistakes.length
                        };
                        
                        const dataStr = JSON.stringify(data, null, 2);
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `é”™é¢˜é›†_${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        NotificationSystem.success(`å·²å¯¼å‡º ${mistakes.length} é“é”™é¢˜ï¼`);
                    } catch (error) {
                        console.error('å¯¼å‡ºé”™é¢˜å¤±è´¥:', error);
                        NotificationSystem.error('å¯¼å‡ºé”™é¢˜å¤±è´¥');
                    }
                },
                
                // è®¾ç½®åŠ è½½çŠ¶æ€
                setLoading(isLoading, message = 'åŠ è½½ä¸­...') {
                    this.isLoading = isLoading;
                    this.loadingMessage = message;
                }
            },
            
            mounted() {
                // æ£€æŸ¥å­˜å‚¨ç©ºé—´
                if (!StorageManager.checkStorage()) {
                    NotificationSystem.warning('æµè§ˆå™¨å­˜å‚¨ç©ºé—´å¯èƒ½ä¸è¶³ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™');
                }
                
                // å°è¯•åŠ è½½å½“å‰ç”¨æˆ·
                try {
                    const savedUser = StorageManager.loadData(AppConfig.storageKeys.currentUser);
                    if (savedUser) {
                        this.currentUser = savedUser;
                        this.loadUserData();
                    }
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                }
                
                // ç›‘å¬é¡µé¢å¸è½½äº‹ä»¶ï¼Œä¿å­˜æ•°æ®
                window.addEventListener('beforeunload', () => {
                    this.saveUserData();
                });
                
                // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œæš‚åœ/æ¢å¤è€ƒè¯•
                document.addEventListener('visibilitychange', () => {
                    if (this.isExamStarted && !this.isExamFinished && this.examConfig.enableTimer) {
                        if (document.hidden) {
                            // é¡µé¢éšè—æ—¶æš‚åœè®¡æ—¶å™¨
                            if (this.examTimer) {
                                clearInterval(this.examTimer);
                                this.examTimer = null;
                            }
                        } else {
                            // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤è®¡æ—¶å™¨
                            this.startTimer();
                        }
                    }
                });
            }
        }).mount('#app');
    </script>
</body>
</html>