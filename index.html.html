<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ - é«˜æ•ˆå­¦ä¹ åŠ©æ‰‹</title>
    <!-- æ ¸å¿ƒåº“ CDN å¼•å…¥ -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script> <!-- ä¿®å¤ï¼šä½¿ç”¨ç”Ÿäº§ç‰ˆ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        :root {
            --primary: #07c160;
            --primary-light: #19be6b;
            --secondary: #f5f5f5;
            --accent: #ff6900;
            --danger: #fa5151;
            --success: #19be6b;
            --text-primary: #333333;
            --text-secondary: #666666;
            --bg-white: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        * {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
        }
        .card {
            background: var(--bg-white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-primary:hover {
            background: var(--primary-light);
            transform: scale(1.02);
        }
        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        .btn-danger:hover {
            background: #e64545;
            transform: scale(1.02);
        }
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .nav-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .nav-tab.active {
            background: var(--primary);
            color: white;
        }
        .nav-tab:hover:not(.active) {
            background: var(--secondary);
        }
        .question-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .question-option:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        .question-option.selected {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        .question-option.correct {
            border-color: var(--success);
            background: rgba(25, 190, 107, 0.1);
        }
        .question-option.wrong {
            border-color: var(--danger);
            background: rgba(250, 81, 81, 0.1);
        }
        .question-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .slider-container {
            position: relative;
            margin: 20px 0;
        }
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            transition: all 0.3s ease;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.5);
        }
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.05);
        }
        .file-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(7, 193, 96, 0.1);
        }
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .slide-enter-active, .slide-leave-active {
            transition: all 0.3s ease;
        }
        .slide-enter-from {
            transform: translateX(100px);
            opacity: 0;
        }
        .slide-leave-to {
            transform: translateX(-100px);
            opacity: 0;
        }
        @media (max-width: 768px) {
            .mobile-full {
                width: 100%;
                margin: 8px 0;
            }
            .mobile-stack {
                flex-direction: column;
            }
            .mobile-padding {
                padding: 16px;
            }
            /* ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ ·å¼ */
            .bottom-nav button.active {
                color: #07c160;
                background: rgba(7, 193, 96, 0.1);
            }
            /* ç§»åŠ¨ç«¯å†…å®¹åŒºåŸŸåº•éƒ¨é—´è· */
            body {
                padding-bottom: 80px;
            }
            /* ç§»åŠ¨ç«¯å¯¹è¯æ¡†æ ·å¼ä¼˜åŒ– */
            .mobile-dialog {
                margin: 16px;
                max-height: calc(100vh - 32px);
            }
        }
        /* åº•éƒ¨å¯¼èˆªæ¿€æ´»çŠ¶æ€ */
        .bottom-nav button.active {
            color: #07c160;
        }
        /* ç­”æ¡ˆæ˜¾ç¤ºæ ·å¼ */
        .answer-show {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
        .answer-correct {
            background: #f0fdf4;
            border-color: #16a34a;
        }
        .answer-wrong {
            background: #fef2f2;
            border-color: #dc2626;
        }
        .real-time-answer {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
        }
        @media (max-width: 768px) {
            .real-time-answer {
                position: fixed;
                bottom: 80px;
                top: auto;
                right: 10px;
                left: 10px;
                transform: none;
                max-width: none;
            }
        }
        /* æ ¼å¼è¯´æ˜æ ·å¼ */
        .format-sample {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-green-600">ğŸ“š æ™ºèƒ½åˆ·é¢˜</div>
                    </div>
                    <div class="hidden md:flex space-x-2">
                        <div class="nav-tab" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                            é¦–é¡µ
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'config'}" @click="switchMode('config')">
                            é…ç½®
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                            åˆ·é¢˜
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                            é”™é¢˜
                        </div>
                        <div class="nav-tab" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                            ç®¡ç†
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button class="btn-secondary text-sm" @click="shareLink">
                            åˆ†äº«
                        </button>
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" v-if="!currentUser">
                            <span class="text-green-600 text-sm cursor-pointer" @click="showLoginDialog = true">ğŸ‘¤</span>
                        </div>
                        <div class="flex items-center space-x-2" v-else>
                            <span class="text-sm text-gray-600">{{ currentUser.username }}</span>
                            <button class="text-red-600 text-sm" @click="logout">é€€å‡º</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="max-w-6xl mx-auto px-4 py-6">
            <!-- é¦–é¡µæ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'home'" key="home">
                    <!-- Hero åŒºåŸŸ -->
                    <div class="hero-bg rounded-2xl p-8 mb-8 relative">
                        <div class="relative z-10">
                            <h1 class="text-4xl font-bold text-white mb-4">
                                æ™ºèƒ½åˆ·é¢˜ï¼Œé«˜æ•ˆå­¦ä¹ 
                            </h1>
                            <p class="text-xl text-white mb-6">
                                æ”¯æŒå¤šç§é¢˜å‹ç»ƒä¹ ï¼Œæ”¯æŒå¯¼å…¥é¢˜åº“ï¼Œè®©å­¦ä¹ æ›´ç®€å•
                            </p>
                            <div class="flex flex-wrap gap-4">
                                <button class="btn-primary bg-white text-green-600 hover:bg-gray-100" @click="switchMode('config')">
                                    å¼€å§‹è€ƒè¯•
                                </button>
                                <button class="btn-secondary bg-white bg-opacity-20 text-white hover:bg-opacity-30" @click="startPracticeMode">
                                    ç»ƒä¹ æ¨¡å¼
                                </button>
                                <button class="btn-danger bg-orange-500 text-white hover:bg-orange-600" @click="switchMode('mistakes')">
                                    é”™é¢˜å¤ä¹ 
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- å­¦ä¹ ç»Ÿè®¡ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="stats-card">
                            <div class="stats-number">{{ totalQuestions }}</div>
                            <div class="stats-label">æ€»é¢˜æ•°</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ correctRate }}%</div>
                            <div class="stats-label">æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ studyHours }}</div>
                            <div class="stats-label">å­¦ä¹ æ—¶é•¿(h)</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number">{{ mistakeCount }}</div>
                            <div class="stats-label">é”™é¢˜æ•°</div>
                        </div>
                    </div>
                    <!-- åŠŸèƒ½å¡ç‰‡ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 cursor-pointer" @click="switchMode('config')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“</div>
                                <h3 class="text-xl font-bold">è€ƒè¯•æ¨¡å¼</h3>
                            </div>
                            <p class="text-gray-600 mb-4">æ¨¡æ‹ŸçœŸå®è€ƒè¯•ç¯å¢ƒï¼Œå€’è®¡æ—¶ç­”é¢˜ï¼Œäº¤å·åæŸ¥çœ‹æˆç»©</p>
                            <div class="text-green-600 font-medium">ç«‹å³å¼€å§‹ â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="startPracticeMode">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">ğŸ“–</div>
                                <h3 class="text-xl font-bold">ç»ƒä¹ æ¨¡å¼</h3>
                            </div>
                            <div class="text-gray-600 mb-4">
                                <p>â€¢ è‡ªç”±ç»ƒä¹ ï¼Œå³æ—¶æŸ¥çœ‹ç­”æ¡ˆè§£æ</p>
                                <p>â€¢ å·©å›ºçŸ¥è¯†ç‚¹ï¼Œæ— æ—¶é—´é™åˆ¶</p>
                                <p>â€¢ æ”¯æŒæŸ¥çœ‹ç­”æ¡ˆåŠŸèƒ½</p>
                            </div>
                            <div class="text-green-600 font-medium">å¼€å§‹ç»ƒä¹  â†’</div>
                        </div>
                        <div class="card p-6 cursor-pointer" @click="switchMode('mistakes')">
                            <div class="flex items-center mb-4">
                                <div class="text-4xl mr-4">âŒ</div>
                                <h3 class="text-xl font-bold">é”™é¢˜ç®¡ç†</h3>
                            </div>
                            <p class="text-gray-600 mb-4">è‡ªåŠ¨æ”¶é›†é”™é¢˜ï¼Œé’ˆå¯¹æ€§å¤ä¹ ï¼Œæé«˜å­¦ä¹ æ•ˆç‡</p>
                            <div class="text-green-600 font-medium">æŸ¥çœ‹é”™é¢˜ â†’</div>
                        </div>
                    </div>
                    <!-- é¢˜åº“ç®¡ç† -->
                    <div class="card p-6">
                        <h3 class="text-2xl font-bold mb-6">é¢˜åº“ç®¡ç†</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-semibold mb-4">å¯¼å…¥é¢˜åº“</h4>
                                <div class="file-upload-area" @drop="handleFileDrop" @dragover="handleDragOver" @dragleave="handleDragLeave" @click="triggerFileInput">
                                    <div class="text-4xl mb-4">ğŸ“</div>
                                    <div class="text-lg font-medium mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                                    <div class="text-sm text-gray-500">æ”¯æŒ .txt, .docx, .json, .xlsx æ ¼å¼æ–‡ä»¶</div>
                                </div>
                                <input type="file" ref="fileInput" multiple accept=".txt,.docx,.json,.xlsx" @change="handleFileSelect" class="hidden">
                                <div class="mt-4">
                                    <button class="btn-primary w-full" @click="showFormatSample = true">
                                        æŸ¥çœ‹æ ¼å¼è¯´æ˜
                                    </button>
                                </div>
                                <div class="mt-4" v-if="uploadProgress > 0">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span>å¯¼å…¥è¿›åº¦</span>
                                        <span>{{ uploadProgress }}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" :style="{width: uploadProgress + '%'}"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-4">é¢˜åº“æ“ä½œ</h4>
                                <div class="space-y-3">
                                    <button class="btn-secondary w-full" @click="loadSampleQuestions">
                                        åŠ è½½ç¤ºä¾‹é¢˜åº“
                                    </button>
                                    <button class="btn-danger w-full" @click="clearQuestionBank">
                                        æ¸…ç©ºé¢˜åº“
                                    </button>
                                    <button class="btn-primary w-full" @click="switchMode('manage')">
                                        é¢˜ç›®ç®¡ç†
                                    </button>
                                </div>
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h5 class="font-semibold mb-2">å½“å‰é¢˜åº“çŠ¶æ€</h5>
                                    <div class="space-y-1 text-sm">
                                        <div>æ€»é¢˜æ•°ï¼š{{ questionBank.length }}</div>
                                        <div>å•é€‰é¢˜ï¼š{{ questionTypeCount.single }}</div>
                                        <div>å¤šé€‰é¢˜ï¼š{{ questionTypeCount.multiple }}</div>
                                        <div>åˆ¤æ–­é¢˜ï¼š{{ questionTypeCount.judge }}</div>
                                        <div>å¡«ç©ºé¢˜ï¼š{{ questionTypeCount.fill }}</div>
                                        <div>ç®€ç­”é¢˜ï¼š{{ questionTypeCount.essay }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
            <!-- é…ç½®æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'config'" key="config">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6">è€ƒè¯•é…ç½®</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">é¢˜å‹è®¾ç½®</h3>
                                <div class="space-y-6">
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>å•é€‰é¢˜</label>
                                            <span>{{ examConfig.single }} é¢˜</span>
                                        </div>
                                        <input type="range" v-model="examConfig.single" min="0" :max="questionTypeCount.single" class="slider">
                                    </div>
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>å¤šé€‰é¢˜</label>
                                            <span>{{ examConfig.multiple }} é¢˜</span>
                                        </div>
                                        <input type="range" v-model="examConfig.multiple" min="0" :max="questionTypeCount.multiple" class="slider">
                                    </div>
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>åˆ¤æ–­é¢˜</label>
                                            <span>{{ examConfig.judge }} é¢˜</span>
                                        </div>
                                        <input type="range" v-model="examConfig.judge" min="0" :max="questionTypeCount.judge" class="slider">
                                    </div>
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>å¡«ç©ºé¢˜</label>
                                            <span>{{ examConfig.fill }} é¢˜</span>
                                        </div>
                                        <input type="range" v-model="examConfig.fill" min="0" :max="questionTypeCount.fill" class="slider">
                                    </div>
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>ç®€ç­”é¢˜</label>
                                            <span>{{ examConfig.essay }} é¢˜</span>
                                        </div>
                                        <input type="range" v-model="examConfig.essay" min="0" :max="questionTypeCount.essay" class="slider">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-4">è€ƒè¯•è®¾ç½®</h3>
                                <div class="space-y-6">
                                    <div class="slider-container">
                                        <div class="flex justify-between mb-2">
                                            <label>è€ƒè¯•æ—¶é—´</label>
                                            <span>{{ examConfig.time }} åˆ†é’Ÿ</span>
                                        </div>
                                        <input type="range" v-model="examConfig.time" min="5" max="180" class="slider">
                                    </div>
                                    <div>
                                        <label class="block mb-3 font-medium">æŠ½é¢˜è§„åˆ™</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="radio" v-model="examConfig.rule" value="random" class="mr-2">
                                                <span>éšæœºæŠ½å–</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" v-model="examConfig.rule" value="tag" class="mr-2">
                                                <span>æŒ‰çŸ¥è¯†ç‚¹ç­›é€‰</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" v-model="examConfig.enableTimer" class="mr-2">
                                            <span>å¯ç”¨è®¡æ—¶åŠŸèƒ½</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" v-model="examConfig.showAnswerImmediately" class="mr-2">
                                            <span>è€ƒè¯•ä¸­å¯æŸ¥çœ‹ç­”æ¡ˆ</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-semibold mb-2">è€ƒè¯•æ¦‚è§ˆ</h4>
                                    <div class="space-y-1 text-sm">
                                        <div>æ€»é¢˜æ•°: {{ totalExamQuestions }} é¢˜</div>
                                        <div>è€ƒè¯•æ—¶é—´: {{ examConfig.enableTimer ? examConfig.time + 'åˆ†é’Ÿ' : 'ä¸é™æ—¶' }}</div>
                                        <div>æŠ½é¢˜æ–¹å¼: {{ examConfig.rule === 'random' ? 'éšæœºæŠ½å–' : 'æŒ‰çŸ¥è¯†ç‚¹' }}</div>
                                        <div>ç­”æ¡ˆæ˜¾ç¤º: {{ examConfig.showAnswerImmediately ? 'æ”¯æŒæŸ¥çœ‹ç­”æ¡ˆ' : 'äº¤å·åæ˜¾ç¤º' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-center mt-8 space-x-4">
                            <button class="btn-primary" @click="startExam">
                                å¼€å§‹è€ƒè¯•
                            </button>
                            <button class="btn-secondary" @click="resetConfig">
                                é‡ç½®é…ç½®
                            </button>
                        </div>
                    </div>
                </div>
            </transition>
            <!-- è€ƒè¯•/ç»ƒä¹ æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'exam'" key="exam">
                    <div class="card p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">
                                {{ examMode === 'exam' ? 'è€ƒè¯•æ¨¡å¼' : 'ç»ƒä¹ æ¨¡å¼' }}
                            </h2>
                            <div class="flex items-center space-x-4">
                                <div class="text-lg font-semibold" :class="timerColor">
                                    â° {{ formattedTime }}
                                </div>
                                <button class="btn-secondary text-sm" @click="submitCurrentAnswer" v-if="!currentAnswerSubmitted && currentQuestion.type !== 'essay'">
                                    æäº¤ç­”æ¡ˆ
                                </button>
                                <button class="btn-secondary text-sm" @click="pauseExam" v-if="examMode === 'practice'">
                                    æš‚åœ
                                </button>
                                <button class="btn-danger text-sm" @click="submitExam">
                                    äº¤å·
                                </button>
                            </div>
                        </div>
                        <!-- è¿›åº¦æ¡ -->
                        <div class="mb-6">
                            <div class="flex justify-between text-sm mb-2">
                                <span>è¿›åº¦</span>
                                <span>{{ currentQuestionIndex + 1 }} / {{ currentQuestions.length }}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{width: examProgress + '%'}"></div>
                            </div>
                        </div>
                        <!-- é¢˜ç›®å†…å®¹ -->
                        <div v-if="currentQuestion" class="mb-8">
                            <div class="mb-4">
                                <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-sm mr-2">
                                    {{ getQuestionTypeText(currentQuestion.type) }}
                                </span>
                                <span class="text-gray-500">ç¬¬ {{ currentQuestionIndex + 1 }} é¢˜</span>
                                <span v-if="currentAnswerSubmitted" class="ml-2 inline-block px-2 py-1 rounded text-xs" :class="isAnswerCorrect(currentQuestionIndex) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                    {{ isAnswerCorrect(currentQuestionIndex) ? 'å·²ç­”å¯¹' : 'å·²ç­”é”™' }}
                                </span>
                            </div>
                            <div class="text-lg mb-6" v-html="currentQuestion.content"></div>
                            <!-- é€‰é¡¹ -->
                            <div class="space-y-3 mb-6" v-if="currentQuestion.options && currentQuestion.options.length">
                                <div v-for="(option, index) in currentQuestion.options" 
                                     :key="index"
                                     class="question-option"
                                     :class="getOptionClass(index)"
                                     @click="selectOption(index)">
                                    <div class="flex items-center">
                                        <span class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 mr-3 font-semibold">
                                            {{ String.fromCharCode(65 + index) }}
                                        </span>
                                        <span v-html="option"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- ç®€ç­”é¢˜è¾“å…¥åŒºåŸŸ -->
                            <div v-if="currentQuestion.type === 'essay'" class="mb-6">
                                <label class="block text-sm font-medium mb-2">è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆï¼š</label>
                                <textarea 
                                    v-model="userAnswers[currentQuestionIndex]" 
                                    class="w-full p-3 border border-gray-300 rounded-lg" 
                                    rows="4" 
                                    placeholder="è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆ..."
                                    @input="saveEssayAnswer"
                                    :disabled="currentAnswerSubmitted">
                                </textarea>
                            </div>
                            <!-- å¡«ç©ºé¢˜è¾“å…¥åŒºåŸŸ -->
                            <div v-if="currentQuestion.type === 'fill'" class="mb-6">
                                <label class="block text-sm font-medium mb-2">è¯·è¾“å…¥ç­”æ¡ˆï¼š</label>
                                <input 
                                    type="text" 
                                    v-model="userAnswers[currentQuestionIndex]" 
                                    class="w-full p-3 border border-gray-300 rounded-lg" 
                                    placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..."
                                    :disabled="currentAnswerSubmitted">
                            </div>
                            <!-- æŸ¥çœ‹ç­”æ¡ˆæŒ‰é’® -->
                            <div class="mb-4" v-if="examMode === 'practice' || examConfig.showAnswerImmediately || currentAnswerSubmitted">
                                <button class="btn-secondary" @click="showCurrentAnswer" v-if="!currentAnswerShown">
                                    æŸ¥çœ‹ç­”æ¡ˆ
                                </button>
                                <button class="btn-secondary" @click="hideCurrentAnswer" v-else>
                                    éšè—ç­”æ¡ˆ
                                </button>
                            </div>
                            <!-- ç­”æ¡ˆæ˜¾ç¤ºåŒºåŸŸ -->
                            <div v-if="currentAnswerShown" class="answer-show" :class="currentAnswerClass">
                                <div class="mb-2">
                                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                                </div>
                                <div v-if="currentQuestion.analysis">
                                    <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                                </div>
                                <div v-if="userAnswers[currentQuestionIndex] !== undefined && currentQuestion.type !== 'essay' && currentQuestion.type !== 'fill'">
                                    <div v-if="isAnswerCorrect(currentQuestionIndex)">
                                        âœ… å›ç­”æ­£ç¡®ï¼
                                    </div>
                                    <div v-else>
                                        âŒ å›ç­”é”™è¯¯
                                    </div>
                                </div>
                                <div v-if="(currentQuestion.type === 'essay' || currentQuestion.type === 'fill') && userAnswers[currentQuestionIndex]">
                                    <div class="mt-2 p-2 bg-blue-50 rounded">
                                        <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ userAnswers[currentQuestionIndex] }}
                                    </div>
                                </div>
                            </div>
                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="flex justify-between">
                                <button class="btn-secondary" @click="previousQuestion" :disabled="currentQuestionIndex === 0">
                                    ä¸Šä¸€é¢˜
                                </button>
                                <div class="flex space-x-3">
                                    <button class="btn-secondary" @click="markQuestion">
                                        {{ isCurrentQuestionMarked ? 'å–æ¶ˆæ ‡è®°' : 'æ ‡è®°é¢˜ç›®' }}
                                    </button>
                                    <button class="btn-primary" @click="nextQuestion" :disabled="currentQuestionIndex === currentQuestions.length - 1">
                                        ä¸‹ä¸€é¢˜
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- ç­”é¢˜å¡ -->
                        <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold mb-4">ç­”é¢˜å¡</h4>
                            <div class="grid grid-cols-10 gap-2">
                                <div v-for="(question, index) in currentQuestions" 
                                     :key="index"
                                     class="w-8 h-8 rounded-full flex items-center justify-center text-xs cursor-pointer"
                                     :class="getAnswerCardClass(index)"
                                     @click="jumpToQuestion(index)">
                                    {{ index + 1 }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
            <!-- é”™é¢˜æœ¬æ¨¡å¼ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'mistakes'" key="mistakes">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-6">é”™é¢˜æœ¬</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="mistakeFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æ—¶é—´èŒƒå›´</label>
                                        <select v-model="mistakeFilter.timeRange" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="today">ä»Šå¤©</option>
                                            <option value="week">æœ¬å‘¨</option>
                                            <option value="month">æœ¬æœˆ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" v-model="mistakeFilter.importantOnly" class="mr-2">
                                            <span class="text-sm">åªçœ‹é‡ç‚¹é”™é¢˜</span>
                                        </label>
                                    </div>
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">é¢˜ç›®ç®¡ç†</label>
                                        <button class="btn-primary w-full mb-2" @click="startMistakePractice">
                                            é”™é¢˜ç»ƒä¹ 
                                        </button>
                                        <button class="btn-secondary w-full text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredMistakes.length }} é“é”™é¢˜
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="btn-secondary text-sm" @click="exportMistakes">
                                            å¯¼å‡ºé”™é¢˜
                                        </button>
                                        <button class="btn-danger text-sm" @click="clearMistakes">
                                            æ¸…ç©ºé”™é¢˜
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div v-for="(mistake, index) in filteredMistakes" :key="mistake.id" class="border rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(mistake.type) }}
                                                </span>
                                                <span class="text-gray-500 text-sm">{{ formatDate(mistake.mistakeTime) }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button @click="toggleImportant(mistake)" class="text-sm" :class="mistake.isImportant ? 'text-orange-600' : 'text-gray-400'">
                                                    {{ mistake.isImportant ? 'â­' : 'â˜†' }}
                                                </button>
                                                <button @click="removeMistake(mistake)" class="text-red-600 text-sm">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="mistake.content"></div>
                                        <div class="text-sm text-gray-600 mb-3">
                                            <div><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.answer) }}</div>
                                            <div><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong> {{ formatAnswer(mistake.wrongAnswer) }}</div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="btn-primary text-sm" @click="reviewMistake(mistake)">
                                                é‡æ–°ç»ƒä¹ 
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
            <!-- ç®¡ç†é¡µé¢ -->
            <transition name="fade" mode="out-in">
                <div v-if="currentMode === 'manage'" key="manage">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6">é¢˜ç›®ç®¡ç†</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢˜å‹</label>
                                        <select v-model="manageFilter.type" class="w-full p-2 border rounded-lg">
                                            <option value="">å…¨éƒ¨</option>
                                            <option value="single">å•é€‰é¢˜</option>
                                            <option value="multiple">å¤šé€‰é¢˜</option>
                                            <option value="judge">åˆ¤æ–­é¢˜</option>
                                            <option value="fill">å¡«ç©ºé¢˜</option>
                                            <option value="essay">ç®€ç­”é¢˜</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">æœç´¢</label>
                                        <input type="text" v-model="manageFilter.search" placeholder="æœç´¢é¢˜ç›®å†…å®¹..." class="w-full p-2 border rounded-lg">
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-gray-600">
                                        å…± {{ filteredManageQuestions.length }} é“é¢˜ç›®
                                    </div>
                                </div>
                                <div class="question-manager space-y-4">
                                    <div v-for="(question, index) in filteredManageQuestions" :key="question.id" class="border rounded-lg p-4 question-item">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-sm mr-2">
                                                    {{ getQuestionTypeText(question.type) }}
                                                </span>
                                                <span class="text-gray-500 text-sm">#{{ index + 1 }}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button @click="editQuestion(question)" class="text-blue-600 text-sm">
                                                    ç¼–è¾‘
                                                </button>
                                                <button @click="deleteQuestion(question)" class="text-red-600 text-sm">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3" v-html="question.content.substring(0, 200) + (question.content.length > 200 ? '...' : '')"></div>
                                        <div class="text-sm text-gray-600">
                                            <div v-if="question.options && question.options.length">
                                                <strong>é€‰é¡¹:</strong> {{ question.options.length }} ä¸ª
                                            </div>
                                            <div v-if="question.analysis">
                                                <strong>è§£æ:</strong> {{ question.analysis.substring(0, 100) + (question.analysis.length > 100 ? '...' : '') }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
        </main>
        <!-- ç™»å½•å¯¹è¯æ¡† -->
        <div v-if="showLoginDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showLoginDialog = false">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">ç”¨æˆ·ç™»å½•</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
                        <input 
                            type="text" 
                            v-model="loginForm.username" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">å¯†ç </label>
                        <input 
                            type="password" 
                            v-model="loginForm.password" 
                            class="w-full p-3 border border-gray-300 rounded-lg"
                            placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button class="btn-secondary" @click="showLoginDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="login">
                        ç™»å½•
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">é¦–æ¬¡ç™»å½•å°†è‡ªåŠ¨åˆ›å»ºè´¦æˆ·</p>
                </div>
            </div>
        </div>
        <!-- é¢˜ç›®ç±»å‹é€‰æ‹©å¯¹è¯æ¡† -->
        <div v-if="showQuestionTypeDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">é€‰æ‹©é¢˜åº“ç±»å‹</h3>
                <div class="space-y-3 mb-6">
                    <div v-for="(question, index) in pendingQuestions" :key="index" class="border rounded-lg p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">é¢˜ç›® {{ index + 1 }}</span>
                            <select v-model="question.selectedType" class="text-sm p-1 border rounded">
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="fill">å¡«ç©ºé¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="text-sm" v-html="question.content.substring(0, 100) + (question.content.length > 100 ? '...' : '')"></div>
                        <label class="flex items-center mt-2">
                            <input type="checkbox" v-model="question.selected" class="mr-2">
                            <span class="text-sm">å¯¼å…¥æ­¤é¢˜</span>
                        </label>
                    </div>
                </div>
                <!-- æ‰¹é‡æ“ä½œ -->
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" v-model="selectAllPending" @change="toggleSelectAll" class="mr-2">
                            <span class="text-sm">å…¨é€‰</span>
                        </label>
                        <select v-model="batchType" class="text-sm p-1 border rounded">
                            <option value="">æ‰¹é‡è®¾ç½®ç±»å‹</option>
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                            <option value="judge">åˆ¤æ–­é¢˜</option>
                            <option value="fill">å¡«ç©ºé¢˜</option>
                            <option value="essay">ç®€ç­”é¢˜</option>
                        </select>
                        <button @click="applyBatchType" class="btn-primary text-sm">åº”ç”¨</button>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button class="btn-secondary" @click="showQuestionTypeDialog = false">
                        å–æ¶ˆ
                    </button>
                    <button class="btn-primary" @click="confirmImport">
                        ç¡®è®¤å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>
        <!-- æ ¼å¼è¯´æ˜å¯¹è¯æ¡† -->
        <div v-if="showFormatSample" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-semibold mb-4">æ–‡ä»¶æ ¼å¼è¯´æ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-2">TXTæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
**å•é€‰é¢˜**<br>
1. ä»¥ä¸‹å“ªä¸ªæ˜¯JavaScriptçš„å…³é”®å­—ï¼Ÿ<br>
   A. class<br>
   B. function<br>
   C. method<br>
   D. type<br>
   ç­”æ¡ˆï¼šB<br>
   è§£æï¼šfunctionæ˜¯JavaScriptä¸­å®šä¹‰å‡½æ•°çš„å…³é”®å­—<br>
<br>
**å¤šé€‰é¢˜**<br>
<br>
1. ä»¥ä¸‹å“ªäº›å±äºä¸‰å‰‚ç±»ç‰©èµ„ï¼Ÿ<br>
   A.å‚¬åŒ–å‰‚<br>
   B.æ·»åŠ å‰‚<br>
   C.æº¶å‰‚<br>
   D.é˜€é—¨ç±»<br>
   ç­”æ¡ˆï¼šA,B,C<br>
   è§£æï¼šä¸‰å‰‚ç±»ä¸»è¦æŒ‡å‚¬åŒ–å‰‚ã€æ·»åŠ å‰‚ã€æº¶å‰‚ç­‰...
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Excelæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
è¡¨å¤´ï¼šé¢˜å‹ | é¢˜å¹² | é€‰é¡¹A | é€‰é¡¹B | é€‰é¡¹C | é€‰é¡¹D | ç­”æ¡ˆ | è§£æ<br>
ç¤ºä¾‹ï¼š<br>
single | é¢˜ç›®å†…å®¹ | é€‰é¡¹1 | é€‰é¡¹2 | é€‰é¡¹3 | é€‰é¡¹4 | B | è§£æå†…å®¹
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">JSONæ ¼å¼æ ·æ¿ï¼š</h4>
                        <div class="format-sample">
[<br>
  {<br>
    "type": "single",<br>
    "content": "é¢˜ç›®å†…å®¹",<br>
    "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"],<br>
    "answer": 1,<br>
    "analysis": "è§£æå†…å®¹"<br>
  }<br>
]
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn-primary" @click="showFormatSample = false">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
        <!-- åˆ†äº«é€‰é¡¹å¼¹çª— -->
        <div v-if="showQRCode" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showQRCode = false">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4" @click.stop>
                <h3 class="text-lg font-semibold mb-4 text-center">åˆ†äº«å­¦ä¹ åº”ç”¨</h3>
                <div class="space-y-3 mb-4">
                    <button class="btn-primary w-full" @click="copyLink">
                        ğŸ“‹ å¤åˆ¶åˆ†äº«é“¾æ¥
                    </button>
                    <button class="btn-secondary w-full" @click="exportData">
                        ğŸ’¾ å¯¼å‡ºå­¦ä¹ æ•°æ®
                    </button>
                    <button class="btn-secondary w-full" @click="importData">
                        ğŸ“¥ å¯¼å…¥å­¦ä¹ æ•°æ®
                    </button>
                </div>
                <!-- äºŒç»´ç  -->
                <div class="text-center mb-4">
                    <div id="qrcode" class="inline-block"></div>
                    <p class="text-xs text-gray-500 mt-2">æ‰«ç è®¿é—®å­¦ä¹ ç³»ç»Ÿ</p>
                </div>
                <div class="share-link text-center mb-4">
                    <small>{{ currentUrl }}</small>
                </div>
                <p class="text-xs text-gray-500 text-center mb-4">
                    é“¾æ¥åˆ†äº«æ›´ä¾¿æ·ï¼Œé€‚åˆå„ç§è®¾å¤‡ä½¿ç”¨
                </p>
                <button class="btn-secondary w-full" @click="showQRCode = false">
                    å…³é—­
                </button>
            </div>
        </div>
        <!-- å®æ—¶ç­”æ¡ˆæ˜¾ç¤º -->
        <div v-if="showRealTimeAnswer && currentAnswerShown" class="real-time-answer">
            <div class="text-sm font-semibold mb-2">ç­”æ¡ˆ</div>
            <div :class="currentAnswerClass">
                <div class="mb-1">
                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> {{ formatAnswer(currentQuestion.answer) }}
                </div>
                <div v-if="currentQuestion.analysis">
                    <strong>è§£æï¼š</strong> {{ currentQuestion.analysis }}
                </div>
                <div v-if="userAnswers[currentQuestionIndex] !== undefined">
                    <div v-if="isAnswerCorrect(currentQuestionIndex)" class="text-green-600">
                        âœ… å›ç­”æ­£ç¡®ï¼
                    </div>
                    <div v-else class="text-red-600">
                        âŒ å›ç­”é”™è¯¯
                    </div>
                </div>
            </div>
        </div>
        <!-- åº•éƒ¨å¯¼èˆªï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
        <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40 bottom-nav" style="padding-bottom: env(safe-area-inset-bottom);">
            <div class="flex justify-around py-2">
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'home'}" @click="switchMode('home')">
                    <span class="text-xl mb-1">ğŸ </span>
                    <span class="text-xs">é¦–é¡µ</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'config'}" @click="switchMode('config')">
                    <span class="text-xl mb-1">âš™ï¸</span>
                    <span class="text-xs">é…ç½®</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'exam'}" @click="switchMode('exam')">
                    <span class="text-xl mb-1">ğŸ“–</span>
                    <span class="text-xs">åˆ·é¢˜</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'mistakes'}" @click="switchMode('mistakes')">
                    <span class="text-xl mb-1">âŒ</span>
                    <span class="text-xs">é”™é¢˜</span>
                </button>
                <button class="flex flex-col items-center p-2" :class="{active: currentMode === 'manage'}" @click="switchMode('manage')">
                    <span class="text-xl mb-1">âš™ï¸</span>
                    <span class="text-xs">ç®¡ç†</span>
                </button>
            </div>
        </div>
        <!-- ç§»åŠ¨ç«¯åº•éƒ¨é—´è· -->
        <div class="md:hidden h-16"></div>
    </div>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    currentMode: 'home',
                    examMode: 'exam', // 'exam' æˆ– 'practice'
                    currentUrl: window.location.href,
                    // ç”¨æˆ·ç³»ç»Ÿ
                    currentUser: null,
                    showLoginDialog: false,
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    // é¢˜åº“æ•°æ®
                    questionBank: [],
                    // è€ƒè¯•é…ç½®
                    examConfig: {
                        single: 0,
                        multiple: 0,
                        judge: 0,
                        fill: 0,
                        essay: 0,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true
                    },
                    // å½“å‰è€ƒè¯•æ•°æ®
                    currentQuestions: [],
                    currentQuestionIndex: 0,
                    userAnswers: {},
                    submittedAnswers: new Set(),
                    markedQuestions: new Set(),
                    examTimer: null,
                    remainingTime: 0,
                    examStartTime: 0,
                    currentAnswerShown: false,
                    currentAnswerSubmitted: false,
                    // é”™é¢˜æœ¬
                    mistakeBank: [],
                    mistakeFilter: {
                        type: '',
                        timeRange: '',
                        importantOnly: false
                    },
                    // é¢˜ç›®ç®¡ç†
                    manageFilter: {
                        type: '',
                        search: ''
                    },
                    // æ–‡ä»¶ä¸Šä¼ 
                    uploadProgress: 0,
                    pendingQuestions: [],
                    showQuestionTypeDialog: false,
                    showFormatSample: false,
                    isDragging: false,
                    // åˆ†äº«
                    showQRCode: false,
                    showRealTimeAnswer: false,
                    // å­¦ä¹ ç»Ÿè®¡
                    studyStats: {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    },
                    // æ‰¹é‡æ“ä½œ
                    selectAllPending: false,
                    batchType: '',
                    // ğŸ‘‡ æ–°å¢ï¼šä¸ºç¼–è¾‘åŠŸèƒ½æ·»åŠ çš„æ•°æ®å±æ€§ ğŸ‘‡
                    editingQuestion: null,
                    showEditDialog: false
                    // ğŸ‘† æ–°å¢ç»“æŸ ğŸ‘†
                }
            },
            computed: {
                totalQuestions() {
                    return this.questionBank.length;
                },
                correctRate() {
                    if (this.studyStats.totalQuestions === 0) return 0;
                    return Math.round((this.studyStats.correctAnswers / this.studyStats.totalQuestions) * 100);
                },
                studyHours() {
                    return Math.round(this.studyStats.totalStudyTime / 3600 * 10) / 10;
                },
                mistakeCount() {
                    return this.mistakeBank.length;
                },
                questionTypeCount() {
                    const count = {
                        single: 0,
                        multiple: 0,
                        judge: 0,
                        fill: 0,
                        essay: 0
                    };
                    this.questionBank.forEach(q => {
                        if (count.hasOwnProperty(q.type)) {
                            count[q.type]++;
                        }
                    });
                    return count;
                },
                totalExamQuestions() {
                    return this.examConfig.single + this.examConfig.multiple + 
                           this.examConfig.judge + this.examConfig.fill + this.examConfig.essay;
                },
                currentQuestion() {
                    if (this.currentQuestions.length === 0) return null;
                    return this.currentQuestions[this.currentQuestionIndex];
                },
                examProgress() {
                    if (this.currentQuestions.length === 0) return 0;
                    return ((this.currentQuestionIndex + 1) / this.currentQuestions.length) * 100;
                },
                formattedTime() {
                    const minutes = Math.floor(this.remainingTime / 60);
                    const seconds = this.remainingTime % 60;
                    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                },
                timerColor() {
                    if (this.remainingTime <= 60) return 'text-red-600';
                    if (this.remainingTime <= 300) return 'text-orange-600';
                    return 'text-green-600';
                },
                isCurrentQuestionMarked() {
                    return this.markedQuestions.has(this.currentQuestionIndex);
                },
                currentAnswerClass() {
                    if (this.userAnswers[this.currentQuestionIndex] === undefined) {
                        return '';
                    }
                    return this.isAnswerCorrect(this.currentQuestionIndex) ? 'answer-correct' : 'answer-wrong';
                },
                filteredMistakes() {
                    let filtered = this.mistakeBank;
                    if (this.mistakeFilter.type) {
                        filtered = filtered.filter(m => m.type === this.mistakeFilter.type);
                    }
                    if (this.mistakeFilter.timeRange) {
                        const now = new Date();
                        const filterDate = new Date();
                        switch (this.mistakeFilter.timeRange) {
                            case 'today':
                                filterDate.setDate(now.getDate() - 1);
                                break;
                            case 'week':
                                filterDate.setDate(now.getDate() - 7);
                                break;
                            case 'month':
                                filterDate.setMonth(now.getMonth() - 1);
                                break;
                        }
                        if (this.mistakeFilter.timeRange !== '') {
                            filtered = filtered.filter(m => new Date(m.mistakeTime) >= filterDate);
                        }
                    }
                    if (this.mistakeFilter.importantOnly) {
                        filtered = filtered.filter(m => m.isImportant);
                    }
                    return filtered;
                },
                totalStudySessions() {
                    return this.studyStats.examRecords.length;
                },
                filteredManageQuestions() {
                    let filtered = this.questionBank;
                    if (this.manageFilter.type) {
                        filtered = filtered.filter(q => q.type === this.manageFilter.type);
                    }
                    if (this.manageFilter.search) {
                        filtered = filtered.filter(q => 
                            q.content.toLowerCase().includes(this.manageFilter.search.toLowerCase())
                        );
                    }
                    return filtered;
                }
            },
            methods: {
                // ç”¨æˆ·ç³»ç»Ÿ
                login() {
                    if (!this.loginForm.username.trim()) {
                        alert('è¯·è¾“å…¥ç”¨æˆ·åï¼');
                        return;
                    }
                    // æ¨¡æ‹Ÿç™»å½•/æ³¨å†Œ
                    const userId = 'user_' + this.loginForm.username;
                    this.currentUser = {
                        id: userId,
                        username: this.loginForm.username
                    };
                    // åŠ è½½ç”¨æˆ·æ•°æ®
                    this.loadUserData();
                    this.showLoginDialog = false;
                    this.loginForm = { username: '', password: '' };
                    alert('ç™»å½•æˆåŠŸï¼');
                },
                logout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        this.saveUserData();
                        this.currentUser = null;
                        this.clearAllData();
                        alert('å·²é€€å‡ºç™»å½•ï¼');
                    }
                },
                loadUserData() {
                    if (!this.currentUser) return;
                    const userData = localStorage.getItem(`examAppData_${this.currentUser.id}`);
                    if (userData) {
                        try {
                            const data = JSON.parse(userData);
                            if (data.questionBank) this.questionBank = data.questionBank;
                            if (data.mistakeBank) this.mistakeBank = data.mistakeBank;
                            if (data.studyStats) this.studyStats = data.studyStats;
                        } catch (e) {
                            console.error('ç”¨æˆ·æ•°æ®åŠ è½½å¤±è´¥:', e);
                        }
                    } else {
                        // æ–°ç”¨æˆ·åŠ è½½ç¤ºä¾‹é¢˜åº“
                        this.loadSampleQuestions();
                    }
                },
                saveUserData() {
                    if (!this.currentUser) return;
                    const data = {
                        questionBank: this.questionBank,
                        mistakeBank: this.mistakeBank,
                        studyStats: this.studyStats
                    };
                    localStorage.setItem(`examAppData_${this.currentUser.id}`, JSON.stringify(data));
                },
                clearAllData() {
                    this.questionBank = [];
                    this.mistakeBank = [];
                    this.studyStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalStudyTime: 0,
                        examRecords: []
                    };
                },
                // æ¨¡å¼åˆ‡æ¢
                switchMode(mode) {
                    // å¦‚æœä»è€ƒè¯•é¡µé¢ç¦»å¼€ï¼Œæ¸…ç©ºè€ƒè¯•æ•°æ®
                    if (this.currentMode === 'exam' && mode !== 'exam') {
                        this.clearExamData();
                    }
                    this.currentMode = mode;
                    this.saveUserData();
                },
                // æ¸…ç©ºè€ƒè¯•æ•°æ®
                clearExamData() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                        this.examTimer = null;
                    }
                    this.currentQuestions = [];
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.submittedAnswers.clear();
                    this.markedQuestions.clear();
                    this.remainingTime = 0;
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                },
                // å¼€å§‹ç»ƒä¹ æ¨¡å¼
                startPracticeMode() {
                    if (this.questionBank.length === 0) {
                        alert('è¯·å…ˆå¯¼å…¥é¢˜åº“æˆ–åŠ è½½ç¤ºä¾‹é¢˜åº“ï¼');
                        return;
                    }
                    this.examMode = 'practice';
                    this.currentQuestions = this.shuffleArray([...this.questionBank]);
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = true; // ç»ƒä¹ æ¨¡å¼é»˜è®¤æ˜¾ç¤ºç­”æ¡ˆ
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                // å¼€å§‹è€ƒè¯•
                startExam() {
                    if (this.questionBank.length === 0) {
                        alert('è¯·å…ˆå¯¼å…¥é¢˜åº“æˆ–åŠ è½½ç¤ºä¾‹é¢˜åº“ï¼');
                        return;
                    }
                    if (this.totalExamQuestions === 0) {
                        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€é“é¢˜ç›®ï¼');
                        return;
                    }
                    // æ ¹æ®é…ç½®ç”Ÿæˆè¯•å·
                    this.generateExamPaper();
                    this.examMode = 'exam';
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = this.examConfig.time * 60;
                    if (this.examConfig.enableTimer) {
                        this.startTimer();
                    }
                },
                // ç”Ÿæˆè¯•å·
                generateExamPaper() {
                    const questions = [];
                    // æŒ‰é¢˜å‹æŠ½å–é¢˜ç›®
                    const typeConfig = {
                        single: Math.min(this.examConfig.single, this.questionTypeCount.single),
                        multiple: Math.min(this.examConfig.multiple, this.questionTypeCount.multiple),
                        judge: Math.min(this.examConfig.judge, this.questionTypeCount.judge),
                        fill: Math.min(this.examConfig.fill, this.questionTypeCount.fill),
                        essay: Math.min(this.examConfig.essay, this.questionTypeCount.essay)
                    };
                    Object.keys(typeConfig).forEach(type => {
                        const count = typeConfig[type];
                        if (count > 0) {
                            const typeQuestions = this.questionBank.filter(q => q.type === type);
                            const shuffled = this.shuffleArray(typeQuestions);
                            questions.push(...shuffled.slice(0, count));
                        }
                    });
                    this.currentQuestions = this.examConfig.rule === 'random' ? 
                        this.shuffleArray(questions) : questions;
                },
                // åŠ è½½ç¤ºä¾‹é¢˜åº“
                loadSampleQuestions() {
                    const sampleQuestions = [
                        {
                            id: 'q1',
                            type: 'single',
                            content: 'ä»¥ä¸‹å“ªä¸ªæ˜¯ Vue 3 çš„ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Ÿ',
                            options: [
                                'createApp',
                                'ref',
                                'component',
                                'mount'
                            ],
                            answer: 1,
                            analysis: 'ref æ˜¯ Composition API çš„æ ¸å¿ƒå‡½æ•°ï¼Œç”¨äºåˆ›å»ºå“åº”å¼æ•°æ®ã€‚',
                            difficulty: 2,
                            tags: ['vue', 'composition-api']
                        },
                        {
                            id: 'q2',
                            type: 'multiple',
                            content: 'ä»¥ä¸‹å“ªäº›æ˜¯ JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ',
                            options: [
                                'String',
                                'Number',
                                'Array',
                                'Object',
                                'Boolean'
                            ],
                            answer: [0, 1, 4],
                            analysis: 'JavaScript çš„åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬ï¼šStringã€Numberã€Booleanã€Nullã€Undefinedã€Symbolã€BigIntã€‚Array å’Œ Object æ˜¯å¼•ç”¨ç±»å‹ã€‚',
                            difficulty: 1,
                            tags: ['javascript', 'basics']
                        },
                        {
                            id: 'q3',
                            type: 'judge',
                            content: 'CSS ä¸­çš„ flexbox å¸ƒå±€åªèƒ½ç”¨äºæ°´å¹³å¸ƒå±€ã€‚',
                            options: ['æ­£ç¡®', 'é”™è¯¯'],
                            answer: 1,
                            analysis: 'Flexbox æ—¢æ”¯æŒæ°´å¹³å¸ƒå±€ï¼ˆflex-direction: rowï¼‰ï¼Œä¹Ÿæ”¯æŒå‚ç›´å¸ƒå±€ï¼ˆflex-direction: columnï¼‰ã€‚',
                            difficulty: 2,
                            tags: ['css', 'flexbox']
                        },
                        {
                            id: 'q4',
                            type: 'fill',
                            content: 'JavaScript ä¸­ä½¿ç”¨ ______ å…³é”®å­—æ¥å£°æ˜å¸¸é‡ã€‚',
                            options: [],
                            answer: 'const',
                            analysis: 'const å…³é”®å­—ç”¨äºå£°æ˜å¸¸é‡ï¼Œå£°æ˜åä¸èƒ½å†é‡æ–°èµ‹å€¼ã€‚',
                            difficulty: 1,
                            tags: ['javascript', 'basics']
                        },
                        {
                            id: 'q5',
                            type: 'essay',
                            content: 'è¯·ç®€è¿° Vue 3 ç›¸å¯¹äº Vue 2 çš„ä¸»è¦æ”¹è¿›ç‚¹ã€‚',
                            options: [],
                            answer: 'Vue 3 çš„ä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š1. æ€§èƒ½æå‡ï¼ˆæ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦ã€æ›´å°çš„åŒ…ä½“ç§¯ï¼‰ï¼›2. Composition API æä¾›æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼›3. æ›´å¥½çš„ TypeScript æ”¯æŒï¼›4. æ–°å¢ Fragmentã€Teleportã€Suspense ç­‰å†…ç½®ç»„ä»¶ï¼›5. å“åº”å¼ç³»ç»Ÿä½¿ç”¨ Proxy æ›¿ä»£ Object.definePropertyã€‚',
                            analysis: 'Vue 3 åœ¨æ€§èƒ½ã€å¼€å‘ä½“éªŒã€TypeScript æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚',
                            difficulty: 3,
                            tags: ['vue', 'composition-api']
                        }
                    ];
                    this.questionBank = sampleQuestions;
                    this.saveUserData();
                },
                // æ–‡ä»¶å¤„ç†ç›¸å…³æ–¹æ³•
                triggerFileInput() {
                    this.$refs.fileInput.click();
                },
                handleFileSelect(event) {
                    const files = event.target.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                handleFileDrop(event) {
                    event.preventDefault();
                    this.isDragging = false;
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                },
                handleDragOver(event) {
                    event.preventDefault();
                    this.isDragging = true;
                },
                handleDragLeave(event) {
                    event.preventDefault();
                    this.isDragging = false;
                },
                async processFiles(files) {
                    this.uploadProgress = 0;
                    const totalFiles = files.length;
                    let processedFiles = 0;
                    for (let file of files) {
                        try {
                            await this.processFile(file);
                            processedFiles++;
                            this.uploadProgress = Math.round((processedFiles / totalFiles) * 100);
                        } catch (error) {
                            console.error('æ–‡ä»¶å¤„ç†é”™è¯¯:', error);
                            alert(`æ–‡ä»¶ ${file.name} å¤„ç†å¤±è´¥: ${error.message}`);
                        }
                    }
                    this.uploadProgress = 0;
                    this.saveUserData();
                },
                async processFile(file) {
                    let questions = [];
                    const fileName = file.name.toLowerCase();
                    try {
                        if (fileName.endsWith('.json')) {
                            questions = await this.parseJSON(file);
                        } else if (fileName.endsWith('.txt')) {
                            questions = await this.parseTXT(file);
                        } else if (fileName.endsWith('.xlsx')) {
                            questions = await this.parseExcel(file);
                        } else if (fileName.endsWith('.docx')) {
                            questions = await this.parseDocx(file);
                        } else {
                            throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
                        }
                        if (questions.length > 0) {
                            // ä¸ºæ¯ä¸ªé¢˜ç›®æ·»åŠ IDå’Œé»˜è®¤ç±»å‹
                            questions = questions.map((q, index) => ({
                                ...q,
                                id: q.id || `import_${Date.now()}_${index}`,
                                selectedType: q.type || 'single',
                                selected: true
                            }));
                            this.pendingQuestions = questions;
                            this.showQuestionTypeDialog = true;
                        } else {
                            alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®');
                        }
                    } catch (error) {
                        console.error('æ–‡ä»¶è§£æé”™è¯¯:', error);
                        throw new Error(`æ–‡ä»¶è§£æå¤±è´¥: ${error.message}`);
                    }
                },
                async parseTXT(file) {
                    const text = await file.text();
                    const lines = text.split('
').filter(line => line.trim());
                    const questions = [];
                    let currentQuestion = null;
                    let questionType = 'single';
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        // æ£€æµ‹é¢˜å‹æ ‡é¢˜
                        if (line.includes('å•é€‰é¢˜')) {
                            questionType = 'single';
                            continue;
                        } else if (line.includes('å¤šé€‰é¢˜')) {
                            questionType = 'multiple';
                            continue;
                        } else if (line.includes('åˆ¤æ–­é¢˜')) {
                            questionType = 'judge';
                            continue;
                        } else if (line.includes('å¡«ç©ºé¢˜')) {
                            questionType = 'fill';
                            continue;
                        } else if (line.includes('ç®€ç­”é¢˜')) {
                            questionType = 'essay';
                            continue;
                        }
                        // æ£€æµ‹é¢˜ç›®ç¼–å·
                        const questionMatch = line.match(/^\d+\.\s*(.+)/);
                        if (questionMatch) {
                            if (currentQuestion) {
                                questions.push(currentQuestion);
                            }
                            currentQuestion = {
                                id: `txt_${Date.now()}_${questions.length}`,
                                type: questionType,
                                content: questionMatch[1].trim(),
                                options: [],
                                answer: null,
                                analysis: ''
                            };
                            continue;
                        }
                        // æ£€æµ‹é€‰é¡¹
                        const optionMatch = line.match(/^([A-Z])\.\s*(.+)/);
                        if (optionMatch && currentQuestion) {
                            currentQuestion.options.push(optionMatch[2].trim());
                            continue;
                        }
                        // æ£€æµ‹ç­”æ¡ˆ
                        const answerMatch = line.match(/ç­”æ¡ˆï¼š(.+)/);
                        if (answerMatch && currentQuestion) {
                            const answerText = answerMatch[1].trim();
                            if (questionType === 'multiple') {
                                currentQuestion.answer = answerText.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else if (questionType === 'single' || questionType === 'judge') {
                                currentQuestion.answer = answerText.charCodeAt(0) - 65;
                            } else {
                                currentQuestion.answer = answerText;
                            }
                            continue;
                        }
                        // æ£€æµ‹è§£æ
                        const analysisMatch = line.match(/è§£æï¼š(.+)/);
                        if (analysisMatch && currentQuestion) {
                            currentQuestion.analysis = analysisMatch[1].trim();
                            continue;
                        }
                        // å¦‚æœæ˜¯åˆ¤æ–­é¢˜ï¼Œæ·»åŠ æ ‡å‡†é€‰é¡¹
                        if (questionType === 'judge' && currentQuestion && currentQuestion.options.length === 0) {
                            currentQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                        }
                    }
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    return questions;
                },
                async parseJSON(file) {
                    const text = await file.text();
                    return JSON.parse(text);
                },
                async parseExcel(file) {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet);
                    return json.map((row, index) => {
                        const question = {
                            id: 'excel_' + Date.now() + '_' + index,
                            type: row['é¢˜å‹'] || 'single',
                            content: row['é¢˜å¹²'] || row['é¢˜ç›®'] || '',
                            options: [],
                            answer: null,
                            analysis: row['è§£æ'] || ''
                        };
                        // å¤„ç†é€‰é¡¹
                        for (let i = 0; i < 10; i++) {
                            const option = row[`é€‰é¡¹${String.fromCharCode(65 + i)}`] || row[`é€‰é¡¹${i + 1}`];
                            if (option) {
                                question.options.push(option);
                            }
                        }
                        // å¤„ç†ç­”æ¡ˆ
                        const answer = row['ç­”æ¡ˆ'];
                        if (typeof answer === 'string') {
                            if (question.type === 'multiple') {
                                question.answer = answer.split(',').map(a => a.trim().charCodeAt(0) - 65);
                            } else {
                                question.answer = answer.trim().charCodeAt(0) - 65;
                            }
                        } else {
                            question.answer = answer;
                        }
                        return question;
                    }).filter(q => q.content);
                },
                async parseDocx(file) {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    const text = result.value;
                    // å°†docxæ–‡æœ¬è½¬æ¢ä¸ºç±»ä¼¼TXTçš„æ ¼å¼ï¼Œç„¶åå¤ç”¨TXTè§£æé€»è¾‘
                    const lines = text.split('
').filter(line => line.trim());
                    const formattedText = lines.join('
');
                    const blob = new Blob([formattedText], { type: 'text/plain' });
                    return await this.parseTXT(blob);
                },
                // æ‰¹é‡æ“ä½œç›¸å…³æ–¹æ³•
                toggleSelectAll() {
                    this.pendingQuestions.forEach(q => {
                        q.selected = this.selectAllPending;
                    });
                },
                applyBatchType() {
                    if (this.batchType) {
                        this.pendingQuestions.forEach(q => {
                            if (q.selected) {
                                q.selectedType = this.batchType;
                            }
                        });
                        this.batchType = '';
                    }
                },
                confirmImport() {
                    const selectedQuestions = this.pendingQuestions.filter(q => q.selected);
                    selectedQuestions.forEach(q => {
                        const question = {
                            ...q,
                            type: q.selectedType,
                            difficulty: q.difficulty || 2,
                            tags: q.tags || []
                        };
                        delete question.selectedType;
                        delete question.selected;
                        this.questionBank.push(question);
                    });
                    this.showQuestionTypeDialog = false;
                    this.pendingQuestions = [];
                    this.saveUserData();
                    alert(`æˆåŠŸå¯¼å…¥ ${selectedQuestions.length} é“é¢˜ç›®ï¼`);
                },
                // å·¥å…·æ–¹æ³•
                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                },
                // å¼€å§‹è®¡æ—¶å™¨
                startTimer() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                    }
                    this.examTimer = setInterval(() => {
                        if (this.remainingTime > 0) {
                            this.remainingTime--;
                        } else {
                            this.submitExam();
                        }
                    }, 1000);
                },
                // æš‚åœè€ƒè¯•
                pauseExam() {
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                        this.examTimer = null;
                    }
                },
                // æäº¤å½“å‰ç­”æ¡ˆ
                submitCurrentAnswer() {
                    if (this.userAnswers[this.currentQuestionIndex] === undefined) {
                        alert('è¯·å…ˆé€‰æ‹©ç­”æ¡ˆï¼');
                        return;
                    }
                    this.currentAnswerSubmitted = true;
                    this.submittedAnswers.add(this.currentQuestionIndex);
                    // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                    const isCorrect = this.isAnswerCorrect(this.currentQuestionIndex);
                    // å¦‚æœæ˜¯é”™é¢˜ï¼Œæ·»åŠ åˆ°é”™é¢˜æœ¬
                    if (!isCorrect) {
                        this.addToMistakeBank(this.currentQuestion, this.userAnswers[this.currentQuestionIndex]);
                    }
                    // è‡ªåŠ¨æ˜¾ç¤ºç­”æ¡ˆ
                    this.showCurrentAnswer();
                },
                // é€‰æ‹©é€‰é¡¹
                selectOption(index) {
                    if (this.currentAnswerSubmitted) return;
                    if (this.currentQuestion.type === 'multiple') {
                        // å¤šé€‰é¢˜
                        if (!this.userAnswers[this.currentQuestionIndex]) {
                            this.userAnswers[this.currentQuestionIndex] = [];
                        }
                        const answers = this.userAnswers[this.currentQuestionIndex];
                        const optionIndex = answers.indexOf(index);
                        if (optionIndex > -1) {
                            answers.splice(optionIndex, 1);
                        } else {
                            answers.push(index);
                        }
                        // è§¦å‘å“åº”å¼æ›´æ–°
                        this.userAnswers = { ...this.userAnswers };
                    } else {
                        // å•é€‰é¢˜
                        this.userAnswers[this.currentQuestionIndex] = index;
                    }
                },
                // ä¿å­˜ç®€ç­”é¢˜ç­”æ¡ˆ
                saveEssayAnswer() {
                    // ç®€ç­”é¢˜ç­”æ¡ˆå·²ç»é€šè¿‡ v-model ç»‘å®šï¼Œè¿™é‡Œåªæ˜¯ç¡®ä¿å“åº”å¼æ›´æ–°
                    this.userAnswers = { ...this.userAnswers };
                },
                // æ˜¾ç¤ºå½“å‰ç­”æ¡ˆ
                showCurrentAnswer() {
                    this.currentAnswerShown = true;
                },
                // éšè—å½“å‰ç­”æ¡ˆ
                hideCurrentAnswer() {
                    this.currentAnswerShown = false;
                },
                // è·å–é€‰é¡¹æ ·å¼ç±»
                getOptionClass(index) {
                    if (!this.currentAnswerSubmitted && this.userAnswers[this.currentQuestionIndex] === undefined) {
                        return '';
                    }
                    const userAnswer = this.userAnswers[this.currentQuestionIndex];
                    const correctAnswer = this.currentQuestion.answer;
                    if (this.currentQuestion.type === 'multiple') {
                        const isSelected = Array.isArray(userAnswer) ? userAnswer.includes(index) : userAnswer === index;
                        const isCorrect = Array.isArray(correctAnswer) ? correctAnswer.includes(index) : correctAnswer === index;
                        if (this.currentAnswerSubmitted) {
                            if (isCorrect) return 'correct';
                            if (isSelected && !isCorrect) return 'wrong';
                        } else {
                            if (isSelected) return 'selected';
                        }
                        return '';
                    } else {
                        if (this.currentAnswerSubmitted) {
                            if (index === correctAnswer) return 'correct';
                            if (index === userAnswer) return 'wrong';
                        } else {
                            if (index === userAnswer) return 'selected';
                        }
                        return '';
                    }
                },
                // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                isAnswerCorrect(questionIndex) {
                    const question = this.currentQuestions[questionIndex];
                    const userAnswer = this.userAnswers[questionIndex];
                    if (userAnswer === undefined) return false;
                    if (question.type === 'multiple') {
                        return this.arraysEqual(userAnswer.sort(), question.answer.sort());
                    } else if (question.type === 'essay' || question.type === 'fill') {
                        return userAnswer.trim().length > 0;
                    } else {
                        return userAnswer === question.answer;
                    }
                },
                // æ•°ç»„æ¯”è¾ƒ
                arraysEqual(a, b) {
                    return a.length === b.length && a.every((val, i) => val === b[i]);
                },
                // æ ¼å¼åŒ–ç­”æ¡ˆæ˜¾ç¤º
                formatAnswer(answer) {
                    if (Array.isArray(answer)) {
                        return answer.map(i => String.fromCharCode(65 + i)).join(', ');
                    } else if (typeof answer === 'number') {
                        return String.fromCharCode(65 + answer);
                    } else {
                        return answer;
                    }
                },
                // ä¸Šä¸€é¢˜
                previousQuestion() {
                    if (this.currentQuestionIndex > 0) {
                        this.currentQuestionIndex--;
                        this.currentAnswerShown = false;
                        this.currentAnswerSubmitted = this.submittedAnswers.has(this.currentQuestionIndex);
                    }
                },
                // ä¸‹ä¸€é¢˜
                nextQuestion() {
                    if (this.currentQuestionIndex < this.currentQuestions.length - 1) {
                        this.currentQuestionIndex++;
                        this.currentAnswerShown = false;
                        this.currentAnswerSubmitted = this.submittedAnswers.has(this.currentQuestionIndex);
                    }
                },
                // è·³è½¬åˆ°æŒ‡å®šé¢˜ç›®
                jumpToQuestion(index) {
                    this.currentQuestionIndex = index;
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = this.submittedAnswers.has(index);
                },
                // æ ‡è®°é¢˜ç›®
                markQuestion() {
                    if (this.markedQuestions.has(this.currentQuestionIndex)) {
                        this.markedQuestions.delete(this.currentQuestionIndex);
                    } else {
                        this.markedQuestions.add(this.currentQuestionIndex);
                    }
                },
                // è·å–ç­”é¢˜å¡æ ·å¼
                getAnswerCardClass(index) {
                    const baseClass = 'border cursor-pointer';
                    if (this.submittedAnswers.has(index)) {
                        if (this.isAnswerCorrect(index)) {
                            return `${baseClass} bg-green-100 text-green-800 border-green-300`;
                        } else {
                            return `${baseClass} bg-red-100 text-red-800 border-red-300`;
                        }
                    } else if (this.userAnswers[index] !== undefined) {
                        return `${baseClass} bg-blue-100 text-blue-800 border-blue-300`;
                    } else if (this.markedQuestions.has(index)) {
                        return `${baseClass} bg-yellow-100 text-yellow-800 border-yellow-300`;
                    } else {
                        return `${baseClass} bg-gray-100 text-gray-600 border-gray-300`;
                    }
                },
                // äº¤å·
                submitExam() {
                    // ç¡®ä¿è®¡æ—¶å™¨åœæ­¢
                    if (this.examTimer) {
                        clearInterval(this.examTimer);
                        this.examTimer = null;
                    }
                    // è®¡ç®—å¾—åˆ†
                    const totalQuestions = this.currentQuestions.length;
                    let correctCount = 0;
                    this.currentQuestions.forEach((question, index) => {
                        if (this.isAnswerCorrect(index)) {
                            correctCount++;
                        } else if (!this.submittedAnswers.has(index) && this.userAnswers[index] !== undefined) {
                            // æœªæ‰‹åŠ¨æäº¤ä½†å·²ä½œç­”çš„é”™é¢˜
                            this.addToMistakeBank(question, this.userAnswers[index]);
                        }
                    });
                    const score = Math.round((correctCount / totalQuestions) * 100);
                    // è®°å½•è€ƒè¯•ç»“æœ
                    this.studyStats.examRecords.push({
                        date: new Date().toISOString(),
                        score: score,
                        correctCount: correctCount,
                        totalQuestions: totalQuestions,
                        duration: Math.round((Date.now() - this.examStartTime) / 1000)
                    });
                    this.studyStats.totalQuestions += totalQuestions;
                    this.studyStats.correctAnswers += correctCount;
                    this.studyStats.totalStudyTime += Math.round((Date.now() - this.examStartTime) / 1000);
                    this.saveUserData();
                    // æ˜¾ç¤ºç»“æœ
                    alert(`è€ƒè¯•ç»“æŸï¼
æ€»é¢˜æ•°ï¼š${totalQuestions}
æ­£ç¡®æ•°ï¼š${correctCount}
å¾—åˆ†ï¼š${score}åˆ†`);
                },
                // æ·»åŠ åˆ°é”™é¢˜æœ¬
                addToMistakeBank(question, wrongAnswer) {
                    const existingMistake = this.mistakeBank.find(m => m.id === question.id);
                    if (!existingMistake) {
                        this.mistakeBank.push({
                            ...question,
                            wrongAnswer: wrongAnswer,
                            mistakeTime: new Date().toISOString(),
                            isImportant: false,
                            notes: ''
                        });
                    }
                },
                // é‡ç½®é…ç½®
                resetConfig() {
                    this.examConfig = {
                        single: 0,
                        multiple: 0,
                        judge: 0,
                        fill: 0,
                        essay: 0,
                        time: 60,
                        rule: 'random',
                        enableTimer: true,
                        showAnswerImmediately: true
                    };
                },
                // è·å–é¢˜å‹æ–‡æœ¬
                getQuestionTypeText(type) {
                    const typeMap = {
                        'single': 'å•é€‰é¢˜',
                        'multiple': 'å¤šé€‰é¢˜',
                        'judge': 'åˆ¤æ–­é¢˜',
                        'fill': 'å¡«ç©ºé¢˜',
                        'essay': 'ç®€ç­”é¢˜'
                    };
                    return typeMap[type] || 'æœªçŸ¥é¢˜å‹';
                },
                // æ ¼å¼åŒ–æ—¥æœŸ
                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('zh-CN');
                },
                // åˆ†äº«åŠŸèƒ½
                shareLink() {
                    this.showQRCode = true;
                    this.$nextTick(() => {
                        this.generateQRCode();
                    });
                },
                copyLink() {
                    navigator.clipboard.writeText(this.currentUrl).then(() => {
                        alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    });
                },
                generateQRCode() {
                    this.$nextTick(() => {
                        const qrcodeElement = document.getElementById('qrcode');
                        if (qrcodeElement) {
                            // æ¸…é™¤ä¹‹å‰çš„äºŒç»´ç 
                            qrcodeElement.innerHTML = '';
                            // ç”Ÿæˆæ–°çš„äºŒç»´ç 
                            new QRCode(qrcodeElement, {
                                text: this.currentUrl,
                                width: 128,
                                height: 128,
                                colorDark: '#07c160',
                                colorLight: '#ffffff',
                                correctLevel: QRCode.CorrectLevel.H
                            });
                        }
                    });
                },
                // æ•°æ®å…±äº«åŠŸèƒ½
                exportData() {
                    if (!this.currentUser) {
                        alert('è¯·å…ˆç™»å½•åå†å¯¼å‡ºæ•°æ®ï¼');
                        return;
                    }
                    const data = {
                        questionBank: this.questionBank,
                        mistakeBank: this.mistakeBank,
                        studyStats: this.studyStats,
                        exportTime: new Date().toISOString(),
                        version: '1.0',
                        userId: this.currentUser.id,
                        username: this.currentUser.username
                    };
                    const dataStr = JSON.stringify(data, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `åˆ·é¢˜æ•°æ®_${this.currentUser.username}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                importData() {
                    if (!this.currentUser) {
                        alert('è¯·å…ˆç™»å½•åå†å¯¼å…¥æ•°æ®ï¼');
                        return;
                    }
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const data = JSON.parse(e.target.result);
                                    let importCount = 0;
                                    if (data.questionBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.questionBank.length} é“é¢˜ç›®ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é¢˜ç›®
                                        const existingIds = new Set(this.questionBank.map(q => q.id));
                                        const newQuestions = data.questionBank.filter(q => !existingIds.has(q.id));
                                        this.questionBank.push(...newQuestions);
                                        importCount += newQuestions.length;
                                    }
                                    if (data.mistakeBank && confirm(`æ˜¯å¦å¯¼å…¥ ${data.mistakeBank.length} é“é”™é¢˜ï¼Ÿ`)) {
                                        // é¿å…é‡å¤é”™é¢˜
                                        const existingMistakeIds = new Set(this.mistakeBank.map(m => m.id));
                                        const newMistakes = data.mistakeBank.filter(m => !existingMistakeIds.has(m.id));
                                        this.mistakeBank.push(...newMistakes);
                                        importCount += newMistakes.length;
                                    }
                                    if (data.studyStats && confirm('æ˜¯å¦å¯¼å…¥å­¦ä¹ ç»Ÿè®¡æ•°æ®ï¼Ÿ')) {
                                        // åˆå¹¶å­¦ä¹ ç»Ÿè®¡
                                        this.studyStats.totalQuestions += data.studyStats.totalQuestions || 0;
                                        this.studyStats.correctAnswers += data.studyStats.correctAnswers || 0;
                                        this.studyStats.totalStudyTime += data.studyStats.totalStudyTime || 0;
                                        if (data.studyStats.examRecords) {
                                            this.studyStats.examRecords.push(...data.studyStats.examRecords);
                                        }
                                    }
                                    this.saveUserData();
                                    alert(`æ•°æ®å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${importCount} æ¡æ•°æ®ã€‚`);
                                } catch (error) {
                                    alert('æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                },
                // é”™é¢˜ç»ƒä¹ 
                startMistakePractice() {
                    if (this.mistakeBank.length === 0) {
                        alert('é”™é¢˜æœ¬ä¸ºç©ºï¼');
                        return;
                    }
                    this.examMode = 'practice';
                    this.currentQuestions = this.shuffleArray([...this.mistakeBank]);
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                // æ¸…ç©ºé”™é¢˜
                clearMistakes() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™é¢˜å—ï¼Ÿ')) {
                        this.mistakeBank = [];
                        this.saveUserData();
                    }
                },
                // åˆ é™¤é”™é¢˜
                removeMistake(mistake) {
                    const index = this.mistakeBank.findIndex(m => m.id === mistake.id);
                    if (index > -1) {
                        this.mistakeBank.splice(index, 1);
                        this.saveUserData();
                    }
                },
                // åˆ‡æ¢é‡ç‚¹æ ‡è®°
                toggleImportant(mistake) {
                    mistake.isImportant = !mistake.isImportant;
                    this.saveUserData();
                },
                // é‡æ–°ç»ƒä¹ é”™é¢˜
                reviewMistake(mistake) {
                    this.examMode = 'practice';
                    this.currentQuestions = [mistake];
                    this.currentMode = 'exam';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.markedQuestions.clear();
                    this.currentAnswerShown = false;
                    this.currentAnswerSubmitted = false;
                    this.submittedAnswers.clear();
                    this.examStartTime = Date.now();
                    this.remainingTime = 0;
                },
                // æ¸…ç©ºé¢˜åº“
                clearQuestionBank() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ•´ä¸ªé¢˜åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                        this.questionBank = [];
                        this.saveUserData();
                        alert('é¢˜åº“å·²æ¸…ç©ºï¼');
                    }
                },
                // åˆ é™¤é¢˜ç›®
                deleteQuestion(question) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                        const index = this.questionBank.findIndex(q => q.id === question.id);
                        if (index > -1) {
                            this.questionBank.splice(index, 1);
                            this.saveUserData();
                        }
                    }
                },
                // ç¼–è¾‘é¢˜ç›®
                editQuestion(question) {
                    this.editingQuestion = JSON.parse(JSON.stringify(question));
                    // ç¡®ä¿ç­”æ¡ˆæ ¼å¼æ­£ç¡®
                    if (this.editingQuestion.type === 'multiple' && !Array.isArray(this.editingQuestion.answer)) {
                        this.editingQuestion.answer = [];
                    }
                    if (this.editingQuestion.type === 'judge' && (!this.editingQuestion.options || this.editingQuestion.options.length === 0)) {
                        this.editingQuestion.options = ['æ­£ç¡®', 'é”™è¯¯'];
                    }
                    this.showEditDialog = true;
                },
                // å…³é—­ç¼–è¾‘å¯¹è¯æ¡†
                closeEditDialog() {
                    this.showEditDialog = false;
                    this.editingQuestion = null;
                },
                // ä¿å­˜ç¼–è¾‘çš„é¢˜ç›®
                saveEditQuestion() {
                    // éªŒè¯æ•°æ®
                    if (!this.editingQuestion.content.trim()) {
                        alert('è¯·è¾“å…¥é¢˜ç›®å†…å®¹ï¼');
                        return;
                    }
                    // éªŒè¯é€‰æ‹©é¢˜å¿…é¡»æœ‰æ­£ç¡®ç­”æ¡ˆ
                    if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                        if (this.editingQuestion.answer === null || this.editingQuestion.answer === undefined) {
                            alert('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    } else if (this.editingQuestion.type === 'multiple') {
                        if (!Array.isArray(this.editingQuestion.answer) || this.editingQuestion.answer.length === 0) {
                            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    } else {
                        if (!this.editingQuestion.answer || !this.editingQuestion.answer.trim()) {
                            alert('è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼');
                            return;
                        }
                    }
                    // å¤„ç†æ ‡ç­¾
                    if (typeof this.editingQuestion.tags === 'string') {
                        this.editingQuestion.tags = this.editingQuestion.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                    }
                    // æ›´æ–°é¢˜ç›®
                    const index = this.questionBank.findIndex(q => q.id === this.editingQuestion.id);
                    if (index !== -1) {
                        this.questionBank[index] = JSON.parse(JSON.stringify(this.editingQuestion));
                        this.saveUserData();
                        alert('é¢˜ç›®ä¿å­˜æˆåŠŸï¼');
                        this.closeEditDialog();
                    }
                },
                // æ·»åŠ é€‰é¡¹
                addOption() {
                    if (this.editingQuestion.options.length < 10) {
                        this.editingQuestion.options.push('');
                    }
                },
                // åˆ é™¤é€‰é¡¹
                removeOption(index) {
                    if (this.editingQuestion.options.length > 2) {
                        this.editingQuestion.options.splice(index, 1);
                        // é‡æ–°è°ƒæ•´ç­”æ¡ˆ
                        if (this.editingQuestion.type === 'single' || this.editingQuestion.type === 'judge') {
                            if (this.editingQuestion.answer >= this.editingQuestion.options.length) {
                                this.editingQuestion.answer = 0;
                            }
                        } else if (this.editingQuestion.type === 'multiple') {
                            this.editingQuestion.answer = this.editingQuestion.answer.filter(a => a < this.editingQuestion.options.length);
                        }
                    }
                }
            },
            mounted() {
                // æ£€æŸ¥æ˜¯å¦æœ‰å·²ç™»å½•ç”¨æˆ·
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    try {
                        this.currentUser = JSON.parse(savedUser);
                        this.loadUserData();
                    } catch (e) {
                        console.error('ç”¨æˆ·ä¼šè¯åŠ è½½å¤±è´¥:', e);
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>